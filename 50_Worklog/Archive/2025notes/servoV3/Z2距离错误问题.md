## Z2电机距离调试问题

### 伺服固定参数

- PA59：电机编码器分辨率。一般是17，为2的17次方，131072。电机旋转一圈，编码器脉冲为131072脉冲数
- PA12：位置指令脉冲电子齿轮第一分子。即为电机编码器分辨率比例关系。设置为8192
- PA13：位置指令脉冲电子齿轮分母。即为伺服指令分辨率。设置为675

其对应关系为：伺服发送10800个指令，电机会旋转1圈，电机编码器记录即为131072脉冲数。

### 距离影响参数

电机需要通过差速器和丝杆连接负载。当前设置的参数：

- 减速器 = 80：电机旋转80圈，负载齿轮旋转1圈。
- 丝杆螺距：负载齿轮转1圈，丝杆前进12mm

电机转一圈，丝杆前进多少距离？

给定：

- 减速器比 = 80
- 丝杆螺距 = 12mm

计算：

- 电机转一圈，负载转：
  $$
  1/80圈
  $$
  

- 丝杆推进：
  $$
  12/80=0.15mm
  $$

所以理想状态下，**电机转1圈，丝杆前进0.15mm**。

但是这样设置后，位置移动10mm，会出现实际移动143mm。现在需要排查问题到底出在哪里。



## Z2调试记录

首先检查Z2电机的PA59、PA12和PA13设置是否为17、8192和675。排除伺服参数影响。检查无误后，继续下面步骤。

### 步骤1：**实测电机转一圈，丝杆前进多少mm**

- 让电机精准转动 1圈
  - 手动关闭当前θ旋转电机电源，避免从地址冲突出现问题。
  - PA71：设置Z2电机MODBUS从地址为旋转电机θ的编号，`5`
  - 使用新psp控制器，进入设置界面，调整旋转轴电机的**齿轮比**为1。
  - 验证是否设置正确：psp设置旋转轴位置为0，随后位置移动`360`度（1圈）。查看日志和dp监视面板下，P-PoS代表的电机绝对位置脉冲数是否为`131072`（±100）。

- 用卡尺或百分表测量丝杆的直线位移

 记录这个位移值，记为 `X` mm。

### 步骤2：反推实际的总传动比

- 如果测得丝杆前进了 **2.15mm**，说明：

$$
每圈位移 =2.15mm→实际总传动比=12/2.15≈5.58
$$

这明显比设定的 80 低很多，说明实际的“减速比 × 螺距”与你设定的不同。

### 步骤3：**单独测丝杆螺距**

- 断开电机或电源
- 手动旋转差速器输出轴（或丝杆直接连接的轴）一圈
- 用卡尺测量丝杆推进距离

记录实际的螺距值，记为 `P_real`

###  步骤4：**实际减速器比 = 理论电机圈数 ÷ 输出轴圈数**

- θ电机旋转`360×80 = 28800`度，观察差速器旋转圈数是否为1

- 用公式：
  $$
  实际减速比 =电机转数/输出轴转数
  $$

