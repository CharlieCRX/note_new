## 电机的基础配置迁移

> 电机的基础配置也迁移到蓝牙小盒子，行车控制软件启动后先获取电机配置， 电机配置以外的其他信息仍旧在行车控制软件数据库中记录

当前电机的配置信息，是每个进程都在对应的本地存储一份各个电机的配置数据库。

但这样会导致如果两个设备的两个进程修改了电机的某一项数据的话，另一个设备的进程配置信息还是不会发生变化。从而导致配置不一致的问题。

所以为了统一电机配置，需要一个权威中心（蓝牙盒子）来保存整套电机的基础配置。后续所有的电机信息访问和修改，都需要修改蓝牙盒子的配置。

### 一、当前配置信息

下面从代码看下，当前配置数据库的逻辑。

在控制电机的初始化环境的时候，调用了数据库的初始化函数：

```C++
DbCtrl::DbInit(0);
```

从代码看，当前配置数据库包含以下主要表：

- `sysInfo_tb` - 系统信息表
- `user_tb` - 用户表
- `servo_class_tb` - 伺服电机类别表
- `servoMotor_tb` - 伺服电机配置表

其核心逻辑为：

1. **检查表是否存在**，不存在则创建表结构
2. **插入默认数据** - 7个电机的预设配置：
   - 电机名称：X1, X2, Y1, Z1, θ, Z2, Y2
   - 位置描述：前后移动控制电机左、右等
   - 默认参数：速度、点击距离、限位等
   - Y2电机默认禁用（`isEnable=0`）

### 二、迁移到蓝牙盒子的思路

1. **数据存储转移**：
   - 电机基础配置存储在蓝牙盒子中
   - 行车控制软件启动时从蓝牙盒子获取配置
   - 其他信息（用户、系统设置）仍保存在本地数据库
2. **通信协议设计**：
   - 定义获取电机配置的蓝牙通信命令
   - 定义修改电机配置的蓝牙通信命令
   - 实时同步配置变更

### 三、需要修改的关键函数

- `DbInit()` - 改为从蓝牙盒子获取配置
- `setSpeed()`, `setClickDist()`, `setMotorEnableState()`等 - 改为通过蓝牙修改
- 增加蓝牙通信接口函数

### 四、理论上的迁移步骤

1. **第一阶段**：实现配置获取接口
2. **第二阶段**：实现配置修改接口
3. **第三阶段**：移除本地电机配置表

具体步骤：

1. 写一个demo程序，测试`DbCtrl::DbInit(0)`能够在蓝牙盒子上初始化一个符合当前项目的数据库
2. 测试数据库读写函数，检验是否能正常读写数据
3. 替换本地电机配置表

