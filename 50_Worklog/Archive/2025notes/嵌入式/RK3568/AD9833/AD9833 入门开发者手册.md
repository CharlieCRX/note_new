------

# AD9833 入门开发者手册（简化版）

## 1. 芯片定位

AD9833 是一颗 **直接数字合成 (DDS)** 芯片，可以通过 SPI 控制，生成 **正弦波、三角波、方波**，输出频率范围 **0 ~ 12.5 MHz**。

------

## 2. 主要引脚

| 引脚                        | 功能                           |
| --------------------------- | ------------------------------ |
| **VOUT (10)**               | 模拟输出（波形从这里出来）     |
| **MCLK (5)**                | 主时钟输入（例如 25 MHz 晶振） |
| **SDATA (6)**               | SPI 数据输入                   |
| **SCLK (7)**                | SPI 时钟                       |
| **FSYNC (8)**               | SPI 片选（低有效）             |
| **VDD (2)**                 | 电源（2.3~5.5 V）              |
| **AGND (9)** / **DGND (4)** | 模拟/数字地                    |
| **CAP/2.5V (3)**            | 内部稳压去耦电容（100 nF）     |
| **COMP (1)**                | DAC 偏置去耦电容（10 nF）      |

------

## 3. 输出波形类型

- **正弦波**（常用，精度高）
- **三角波**（简化输出）
- **方波**（其实是 DAC 数据的 MSB，类似时钟信号）

通过控制寄存器的 `OPBITEN`、`MODE`、`DIV2` 位来切换。

------

## 4. 输出频率公式

$f_{OUT} = \frac{FREQREG \times f_{MCLK}}{2^{28}}$

- **fMCLK**：外部时钟，比如 25 MHz。
- **FREQREG**：28 位频率字（写入 FREQ0 或 FREQ1）。
- 例如：要 1 kHz 波形，频率字 = $1k / 25M \times 2^{28}$ ≈ **10737 (0x29A9)**。

------

## 5. 常用寄存器配置

- **控制寄存器（16 位）**
  - `RESET=1` → 输出固定在中点电平（初始化时用）。
  - `RESET=0` → 开始正常输出。
  - `OPBITEN=0, MODE=0` → 正弦波输出。
  - `OPBITEN=0, MODE=1` → 三角波输出。
  - `OPBITEN=1` → 方波（DAC MSB）。
- **频率寄存器**
  - `FREQ0` 和 `FREQ1` 各 28 位。
  - 写入时分两次，每次写 14 位。
  - 公式见第 4 节。
- **相位寄存器**
  - `PHASE0` / `PHASE1` 各 12 位。
  - 用来控制输出波形的相位偏移。

------

## 6. 最小初始化流程（例子：输出 1 kHz 正弦波）

1. 上电后，写控制寄存器：`RESET=1`（DAC 固定中点电平）。

2. 计算频率字：

   $FREQREG = \frac{1000 \times 2^{28}}{25 \times 10^6} \approx 10737$

3. 通过 SPI 写入 `FREQ0`（分两次写入：先低 14 位，再高 14 位）。

4. 写相位寄存器（一般写 0 即可）。

5. 写控制寄存器：`RESET=0, OPBITEN=0, MODE=0`（启用正弦输出）。

6. 从 VOUT 引脚测量，即可得到 1 kHz 正弦波。

------

## 7. 提示

- 输出幅度典型值约 **0.6 Vpp**，居中在 ~0.3V 偏置电平。若需要标准幅度，可加运放放大/偏置电路。
- 输出直流分量不可控（除非复位时保持在中点电平）。
- SPI 通信时，**FSYNC 要在 16 位传输期间保持低电平**。
- 若要切换频率/相位，改寄存器值即可，波形会在几 MCLK 周期后更新。

------

## 8. 你需要记住的最少内容

- **VOUT 出来的是波形，不是直流电压**。
- **计算频率字，用公式写入 FREQ0**。
- **RESET=0 才有波形**。

------

# 控制寄存器（16 位）功能介绍

下表是手册里的定义（整理简化版）：

| 位 (D15…D0)        | 名称        | 功能说明                                       |
| ----------------- | --------- | ------------------------------------------ |
| **D15:D14**       | 必须=00     | 表示这是控制寄存器写操作（区分和频率/相位寄存器写入）                |
| **D13 (B28)**     | 频率寄存器写入方式 | 1=连续写入完整 28 位频率字（推荐），0=只写 14 位（MSB 或 LSB）。 |
| **D12 (HLB)**     | 半字选择      | 当 B28=0 时有效；1=写高 14 位，0=写低 14 位。           |
| **D11 (FSELECT)** | 频率寄存器选择   | 0=FREQ0，1=FREQ1。决定当前输出用哪个频率寄存器。            |
| **D10 (PSELECT)** | 相位寄存器选择   | 0=PHASE0，1=PHASE1。                         |
| **D9**            | 保留        | 必须写 0。                                     |
| **D8 (RESET)**    | 复位控制      | 1=输出固定在中点电平（波形停止），0=正常输出。                  |
| **D7 (SLEEP1)**   | 时钟休眠      | 1=关闭 MCLK（节能，DAC 输出保持），0=正常。               |
| **D6 (SLEEP12)**  | DAC 休眠    | 1=关闭 DAC（省电），0=正常。                         |
| **D5 (OPBITEN)**  | 输出选择开关    | 0=正常波形（正弦/三角），1=输出方波（DAC 数据 MSB 或 MSB/2）。  |
| **D4**            | 保留        | 必须写 0。                                     |
| **D3 (DIV2)**     | 方波分频      | 当 OPBITEN=1 时有效；0=输出 MSB，1=输出 MSB/2。       |
| **D2**            | 保留        | 必须写 0。                                     |
| **D1 (MODE)**     | 波形模式      | 0=正弦波，1=三角波（注意：OPBITEN=1 时无效）。             |
| **D0**            | 保留        | 必须写 0。                                     |

------

## 最常用的组合

1. **正弦波输出**
   - `RESET=0, OPBITEN=0, MODE=0`
   - 这是最常见的模式。
2. **三角波输出**
   - `RESET=0, OPBITEN=0, MODE=1`
3. **方波输出**
   - `RESET=0, OPBITEN=1, DIV2=0` → 输出 MSB（方波，占空比 50%）
   - `RESET=0, OPBITEN=1, DIV2=1` → 输出 MSB/2（频率减半的方波）
4. **复位状态（固定电平）**
   - `RESET=1` → DAC 输出固定在中点电平（相当于直流）。

------

## 小结

控制寄存器就像 AD9833 的“模式开关”，

- D13/D12 决定**频率写法**，
- D11/D10 决定**用哪个寄存器**，
- D8/D7/D6 控制**是否工作/省电**，
- D5/D3/D1 控制**输出波形类型**。

👉 你在代码里只要构造一个 **16 位数据**，通过 SPI 送进去，就能切换模式。

------

