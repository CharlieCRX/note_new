------

# ğŸŒŸ **GDB å‘½ä»¤é€ŸæŸ¥è¡¨ï¼ˆå·¥ç¨‹å¸ˆå®æˆ˜ç‰ˆï¼‰**

> é€‚ç”¨äº Linux / AArch64 / C++ / PCIe / mmap / DMA è°ƒè¯•
>  ç»“æ„ç®€æ˜ã€å¿«é€ŸæŸ¥é˜…ã€å¯ç›´æ¥ä½¿ç”¨

------

# 1. åŸºæœ¬æ“ä½œ

```bash
run                     # è¿è¡Œç¨‹åº
start                   # è¿è¡Œåˆ° main
continue / c            # ç»§ç»­æ‰§è¡Œ
next / n                # å•æ­¥ï¼ˆä¸è¿›å…¥å‡½æ•°ï¼‰
step / s                # å•æ­¥ï¼ˆè¿›å…¥å‡½æ•°ï¼‰
finish                  # è¿è¡Œåˆ°å½“å‰å‡½æ•°ç»“æŸ
kill                    # æ€æ‰ç¨‹åº
quit                    # é€€å‡º gdb
```

------

# 2. æ–­ç‚¹ä¸æ¡ä»¶æ–­ç‚¹

```bash
break file.c:123        # è¡Œå·æ–­ç‚¹
break func              # å‡½æ•°æ–­ç‚¹
break *0xaddr           # åœ°å€æ–­ç‚¹ï¼ˆåµŒå…¥å¼å¸¸ç”¨ï¼‰
tbreak func             # ä¸€æ¬¡æ€§æ–­ç‚¹

condition <bp> expr     # æ¡ä»¶æ–­ç‚¹
delete <bp>             # åˆ é™¤æ–­ç‚¹
disable <bp>            # ç¦ç”¨æ–­ç‚¹
enable <bp>             # å¯ç”¨æ–­ç‚¹

info breakpoints        # æŸ¥çœ‹æ–­ç‚¹
```

------

# 3. æŸ¥çœ‹ä»£ç 

```bash
list                    # æŸ¥çœ‹å½“å‰ä»£ç 
list func               # æŸ¥çœ‹å‡½æ•°æºç 
list 100,150            # æŸ¥çœ‹èŒƒå›´
```

------

# 4. æŸ¥çœ‹å˜é‡ä¸è¡¨è¾¾å¼

```bash
print var               # æ‰“å°å˜é‡
print *ptr              # æ‰“å°æŒ‡é’ˆæŒ‡å‘çš„å†…å®¹
ptype var               # æŸ¥çœ‹ç±»å‹
p (char*)ptr            # ä»æŒ‡å®šåœ°å€æ‰“å°å­—ç¬¦ä¸²

info locals             # æŸ¥çœ‹å±€éƒ¨å˜é‡
info args               # å‚æ•°å˜é‡

set var = 123           # ä¿®æ”¹å˜é‡
set print pretty on     # ç»“æ„ä½“ç¾åŒ–è¾“å‡º
```

------

# 5. æŸ¥çœ‹å†…å­˜ï¼ˆåµŒå…¥å¼/é©±åŠ¨å¿…å¤‡ï¼‰

GDB æŸ¥çœ‹å†…å­˜ä¸»è¦ä½¿ç”¨å‘½ä»¤ï¼š

```
x /Nfu ADDRESS
```

å«ä¹‰ï¼š

| å­—æ®µ    | å«ä¹‰                                 |
| ------- | ------------------------------------ |
| N       | æ˜¾ç¤ºå¤šå°‘ä¸ªå•å…ƒ                       |
| f       | æ˜¾ç¤ºæ ¼å¼ï¼ˆhex/dec/char/addr ç­‰ï¼‰     |
| u       | å•å…ƒå¤§å°ï¼ˆbyte/halfword/wordï¼‰       |
| ADDRESS | å†…å­˜åœ°å€ï¼ˆå˜é‡åã€æŒ‡é’ˆã€è¡¨è¾¾å¼éƒ½è¡Œï¼‰ |

------

### 1ï¸âƒ£ å¸¸ç”¨æ ¼å¼ç¬¦ï¼ˆformatï¼‰

| æ ¼å¼ | æ„ä¹‰                         |
| ---- | ---------------------------- |
| `x`  | 16è¿›åˆ¶ï¼ˆæœ€å¸¸ç”¨ï¼‰             |
| `d`  | æœ‰ç¬¦å·åè¿›åˆ¶                 |
| `u`  | æ— ç¬¦å·åè¿›åˆ¶                 |
| `t`  | äºŒè¿›åˆ¶                       |
| `c`  | å­—ç¬¦                         |
| `s`  | C å­—ç¬¦ä¸²ï¼ˆä»¥åœ°å€å½“æˆå­—ç¬¦ä¸²ï¼‰ |

------

### 2ï¸âƒ£ å•å…ƒå¤§å°ï¼ˆunitï¼‰

| å•å…ƒç¬¦å· | å¤§å°                  |
| -------- | --------------------- |
| `b`      | 1 byte                |
| `h`      | 2 bytesï¼ˆhalfwordï¼‰   |
| `w`      | 4 bytesï¼ˆwordï¼‰       |
| `g`      | 8 bytesï¼ˆgiant wordï¼‰ |

```bash
x/16x addr              # 16 è¡Œåå…­è¿›åˆ¶
x/32bx addr             # 32 å­—èŠ‚
x/20i addr              # åæ±‡ç¼–
x/s addr                # æŸ¥çœ‹å­—ç¬¦ä¸²
```

å¸¸è§æ¨¡å¼ï¼š

```bash
x/8gx addr              # 8 ä¸ª 8 å­—èŠ‚ï¼ˆ64bitï¼‰
x/4wx addr              # 4 ä¸ª wordï¼ˆ32bitï¼‰
```

------

# 6. å †æ ˆä¸ Frame æ“ä½œ

```bash
bt                      # è°ƒç”¨æ ˆ
frame n                 # åˆ‡æ¢æ ˆå¸§
up / down               # ä¸Šä¸€ä¸ª/ä¸‹ä¸€ä¸ªæ ˆå¸§
info frame              # å½“å‰æ ˆå¸§ä¿¡æ¯
```

------

# 7. çº¿ç¨‹è°ƒè¯•ï¼ˆå¤šçº¿ç¨‹ / AArch64 Linux å¸¸ç”¨ï¼‰

```bash
info threads            # æŸ¥çœ‹çº¿ç¨‹
thread n                # åˆ‡æ¢çº¿ç¨‹
thread apply all bt     # æ‰€æœ‰çº¿ç¨‹æ ˆ
thread apply all info registers
```

------

# 8. å¯„å­˜å™¨ï¼ˆAArch64 è°ƒè¯•å¿…å¤‡ï¼‰

```bash
info registers          # æŸ¥çœ‹å…¨éƒ¨å¯„å­˜å™¨
info reg x0             # æŸ¥çœ‹ä¸€ä¸ªå¯„å­˜å™¨

set $x0 = 0x1234        # ä¿®æ”¹å¯„å­˜å™¨
```

å¸¸è§ AArch64 å¯„å­˜å™¨ï¼š

```bash
x0-x30    é€šç”¨å¯„å­˜å™¨
sp        æ ˆæŒ‡é’ˆ
pc        ç¨‹åºè®¡æ•°å™¨
```



------

# 9. TUI å›¾å½¢ç•Œé¢

æ‰“å¼€ TUIï¼š

```bash
layout src              # æºç æ¨¡å¼
layout asm              # æ±‡ç¼–æ¨¡å¼
layout regs             # å¯„å­˜å™¨æ¨¡å¼
```

ç„¦ç‚¹åˆ‡æ¢ï¼ˆæœ€é‡è¦ï¼‰ï¼š

```bash
Ctrl + x o              # åœ¨å„ä¸ªçª—å£é—´åˆ‡æ¢ç„¦ç‚¹
```

é€€å‡º TUIï¼š

```bash
Ctrl + x a
```

å…¶ä»–ï¼š

```bash
refresh                 # é‡ç»˜å±å¹•
tui disable             # ç¦ç”¨ TUI
```

------

# 10. åæ±‡ç¼–ï¼ˆé€‚ç”¨äº PCIeã€DMAã€é©±åŠ¨çº§è°ƒè¯•ï¼‰

```bash
disas                   # å½“å‰å‡½æ•°åæ±‡ç¼–
disas func              # æŒ‡å®šå‡½æ•°
disas 0xaddr, 0xaddr2   # åœ°å€èŒƒå›´åæ±‡ç¼–
```

------

# 11. ç›‘è§†ç‚¹ï¼ˆå†…å­˜ / DMA è°ƒè¯•å¸¸ç”¨ï¼‰

```bash
watch var               # å†™ç›‘è§†
rwatch var              # è¯»ç›‘è§†
awatch var              # è¯»å†™ç›‘è§†
info watchpoints        # æŸ¥çœ‹ç›‘è§†ç‚¹
```

ç¤ºä¾‹ï¼ˆç›‘æ§ DMA blockID æ”¹å˜ï¼‰ï¼š

```bash
watch *(uint32_t*)0xff0000a0
```

------

# 12. mmap / DMA è°ƒè¯•å¸¸ç”¨æŠ€å·§

æŸ¥çœ‹ mmap è¿”å›æ˜¯å¦ä¸ºæ˜ å°„åœ°å€ï¼š

```bash
print mapped_ptr
x/32x mapped_ptr
```

æ£€æŸ¥ DMA buffer åœ°å€ï¼š

```bash
x/64bx dma_buffer
```

æ£€æŸ¥æŒ‡é’ˆæ˜¯å¦æœ‰æ•ˆï¼š

```bash
ptype buffer
```

ç›‘æ§å†™å…¥å¯„å­˜å™¨æ“ä½œï¼š

```bash
watch *(uint32_t*)reg_addr
```

------

# 13. è¿œç¨‹è°ƒè¯•ï¼ˆGDBServer / åµŒå…¥å¼ï¼‰

```bash
target remote :1234
target remote 192.168.x.x:1234

load                    # åŠ è½½ç¨‹åº/ç¬¦å·
monitor reset halt      # å¤ä½ï¼ˆè§†ç¯å¢ƒï¼‰
```

------

# 14. å¸¸ç”¨è®¾ç½®ï¼ˆå»ºè®®å†™å…¥ ~/.gdbinitï¼‰

```bash
set pagination off
set print pretty on
set confirm off
set disassembly-flavor intel
```

------

# 15. æ¨èå·¥ä½œæµï¼ˆå®æˆ˜ï¼‰

```bash
1. è®¾ç½®æ–­ç‚¹ï¼šbreak foo.c:123
2. run
3. åœä¸‹åï¼š
   - info locals
   - bt
   - x/32x addr
4. next / step è°ƒæŸ¥
5. layout src è¿›å…¥ TUI
6. å¤šçº¿ç¨‹æ—¶ï¼š
   - info threads
   - thread n
```

------

# 16. ä½ è‡ªå·±çš„æ¡ˆä¾‹ï¼ˆå»ºè®®ä¸æ–­è¡¥å……ï¼‰

> ğŸ”¥ **è¿™æ˜¯ä½ æœªæ¥æœ€å®è´µçš„éƒ¨åˆ†**
>  æ¯æ¬¡ä½ è§£å†³ä¸€ä¸ª GDB è°ƒè¯•é—®é¢˜ï¼Œéƒ½å†™ä¸€æ¡ã€‚

ç¤ºä¾‹ï¼š

### **è°ƒè¯• mmap å´©æºƒ**

```
break mmap
run
bt
info registers
x/32x $sp
```

### **DMA blockID ä¸ä¸€è‡´æ’æŸ¥**

```
watch *(uint32_t*)0xff0000a0
thread apply all bt
x/64bx dma_buffer
```

------

# ğŸ‰ å®Œæˆï¼

è¿™æ˜¯ä¸€ä¸ª **å®Œå…¨å¯ç”¨ã€ç»“æ„ä¸“ä¸šã€å·¥ç¨‹å¸ˆå®æˆ˜çº§åˆ«** çš„ GDB å‘½ä»¤é€ŸæŸ¥è¡¨ã€‚