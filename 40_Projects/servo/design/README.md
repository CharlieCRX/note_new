# 🏗️ Technical Design & Case Studies | 技术设计与复盘

这个目录用于记录在项目开发中遇到的**复杂技术难题、核心架构设计以及重大重构经验**。
它不仅记录“怎么做”，更重点记录“为什么这么做”以及“沉淀了什么通用模型”。

---

## 🚀 核心案例索引 (Focus Projects)

| 模块名称               | 核心挑战                       | 核心技术/模型                          | 交付价值                       | 状态     |
| :--------------------- | :----------------------------- | :------------------------------------- | :----------------------------- | :------- |
| [JOG 运动控制](./jog/) | 多轴联动停止逻辑混乱、撞机风险 | 停止原因状态机模型 (Stop-Reason Model) | 响应延迟降低 50%，杜绝逻辑撞机 | ✅ 已结项 |
| (待补充)               |                                |                                        |                                | 📅 计划中 |

---

## 📖 文档编写规范 (STAR+ Method)

为了方便日后快速提取面试素材，每个子模块建议包含以下逻辑：

------

1. **Background (00)**: 回答「为什么这个问题存在」

   示例内容结构：

   ```markdown
   # checkJog 重构背景
   
   ## 原始业务目标
   - 点动过程中实时监控电机状态
   - 出现异常立即停止，保障设备安全
   
   ## 业务复杂化来源
   - 新增双电机同步模式（X1/X2）
   - 引入 Z 轴危险高度预警
   - 增加物理限位（速度 < 1）
   - UI 提示与安全逻辑混合
   ```

2. ------

   **Problem (01)**: **痛点描述**。留下“当时我卡住的地方”。

   这里你可以直接引用你现在的代码片段（不用全贴）。

   重点不是“代码丑”，而是：

   ```markdown
   ## 核心问题
   
   1. 停止条件分散在 for / if / break 中
   2. 每新增一种停止条件，都要复制 stop + 弹窗逻辑
   3. 无法快速回答「为什么这次点动停止了？」
   4. UI 行为嵌入控制逻辑，无法复用
   ```

3. ------

   **Model/Design (02)**: **核心抽象**。这是**整次重构最有价值的一篇**。

   ~~~markdown
   # JogStopReason 模型
   
   ## 关键认知转变
   点动停止不是“流程分支”，而是**领域事件**
   
   ## 抽象结果
   ```cpp
   enum class JogStopReason {
       ReachSoftLimit,
       ReachSpecialLimit,
       DualMotorNotSync,
       ZAxisInDangerZone,
       MotorSpeedZero,
       SpeedReadFailed,
   };
   
   ### 
   - 停止原因显式化
   
   - 统一处理 stop 行为
   
   - 支持日志、UI、远程上报
   ~~~

4. ------

   **Implementation (03)**: **结构演进**。

   👉 **这一篇 = 你工程抽象能力的证据**

   这篇回答：

   > **我不是“改代码”，而是“换结构”**

   可以画 ASCII 图（很推荐）：

   ```markdown
   Before:
   checkJog()
    ├─ if (...) stop + msg
    ├─ if (...) stop + msg
    └─ ...
   
   After:
   checkJogLoop
    └─ checkMotorCondition -> JogStopReason
           └─ handleJogStop
   ```

   也可以放关键伪代码。

5. **Lessons (04)**: **复盘建议**。这篇只写**认知**，不写代码。

   ```markdown
   ## 本次重构的关键收获
   
   1. 当 if 数量超过 5 时，应警惕“隐式状态”
   2. 安全类逻辑应优先建模“原因”，而非“动作”
   3. UI 不应进入控制核心
   4. 工控系统的可维护性，本质是风险控制能力
   ```

---

## 🛠️ 通用避坑 Checklist

> 这里记录在跨项目中通用的经验准则，防止在同一个坑里掉进去两次。

- [ ] **实时性检查**：涉及运动控制的逻辑，是否考虑了指令周期与反馈周期的同步？
- [ ] **异常边界**：所有状态机是否都有 `Error` 状态？是否有强制复位逻辑？
- [ ] **资源释放**：在重构旧代码时，原有的句柄、内存、线程是否已妥善闭环？

---

## 📈 成长足迹

- **2025-01**: 完成 JOG 模块深度重构，首次引入“停止原因模型”。
- **目标**: 每季度产出至少 1 篇高质量的技术设计深度复盘。

---
*“带走能力，留下代码。” — 个人职业资产管理*