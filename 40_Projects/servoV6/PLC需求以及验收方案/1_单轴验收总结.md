# Y轴 PLC 控制 + Modbus TCP 运动测试报告

**测试日期：2026-02-27**
**测试方式：远程调试**
**PLC软件：AutoShop**
**上位机测试工具：Modbus Poll**
**通讯协议：Modbus TCP**
**PLC IP：192.168.1.88**
**端口：502**

------

# 一、测试目标

验证 Y 轴在以下功能下的完整可控性与稳定性：

1. 点动控制（正/反）
2. 最大/最小限位保护
3. 绝对位置定位
4. 相对位置定位
5. Modbus TCP 上位机远程控制一致性

------

# 二、PLC 本地功能测试

## 1️⃣ 电机使能与状态监测

- 变量：**M1（使能轴Y电机）**
- 操作：置位为 1
- 结果：
  - 电机进入使能状态
  - D101（轴状态）显示在 1 / 2 之间跳变
    - 1 = 使能未运动
    - 2 = 使能运动中
  - 由于总线闭环控制，状态轻微跳变属于正常现象

✅ 结论：电机使能与状态反馈正常。

------

## 2️⃣ 点动测试

### 参数

- 手动速度：变量赋值（单位 mm/s）
- 当前绝对位置监控：D124（浮点数，单位 mm）

### 正向点动

- 触发：M54 置位
- 现象：绝对位置持续增加

### 反向点动

- 触发：M55 置位
- 现象：绝对位置持续减少

✅ 结论：点动功能正常。

------

# 三、绝对定位测试

## 操作流程

1. 电机使能（M1=1）
2. 设置定位速度（单位 mm/s）
3. 设置绝对定位位置 D24（浮点数）
4. 触发 M42（上升沿触发）

⚠ 注意：触发信号必须为上升沿，禁止持续置位。

------

## 测试数据

| 目标位置 | 结果     |
| -------- | -------- |
| 500.5 mm | 成功到位 |
| 200.5 mm | 成功     |
| 300.4 mm | 成功     |

✅ 结论：绝对定位功能正常，精度与速度符合预期。

------

# 四、相对定位测试

## 控制变量

- 相对定位距离：D26（浮点数）
- 触发：M43（上升沿触发）
- 速度：与绝对定位共用

------

## 测试情况

### 1️⃣ 持续置位测试（错误示范）

- 现象：完成一次运动后立即再次执行
- 原因：持续触发导致重复执行

### 2️⃣ 上升沿触发测试（修正后）

| 当前  | 输入   | 结果  |
| ----- | ------ | ----- |
| 800.5 | +100.0 | 900.5 |
| 900.5 | -200.0 | 700.5 |

再测试：

| 当前  | 输入   | 结果   |
| ----- | ------ | ------ |
| 300.4 | -300.4 | 0      |
| 0     | 再触发 | -300.4 |

✅ 结论：相对定位逻辑正确，上升沿触发修正成功。

------

# 五、限位功能测试

## 1️⃣ 硬件限位

- 正负限位触发时立即停机
- 轴状态在线调试页面显示 ON

⚠此功能为 P100E 伺服自带的逻辑，与 P100S 的逻辑类似。

## 2️⃣ 软限位测试

设置：

- 正软限位：1000
- 负软限位：0
- 勾选软限位使能

测试结果：

- 到达 1000 时正向无法继续运动
- 到达 0 时反向无法继续运动
- 点动与程序控制均被正确限制

⚠ 注意事项：

- 软限位必须在绝对零点稳定前提下使用
- 在线“进入伺服调试”必须关闭，否则程序无法控制

✅ 结论：软限位功能正常。

------

# 六、Modbus TCP 远程控制测试

## 连接参数

- IP：192.168.1.88
- 端口：502
- 协议：Modbus-TCP

------

## 1️⃣ 电机使能

- M1 → Coil 地址 1
- 功能码：01（读线圈）/05（写单线圈）

结果：

- 写入 1 后电机成功使能
- D101 状态显示正常

------

## 2️⃣ 位置读取

- D124 → 当前绝对位置
- 功能码：03（读保持寄存器）
- 数据类型：REAL（小端互换）

结果：

- 与 PLC 显示一致

------

## 3️⃣ 点动测试

| 功能     | 地址 |
| -------- | ---- |
| 正向点动 | M54  |
| 反向点动 | M55  |

结果：

- M54=1 → 位置增加
- M55=1 → 位置减少

------

## 4️⃣ 绝对定位

| 功能     | 地址 |
| -------- | ---- |
| 目标位置 | D24  |
| 触发     | M42  |

测试位置：

- 200.5
- 300.4

结果：均成功到位。

------

## 5️⃣ 相对定位

| 功能     | 地址 |
| -------- | ---- |
| 相对距离 | D26  |
| 触发     | M43  |

测试：

- 300.4 → -300.4 → 0
- 再触发 → -300.4

结果：完全符合预期。

------

# 七、问题及修复

问题：

- 相对定位持续置位会重复执行

修改：

- 改为上升沿触发逻辑

结果：

- 每次只执行一次运动
- 功能稳定

------

下面为可直接纳入《Y轴PLC控制+ModbusTCP运动测试报告》的**问题记录与整改项**章节内容。

------

# 八、问题记录与整改需求

## 8.1 软限位触发后绝对定位状态未复位问题

### 一、问题背景

在进行软限位测试过程中发现以下异常现象：

### 测试步骤

1. 设置负软限位：-100 mm
2. 设置绝对定位目标位置：-200 mm
3. 触发绝对定位运动

------

### 二、实际运行结果

- 电机正常运行至 -100 mm（负软限位位置）
- 触发负软限位后立即停止运动（符合预期）
- 但此时：

```text
轴Y绝对定位中 = ON
```

状态未自动复位。

------

### 三、问题影响

由于“绝对定位中”状态未清除，导致：

1. 系统判断轴仍处于运动状态
2. 无法执行新的绝对/相对定位
3. 点动控制受到限制
4. 无法直接正向移动回到合法范围
5. 运动逻辑进入“假运行状态”

该问题属于：

> 运动异常终止未完成状态闭环处理

------

### 四、问题原因分析（PLC逻辑层面）

当前程序逻辑大概率为：

```text
绝对定位触发 → 置位 绝对定位中
到位信号 → 复位 绝对定位中
```

存在缺陷：

- 仅处理“正常到位”
- 未处理“异常终止（软限位触发）”

当触碰软限位时：

- 伺服强制停止
- PLC 未进入“到位逻辑”
- 绝对定位中状态未复位

属于：

> 运动生命周期不完整

------

### 五、理想控制逻辑（整改目标）

当通过绝对/相对定位触碰软限位时，应满足以下行为：

#### 1️⃣ 立即停止当前运动

（当前已实现）

#### 2️⃣ 输出限位状态提示

例如：

```text
轴Y已触碰负软限位 = ON
```

#### 3️⃣ 自动复位运动中状态

```text
轴Y绝对定位中 = OFF
```

确保系统回到“可操作状态”。

------

### 六、建议整改方案（PLC逻辑优化）

建议修改为统一的运动结束判定逻辑：

```text
IF 到位信号 OR 正软限位 OR 负软限位 OR 报警 THEN
    绝对定位中 := FALSE
END_IF
```

同时增加：

- 软限位触发状态标志
- 运动异常结束标志
- 方向限制逻辑（禁止继续朝限位方向运动）

------

### 七、优化建议（工程级升级）

建议将当前“运动中 BOOL 标志”升级为“运动状态枚举变量”：

| 状态值 | 含义           |
| ------ | -------------- |
| 0      | 空闲           |
| 1      | 绝对定位运行   |
| 2      | 相对定位运行   |
| 3      | 点动运行       |
| 10     | 正常完成       |
| 11     | 触碰软限位终止 |
| 12     | 报警终止       |

优势：

- 避免状态卡死
- 上位机可清晰显示状态
- 提高系统可维护性
- 便于后期扩展多轴逻辑

------

### 八、问题等级评估

| 项目         | 评估             |
| ------------ | ---------------- |
| 功能完整性   | 存在缺陷         |
| 安全性       | 无风险（已停机） |
| 可操作性     | 受影响           |
| 工程可交付性 | 需整改           |

------

### 九、整改状态

> 当前状态：已确认问题
> 后续处理：PLC程序逻辑优化
> 验收结论：该项暂不通过，待修改后复测

------

# 九、测试总结与验收结论

## 9.1 功能测试结果汇总

| 测试项目        | 测试结果 | 说明                                     |
| --------------- | -------- | ---------------------------------------- |
| 电机使能控制    | 正常     | M1 控制有效，状态反馈正确                |
| 点动控制        | 正常     | 正反方向运动逻辑正确                     |
| 绝对定位        | 基本正常 | 定位精度符合预期，但软限位异常终止未复位 |
| 相对定位        | 正常     | 上升沿触发修正后逻辑稳定                 |
| 硬件限位        | 正常     | 触发立即停机                             |
| 软限位保护      | 存在缺陷 | 触发后运动状态未正确复位                 |
| Modbus TCP 通信 | 正常     | 读写一致，数据解析正确                   |
| 上升沿触发优化  | 成功     | 解决重复执行问题                         |

## 9.2 当前存在问题

目前系统仍存在以下待整改项：

### ① 软限位异常终止后状态未复位

问题表现：

- 绝对定位触发软限位后
- 运动停止（符合预期）
- 但“绝对定位中”状态未清除
- 系统进入逻辑假运行状态

影响：

- 无法发起新的定位指令
- 点动受限
- 操作逻辑不闭环

问题性质：

> 运动生命周期异常终止处理不完整

整改要求：

- 增加异常终止统一复位逻辑
- 软限位触发必须参与运动结束判定
- 优化状态机设计

验收判定：

> 本项暂不通过，需修改后复测

------

